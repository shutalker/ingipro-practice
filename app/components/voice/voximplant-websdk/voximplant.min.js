(function() {
	var root = this;var VoxImplant=function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="/build",t(0)}([function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}function o(){return a.Client.getInstance()}function i(){if(!s.Authenticator.get().authorized())throw new Error("NOT_AUTHORIZED");return c.Messaging.Messenger.getInstance()}var a=n(7);n(45);var s=n(10),c=n(22),d=n(17);t.Events=d.Events;var l=n(11);t.CallEvents=l.CallEvents,r(n(22));var u=n(42);t.OperatorACDStatuses=u.OperatorACDStatuses;var p=n(1);t.LogCategory=p.LogCategory,t.LogLevel=p.LogLevel,t.getInstance=o,t.version=a.Client.getInstance().version,t.getMessenger=i},function(e,t){"use strict";!function(e){e[e.NONE=0]="NONE",e[e.ERROR=1]="ERROR",e[e.WARNING=2]="WARNING",e[e.INFO=3]="INFO",e[e.TRACE=4]="TRACE"}(t.LogLevel||(t.LogLevel={}));var n=t.LogLevel;!function(e){e[e.SIGNALING=0]="SIGNALING",e[e.RTC=1]="RTC",e[e.USERMEDIA=2]="USERMEDIA",e[e.CALL=3]="CALL",e[e.CALLEXP2P=4]="CALLEXP2P",e[e.CALLEXSERVER=5]="CALLEXSERVER",e[e.CALLMANAGER=6]="CALLMANAGER",e[e.CLIENT=7]="CLIENT",e[e.AUTHENTICATOR=8]="AUTHENTICATOR",e[e.PCFACTORY=9]="PCFACTORY",e[e.UTILS=10]="UTILS",e[e.ORTC=11]="ORTC",e[e.MESSAGING=12]="MESSAGING",e[e.REINVITEQ=13]="REINVITEQ"}(t.LogCategory||(t.LogCategory={}));var r=t.LogCategory,o=function(){function e(e,t,n){this.category=e,this.label=t,this.provider=n}return e.prototype.log=function(e,t){this.provider.writeMessage(this.category,this.label,e,t)},e.prototype.error=function(e){this.log(n.ERROR,e)},e.prototype.warning=function(e){this.log(n.WARNING,e)},e.prototype.info=function(e){this.log(n.INFO,e)},e.prototype.trace=function(e){this.log(n.TRACE,e)},e}();t.Logger=o;var i=function(){function e(){this._shadowLogging=!1,this.levels={}}return e.get=function(){return"undefined"==typeof this.inst&&(this.inst=new e,this.inst.prettyPrint=!1),this.inst},Object.defineProperty(e.prototype,"shadowLogging",{get:function(){return this._shadowLogging},set:function(e){this._shadowLogging||(this._shadowLog=[]),this._shadowLogging=e},enumerable:!0,configurable:!0}),e.prototype.getSLog=function(){return this._shadowLog},e.prototype.setPrettyPrint=function(e){this.prettyPrint=e},e.prototype.setLogLevel=function(e,t){this.levels[r[e]]=t},e.prototype.writeMessage=function(t,o,i,a){e.tick++;var s="VIWSLR "+e.tick+" "+(new Date).toString()+" "+n[i]+" "+o+": "+a,c=n.NONE;if("undefined"!=typeof this.levels[r[t]]&&(c=this.levels[r[t]]),i<=c)if("undefined"!=typeof console.debug&&"undefined"!=typeof console.info&&"undefined"!=typeof console.error&&"undefined"!=typeof console.warn)if(this.prettyPrint){"string"!=typeof a&&(a=JSON.stringify(a));var d="%c VIWSLR "+e.tick+" "+(new Date).toUTCString()+" ["+n[i]+"] %c"+o+": %c"+a.replace("\r\n","<br>");i===n.ERROR?console.error(s):i===n.WARNING?console.warn(d,"color:#ccc","color:#2375a2","color:#000"):i===n.INFO?console.info(d,"color:#ccc","color:#2375a2","color:#000"):i===n.TRACE?console.log(d,"color:#ccc","color:#2375a2","color:#000"):console.log(d,"color:#ccc","color:#2375a2","color:#000")}else i===n.ERROR?console.error(s):i===n.WARNING?console.warn(s):i===n.INFO?console.info(s):i===n.TRACE?console.debug(s):console.log(s);else console.log(s);this.shadowLogging&&this._shadowLog.push(s)},e.prototype.createLogger=function(e,t){return new o(e,t,this)},e.d_trace=function(t){return function(r,o,i){return{value:function(){for(var r=[],a=0;a<arguments.length;a++)r[a-0]=arguments[a];var s="";try{s=r.map(function(e){return JSON.stringify(e)}).join()}catch(e){s="circular structure"}var c,d=i.value.apply(this,r);try{c=JSON.stringify(c)}catch(e){c="circular structure"}return"undefined"==typeof c?e.get().writeMessage(t,"",n.TRACE,"Call: "+o+"("+s+")"):e.get().writeMessage(t,"",n.TRACE,"Call: "+o+"("+s+") => "+c),d}}}},e.tick=0,e}();t.LogManager=i},function(e,t){"use strict";!function(e){e[e.ping="__ping"]="ping",e[e.login="login"]="login",e[e.loginGenerateOneTimeKey="loginGenerateOneTimeKey"]="loginGenerateOneTimeKey",e[e.loginStage2="loginStage2"]="loginStage2",e[e.setOperatorACDStatus="setOperatorACDStatus"]="setOperatorACDStatus",e[e.setDesiredVideoBandwidth="setDesiredVideoBandwidth"]="setDesiredVideoBandwidth",e[e.rejectCall="rejectCall"]="rejectCall",e[e.disconnectCall="disconnectCall"]="disconnectCall",e[e.sendDTMF="sendDTMF"]="sendDTMF",e[e.sendSIPInfo="sendSIPInfo"]="sendSIPInfo",e[e.hold="hold"]="hold",e[e.unhold="unhold"]="unhold",e[e.acceptCall="acceptCall"]="acceptCall",e[e.createCall="createCall"]="createCall",e[e.transferCall="transferCall"]="transferCall",e[e.muteLocal="__muteLocal"]="muteLocal",e[e.reInvite="ReInvite"]="reInvite",e[e.acceptReInvite="AcceptReInvite"]="acceptReInvite",e[e.confirmPC="__confirmPC"]="confirmPC",e[e.addCandidate="__addCandidate"]="addCandidate",e[e.loginUsingOneTimeKey="loginUsingOneTimeKey"]="loginUsingOneTimeKey",e[e.refreshOauthToken="refreshOauthToken"]="refreshOauthToken",e[e.zPromptFinished="promptFinished"]="zPromptFinished",e[e.zStartPreFlightCheck="__startPreFlightCheck"]="zStartPreFlightCheck",e[e.registerPushToken="registerPushToken"]="registerPushToken",e[e.unregisterPushToken="unregisterPushToken"]="unregisterPushToken",e[e.pushFeedback="pushFeedback"]="pushFeedback"}(t.RemoteFunction||(t.RemoteFunction={}));t.RemoteFunction},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},o=n(1),i=n(5),a=n(8),s=n(6),c=n(2),d=n(13),l=n(25),u=n(7);!function(e){e[e.IDLE=0]="IDLE",e[e.CONNECTING=1]="CONNECTING",e[e.WSCONNECTED=2]="WSCONNECTED",e[e.CONNECTED=3]="CONNECTED",e[e.CLOSING=4]="CLOSING"}(t.VoxSignalingState||(t.VoxSignalingState={}));var p=t.VoxSignalingState,g=function(){function e(){var e=this;this.ver="3",this.handlers=[],this.rpcHandlers={},this.pingTimer=null,this.pongTimer=null,this.manualDisconnect=!1,this.platform="platform",this.referrer="platform",this.extra="",this.closing=!1,this.writeLog=!1,this._opLog=[],this.token="",this.log=o.LogManager.get().createLogger(o.LogCategory.SIGNALING,"VoxSignaling"),this.currentState=p.IDLE,this.setRPCHandler(d.RemoteEvent.connectionSuccessful,function(t){e.onConnectionSuccessfulRPC(t)}),this.setRPCHandler(d.RemoteEvent.connectionFailed,function(){e.onConnectionFailedRPC()}),this.setRPCHandler(d.RemoteEvent.createConnection,function(t){e.onConnectionSuccessfulRPC(t)})}return e.get=function(){return"undefined"==typeof this.inst&&(this.inst=new e),this.inst},e.prototype.addHandler=function(e){this.handlers.push(e)},e.prototype.close=function(){this.closing=!0,this.ws?(this.ws.onclose=null,this.ws.close(),this.onWSClosed(null)):this.log.warning("Try close unused WS in state "+p[this.currentState])},e.prototype.cleanup=function(){a.PCFactory.get().closeAll(),this.pingTimer&&clearTimeout(this.pingTimer),this.pongTimer&&clearTimeout(this.pongTimer)},e.prototype.onConnectionSuccessfulRPC=function(e){if(this.currentState!=p.WSCONNECTED)return void this.log.error("Can't handle __connectionSuccessful while in state "+p[this.currentState]);if(e&&(this.token=e),this.currentState=p.CONNECTED,this.handlers.length>0)for(var t=0;t<this.handlers.length;++t)try{this.handlers[t].onSignalingConnected()}catch(e){this.log.warning("Error in onSignalingConnected callback: "+e)}else this.log.warning("No VoxSignaling handler specified")},e.prototype.onConnectionFailedRPC=function(){if(this.currentState!=p.WSCONNECTED)return void this.log.error("Can't handle __connectionSuccessful while in state "+p[this.currentState]);if(this.ws.onerror=null,this.ws.close(),this.ws=null,this.currentState=p.IDLE,this.handlers.length>0)for(var e=0;e<this.handlers.length;++e)try{this.handlers[e].onMediaConnectionFailed()}catch(e){this.log.warning("Error in onMediaConnectionFailed callback: "+e)}else this.log.warning("No VoxSignaling handler specified")},e.prototype.connectTo=function(e,t,n,r,o){var a=this;if(void 0===t&&(t=!1),void 0===n&&(n=!0),this.manualDisconnect=!1,this.ver=o,this.currentState!=p.IDLE)return void this.log.error("Can't establish connection while in state "+p[this.currentState]);this.currentState=p.CONNECTING;var s=i.default.getWSVendor(r);this.ws=new WebSocket("ws"+(n?"s":"")+"://"+e+"/"+this.platform+"?version="+this.ver+"&client="+s+"&referrer="+this.referrer+"&referrer="+this.extra+"&video"+(t?"true":"false")+"&client_version="+u.Client.getInstance().version),this.ws.onopen=function(e){return a.onWSConnected()},this.ws.onclose=function(e){return a.onWSClosed(e)},this.ws.onerror=function(e){return a.onWSError()},this.ws.onmessage=function(e){return a.onWSData(e.data)}},e.prototype.setRPCHandler=function(e,t){"undefined"!=typeof this.rpcHandlers[e]&&this.log.warning("Overwriting RPC handler for function "+e),this.rpcHandlers[e]=t},e.prototype.removeRPCHandler=function(e){"undefined"!=typeof this.rpcHandlers[e]||this.closing||this.log.warning("There is no RPC handler for function "+e),delete this.rpcHandlers[e]},e.prototype.callRemoteFunction=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(this.currentState!=p.CONNECTED&&this.currentState!=p.WSCONNECTED)return this.closing||this.log.error("Can't make a RPC call in state "+p[this.currentState]),!1;if("undefined"!=typeof this.ws){this.writeLog&&this._opLog.push("send:"+JSON.stringify({name:e,params:t}));var r=JSON.stringify({name:e,params:t});return this.ws.send(r),o.LogManager.get().writeMessage(o.LogCategory.SIGNALING,"[wsdataout]",o.LogLevel.INFO,r),!0}},e.prototype.onWSData=function(e){o.LogManager.get().writeMessage(o.LogCategory.SIGNALING,"[wsdatain]",o.LogLevel.INFO,e),this.writeLog&&this._opLog.push("recv:"+e);var t;try{t=JSON.parse(e)}catch(t){return void this.log.error("Can't parse JSON data: "+e)}"undefined"!=typeof t.service?this.onWSMessData(t):this.onWSVoipData(t)},e.prototype.onWSMessData=function(e){l.MsgSignaling.get().handleWsData(e)},e.prototype.onWSVoipData=function(e){var t=e.name,n=e.params;if("undefined"!=typeof this.rpcHandlers[t])try{this.rpcHandlers[t].apply(null,n)}catch(e){this.log.warning("Error in '"+t+"' handler : "+e)}else this.log.warning("No handler for "+t)},e.prototype.disconnect=function(){this.closing=!0,this.manualDisconnect=!0,this.onWSClosed(null),this.cleanup()},e.prototype.onWSClosed=function(e){if(this.currentState!=p.CONNECTED&&this.currentState!=p.CONNECTING&&this.currentState!=p.CLOSING){if(this.closing)return;this.log.warning("onWSClosed in state "+p[this.currentState])}this.ws&&(this.ws.close(),this.ws=void 0);var t=this.currentState;if(this.pingTimer&&clearTimeout(this.pingTimer),this.pongTimer&&clearTimeout(this.pongTimer),this.cleanup(),this.currentState=p.IDLE,this.handlers.length>0)for(var n=0;n<this.handlers.length;++n)if(t!=p.CONNECTING&&t!=p.WSCONNECTED&&t!=p.IDLE||this.manualDisconnect)try{this.handlers[n].onSignalingClosed()}catch(e){this.log.warning("Error in onSignalingClosed callback: "+e)}else try{this.handlers[n].onSignalingConnectionFailed(e.reason)}catch(e){this.log.warning("Error in onSignalingConnectionFailed callback: "+e)}else this.log.warning("No VoxSignaling handler specified")},e.prototype.onWSConnected=function(){var t=this;this.closing=!1,this.currentState!=p.CONNECTING&&this.log.warning("onWSConnected in state "+p[this.currentState]),this.currentState=p.WSCONNECTED,this.pingTimer=window.setTimeout(function(){return t.doPing()},e.PING_DELAY),this.setRPCHandler(d.RemoteEvent.pong,function(){return t.pongReceived()}),this.setRPCHandler(d.RemoteEvent.increaseGain,function(){t.log.info("Deprecated increaseGain")})},e.prototype.onWSError=function(){if(this.currentState!=p.CONNECTING&&this.log.warning("onWSError in state "+this.currentState),this.ws.close(),this.ws=void 0,this.pingTimer&&clearTimeout(this.pingTimer),this.pongTimer&&clearTimeout(this.pongTimer),this.cleanup(),this.currentState=p.IDLE,"undefined"!=typeof this.handlers)for(var e=0;e<this.handlers.length;++e)try{this.handlers[e].onSignalingConnectionFailed("Error connecting to VoxImplant server")}catch(e){this.log.warning("Error in onSignalingConnectionFailed callback: "+e)}else this.log.warning("No VoxSignaling handler specified")},e.prototype.doPing=function(){var t=this;this.pingTimer=null,this.callRemoteFunction(c.RemoteFunction.ping,[]),this.pongTimer=window.setTimeout(function(){if(s.CallManager.get().numCalls>0)return void t.pongReceived();t.pongTimer=null,t.currentState=p.IDLE;for(var e=0;e<t.handlers.length;++e)if(t.currentState==p.CONNECTED)try{t.handlers[e].onSignalingClosed()}catch(e){t.log.warning("Error in onSignalingClosed callback: "+e)}else try{t.handlers[e].onSignalingConnectionFailed("Connection closed")}catch(e){t.log.warning("Error in onSignalingConnectionFailed callback: "+e)}},e.PING_DELAY)},e.prototype.pongReceived=function(){var t=this;this.pongTimer&&(clearTimeout(this.pongTimer),this.pongTimer=null,this.pingTimer=window.setTimeout(function(){return t.doPing()},e.PING_DELAY))},e.prototype.sendRaw=function(e){this.writeLog&&this._opLog.push("send:"+JSON.stringify(e));var t=JSON.stringify(e);return this.ws.send(t),o.LogManager.get().writeMessage(o.LogCategory.SIGNALING,"[wsdataout]",o.LogLevel.INFO,t),!0},e.prototype.getLog=function(){return this._opLog},e.prototype.lagacyConnectTo=function(e,t,n,r){this.ver="2",this.platform=r,this.referrer=t,this.connectTo(e,!1,!0,!0,"2")},e.PING_DELAY=3e4,r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"addHandler",null),r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"close",null),r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"cleanup",null),r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"onConnectionSuccessfulRPC",null),r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"onConnectionFailedRPC",null),r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"connectTo",null),r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"setRPCHandler",null),r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"removeRPCHandler",null),r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"callRemoteFunction",null),r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"disconnect",null),r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"onWSClosed",null),r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"onWSConnected",null),r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"onWSError",null),r([o.LogManager.d_trace(o.LogCategory.SIGNALING)],e.prototype,"sendRaw",null),e}();t.VoxSignaling=g},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},o=n(1),i=n(37),a=n(5),s=n(8),c=n(7);!function(e){e[e.LOCAL=-1]="LOCAL",e[e.ANY=0]="ANY",e[e.REMOTE=1]="REMOTE"}(t.MediaDirection||(t.MediaDirection={}));var d=t.MediaDirection,l=function(){function e(){this.audioSourcesList=[],this.videoSourcesList=[],this.audioOutputsList=[],this.videoContainerId="voximplantlocalvideo",this.log=o.LogManager.get().createLogger(o.LogCategory.USERMEDIA,""),this.config=new i.MediaCaptureConfig,this.clearConstraints(),this.enableAudio(!0),this.enableVideo(!0),this.handlers=new Array,this.mediaAccessGranted=!1,this._localVideos=new Array,"undefined"==typeof window.AudioContext&&"undefined"==typeof window.webkitAudioContext||(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.audioContext=new AudioContext)}return e.get=function(){return this.inst||(this.inst=new e),this.inst},e.prototype.clearConstraints=function(){},e.prototype.addHandler=function(e){this.handlers.push(e)},e.prototype.enableAudio=function(e){this.config.audioEnabled=e},e.prototype.enableVideo=function(e){this.config.videoEnabled=e},e.prototype.setLocalStream=function(e){if(e.getAudioTracks().length>0&&(this.currentAudioTrack=e.getAudioTracks()[0]),e.getVideoTracks().length>0&&(this.currentVideoTrack=e.getVideoTracks()[0]),this._currentStream){for(;this._currentStream.getTracks().length>0;)this._currentStream.removeTrack(this._currentStream.getTracks()[0]);this.currentAudioTrack&&this._currentStream.addTrack(this.currentAudioTrack),this.currentVideoTrack&&this._currentStream.addTrack(this.currentVideoTrack)}else this._currentStream=e;for(var t in s.PCFactory.get().peerConnections)this.attachTo(s.PCFactory.get().peerConnections[t])},e.prototype.queryMedia=function(){var e=a.default.composeConstraints(this.config);return this.getQueryMedia(e)},e.prototype.queryMediaSilent=function(){var e=a.default.composeConstraints(this.config);return this.muteAllLocal(),this.getQueryMediaSilent(e)},e.prototype.getConstrainWithSendFlag=function(e,t){var n=JSON.parse(JSON.stringify(this.config));return null!=e&&(n.audioEnabled=e),null!=t&&(n.videoEnabled=t),a.default.composeConstraints(n)},e.prototype.getQueryMedia=function(e){var t=this;return new Promise(function(n,r){a.default.getUserMedia(e).then(function(r){t.validConstraints=e,t.mediaAccessGranted=!0,t.log.info("Media access granted"),t.processGrantedMedia(r),n(r)}).catch(function(e){t.handlers.forEach(function(e){try{e.onMediaAccessRejected()}catch(e){t.log.error("Error in callback "+e)}}),e.name?t.log.info("Media access rejected: "+e.name):t.log.info("Media access rejected"),t.validConstraints&&a.default.getUserMedia(t.validConstraints).then(function(e){t.log.info("Regained media access using previous settings"),t.processGrantedMedia(e),n(e)}).catch(function(e){r(e),t.log.error("Failed to regain media access with previously valid constraints")}),r(e)})})},e.prototype.getQueryMediaSilent=function(e){var t=this;return new Promise(function(n,r){a.default.getUserMedia(e).then(function(r){t.validConstraints=e,t.log.info("Media access granted"),n(r)}).catch(function(e){t.log.info("Media access rejected: "+e.name),t.validConstraints&&a.default.getUserMedia(t.validConstraints).then(function(e){t.log.info("Regained media access using previous settings"),n(e)}).catch(function(e){r(e),t.log.error("Failed to regain media access with previously valid constraints")}),r(e)})})},e.prototype.processGrantedMedia=function(e){var t=this;this.stopLocalStream(),this.setLocalStream(e),this.handlers.forEach(function(n){try{n.onMediaAccessGranted(e)}catch(e){t.log.error("Error in callback "+e)}})},e.prototype.muteAllLocal=function(){this.currentAudioTrack&&(this.currentAudioTrack.stop(),this.currentAudioTrack=null),this.currentVideoTrack&&(this.currentVideoTrack.stop(),this.currentVideoTrack=null)},e.prototype.getDevices=function(){0!==e.get().audioSourcesList.length&&(this.audioSourcesList=[]),0!==e.get().videoSourcesList.length&&(this.videoSourcesList=[]),0!==e.get().audioOutputsList.length&&(this.audioOutputsList=[]);var t=new Promise(function(t,n){navigator.mediaDevices.enumerateDevices().then(function(n){for(var r=0;r!=n.length;++r){var o=[0,0,0],i=n[r];"audio"===i.kind||"audioinput"===i.kind?e.get().audioSourcesList.push({id:i.id||i.deviceId,name:i.label||"Audio recording device "+o[0]++}):"video"===i.kind||"videoinput"===i.kind?e.get().videoSourcesList.push({id:i.id||i.deviceId,name:i.label||"Video recording device "+o[1]++}):"audiooutput"===i.kind&&e.get().audioOutputsList.push({id:i.id||i.deviceId,name:i.label||"Audio playback device "+o[2]++})}t()}).catch(function(e){n(e)})});return t},e.prototype.useVideoDevice=function(e){this.config.videoInputId=e},e.prototype.useAudioInputDevice=function(e){this.config.audioInputId=e},Object.defineProperty(e.prototype,"currentStream",{get:function(){return this._currentStream},enumerable:!0,configurable:!0}),e.prototype.attachTo=function(e){this._legacySoundControll=!0,e.bindLocalMedia(this._currentStream)},e.prototype.attachToSound=function(e){this._legacySoundControll=!0,this._currentStream&&this._currentStream.getAudioTracks().length&&e.bindLocalMedia(new MediaStream(this._currentStream.getAudioTracks()))},Object.defineProperty(e.prototype,"legacySoundControll",{get:function(){return this._legacySoundControll},enumerable:!0,configurable:!0}),e.prototype.sendVideo=function(e){this.currentVideoTrack&&(this.currentVideoTrack.enabled=e)},e.prototype.isVideoEnabled=function(){return this.config.videoEnabled},e.updateMuteState=function(t,n,r){var o=s.PCFactory.get().peerConnections;for(var i in o)if(o.hasOwnProperty(i))switch(n){case d.ANY:this.updateMuteState(t,d.LOCAL,r),this.updateMuteState(t,d.REMOTE,r);break;case d.LOCAL:e.getAudioTracks(o[i].localStream).map(function(e){e.enabled=r});break;case d.REMOTE:return void o[i].remoteStreams.map(function(t){e.getAudioTracks(t).map(function(e){e.enabled=r})});default:return!1}},e.prototype.stopLocalStream=function(){if(this._currentStream){this.stopStream(this._currentStream),this._currentStream=null;for(var e in s.PCFactory.get().peerConnections)s.PCFactory.get().peerConnections.hasOwnProperty(e)&&s.PCFactory.get().peerConnections[e].bindLocalMedia(null)}},e.prototype.stopStream=function(e){e.getTracks().forEach(function(e){e.stop()})},e.prototype.setConstraints=function(e,t){var n=this;return this.config.videoEnabled=!0,new Promise(function(r,o){n.config.setVideoSettings(e),t===!0&&n.queryMedia().then(function(e){r(e)}).catch(function(e){o(e)})})},e.getAudioTracks=function(e){if(e){if(e.audioTracks)return e.audioTracks;if(e.getAudioTracks)return e.getAudioTracks()}return null},e.getVideoTracks=function(e){if(e){if(e.videoTracks)return e.videoTracks;if(e.getVideoTracks)return e.getVideoTracks()}return null},e.prototype.showLocalVideo=function(t,n,r){var o=this;if(void 0===t&&(t=!0),void 0===n&&(n=!1),void 0===r&&(r=!1),this.currentLocalVideoSets={flag:t,mirror:n,detachCamera:r},"undefined"!=typeof this.currentStream){var i=document.getElementById(c.Client.getInstance().localVideoContainerId)||document.body,s=document.getElementById(this.videoContainerId);if(t)null===s?(s=document.createElement("video"),s.id=this.videoContainerId,s.autoplay=!0,s.muted=!0,i.firstChild?i.insertBefore(s,i.firstChild):i.appendChild(s)):s.style.display="block",a.default.getUserMedia(e.get().getConstrainWithSendFlag(!1,!0)).then(function(e){o._localVideos.push(e),a.default.attachMedia(e,s)});else if("undefined"!=typeof s&&null!==s&&(s.style.display="none"),r)for(var d=0;d<this._localVideos.length;d++)this.stopStream(this._localVideos[d]);n&&s&&(s.style.cssText+="transform: rotateY(180deg);-webkit-transform:rotateY(180deg);-moz-transform:rotateY(180deg);")}},e.prototype.resetLocalVideo=function(){this._localVideos=[],this.showLocalVideo(this.currentLocalVideoSets.flag,this.currentLocalVideoSets.mirror,this.currentLocalVideoSets.detachCamera)},e.prototype.updateLocalVideo=function(e){void 0===e&&(e=null);var t=document.getElementById(this.videoContainerId);if(null===e&&null!==t&&"none"!=t.style.display)this.showLocalVideo(!0);else{if(null===t||0==e.getVideoTracks().length)return!1;a.default.attachMedia(e,t)}},e.prototype.testLocalStream=function(e,t){for(var n=!1,r=!1,o=0,i=this._currentStream.getTracks();o<i.length;o++){var a=i[o];"audio"===a.kind&&(n=!0),"video"===a.kind&&(r=!0)}return e===n&&t===r},r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"clearConstraints",null),r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"addHandler",null),r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"enableAudio",null),r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"enableVideo",null),r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"setLocalStream",null),r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"queryMedia",null),r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"queryMediaSilent",null),r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"processGrantedMedia",null),r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"muteAllLocal",null),r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"getDevices",null),r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"useVideoDevice",null),r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"useAudioInputDevice",null),r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"attachTo",null),r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"attachToSound",null),r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"sendVideo",null),r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"stopLocalStream",null),r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"stopStream",null),r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"setConstraints",null),r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"showLocalVideo",null),r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"updateLocalVideo",null),r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e.prototype,"testLocalStream",null),r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e,"updateMuteState",null),r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e,"getAudioTracks",null),r([o.LogManager.d_trace(o.LogCategory.USERMEDIA)],e,"getVideoTracks",null),e}();t.UserMediaManager=l},function(e,t,n){"use strict";var r,o=n(1),i=n(29),a=n(31),s=n(41),c=n(28),d=n(15),l=n(30);!function(e){function t(e,t,n){var r=e;return"object"!=typeof r&&(r={}),r[t]={ideal:n},r}function n(e,t,n){switch(y){case m.Firefox:return new s.WebRTCPC(e,t,n);case m.Webkit:return new s.WebRTCPC(e,t,n);case m.Safari:return new s.WebRTCPC(e,t,n);case m.Edge:return new s.WebRTCPC(e,t,n);default:return o.LogManager.get().writeMessage(o.LogCategory.RTC,"Core",o.LogLevel.INFO,"Unsupported browser "+navigator.userAgent),null}}function r(){return y===m.Firefox||y===m.Webkit}function u(e){return navigator.mediaDevices.getUserMedia(e)}function p(e,t){return new d.SignalingDTMFSender(t)}function g(){return new Promise(function(e){e(!1)})}function f(e){var n=!1,r=!1;return e.audioEnabled&&(n=!0,e.audioInputId&&(n=t(n,"deviceId",e.audioInputId))),e.videoEnabled&&(r=!0,e.videoSettings&&(r=e.videoSettings),e.videoInputId&&(r=t(r,"deviceId",e.videoInputId))),{peerIdentity:null,audio:n,video:r}}function h(e){if(void 0===e&&(e=!0),e===!1)return"voxmobile";switch(y||v(),y){case m.Firefox:return"firefox";case m.Webkit:return"chrome";case m.Safari:return"safari";case m.Edge:return"voxmobile";default:return""}}function v(){navigator.mozGetUserMedia?y=m.Firefox:navigator.webkitGetUserMedia?y=m.Webkit:navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)?y=m.Edge:navigator.getUserMedia&&(y=m.Safari)}function C(){switch(y||v(),y&&o.LogManager.get().writeMessage(o.LogCategory.RTC,"Core",o.LogLevel.INFO,"Detected browser "+m[y]),e.getUserMedia=u,e.getDTMFSender=p,e.screenSharingSupported=g,y){case m.Firefox:e.attachMedia=i.FF.attachStream,e.detachMedia=i.FF.detachStream,e.getScreenMedia=i.FF.getScreenMedia,e.getRTCStats=i.FF.getRTCStats,e.getUserMedia=i.FF.getUserMedia,e.screenSharingSupported=i.FF.screenSharingSupported,e.getDTMFSender=i.FF.getDTMFSender;break;case m.Webkit:e.attachMedia=a.Webkit.attachStream,e.detachMedia=a.Webkit.detachStream,e.getScreenMedia=a.Webkit.getScreenMedia,e.getRTCStats=a.Webkit.getRTCStats,e.getUserMedia=a.Webkit.getUserMedia,e.screenSharingSupported=a.Webkit.screenSharingSupported,e.getDTMFSender=a.Webkit.getDTMFSender;break;case m.Safari:e.attachMedia=l.Safari.attachStream,e.detachMedia=l.Safari.detachStream,e.getScreenMedia=l.Safari.getScreenMedia,e.getRTCStats=l.Safari.getRTCStats,e.getUserMedia=i.FF.getUserMedia,e.getDTMFSender=l.Safari.getDTMFSender;break;case m.Edge:e.attachMedia=c.Edge.attachStream,e.detachMedia=c.Edge.detachStream,e.getScreenMedia=c.Edge.getScreenMedia,e.getRTCStats=c.Edge.getRTCStats;break;default:o.LogManager.get().writeMessage(o.LogCategory.RTC,"Core",o.LogLevel.INFO,"Unsupported browser "+navigator.userAgent)}e.composeConstraints=f}var m;!function(e){e[e.Firefox=1]="Firefox",e[e.Webkit=2]="Webkit",e[e.Edge=3]="Edge",e[e.Safari=4]="Safari"}(m||(m={}));var y;e.peerConnectionFactory=n,e.isScreenSharingSupported=r,e.getWSVendor=h,e.init=C}(r||(r={})),Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},o=n(14),i=n(11),a=n(3),s=n(26),c=n(10),d=n(12),l=n(1),u=n(8),p=n(7),g=n(19),f=n(34),h=n(33),v=n(2),C=n(13),m=n(32),y=n(16),L=i.CallEvents.PendingUpdate,S=function(){function e(){var e=this;this.protocolVersion="3",this._h264first=!1,this._calls={},this.voxSignaling=a.VoxSignaling.get(),this.log=l.LogManager.get().createLogger(l.LogCategory.SIGNALING,"CallManager"),this.voxSignaling.addHandler(this),this.voxSignaling.setRPCHandler(C.RemoteEvent.handleIncomingConnection,function(t,n,r,o,i){e.handleIncomingConnection(t,n,r,o,i)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.handleConnectionConnected,function(t,n,r){e.handleConnectionConnected(t,n,r)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.handleConnectionDisconnected,function(t,n,r){e.handleConnectionDisconnected(t,n,r)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.handleRingOut,function(t){e.handleRingOut(t)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.stopRinging,function(t){e.stopRinging(t)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.handleConnectionFailed,function(t,n,r,o){e.handleConnectionFailed(t,n,r,o)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.handleSIPInfo,function(t,n,r,o,i){e.handleSIPInfo(t,n,r,o,i)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.handleSipEvent,function(t){e.handleSipEvent(t)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.handleTransferStarted,function(t){e.handleTransferStarted(t)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.handleTransferComplete,function(t){e.handleTransferComplete(t)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.handleTransferFailed,function(t){e.handleTransferFailed(t)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.handleReInvite,function(t,n,r){e.handleInReinvite(t,n,r)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.handleAcceptReinvite,function(t,n,r){e.handleReinvite(t,n,r)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.handleRejectReinvite,function(t,n,r){e.handleRejectReinvite(t,n,r)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.startEarlyMedia,function(t,n,r){e.startEarlyMedia(t,n,r)})}return Object.defineProperty(e.prototype,"numCalls",{get:function(){return this._numCalls},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"calls",{get:function(){return this._calls},enumerable:!0,configurable:!0}),e.get=function(){return"undefined"==typeof this.inst&&(this.inst=new e),this.inst},e.prototype.call=function(t){var n=this;"boolean"==typeof t.video&&(t.video={sendVideo:t.video,receiveVideo:t.video});var r={number:null,video:{sendVideo:!1,receiveVideo:!1},customData:null,extraHeaders:{},wiredLocal:!0,wiredRemote:!0,H264first:!1,VP8first:!1,forceActive:!1},o=s.Utils.mixObjectToLeft(r,t);o=e.addCustomDataToHeaders(o);var i=s.Utils.generateUUID();if(this._calls[i])throw this.log.error("Call "+i+" already exists"),new Error("Internal error");var a;a="3"==this.protocolVersion?new m.CallExMedia(i,c.Authenticator.get().displayName,!1,o):"undefined"!=typeof o.extraHeaders[d.Constants.DIRECT_CALL_HEADER]?new h.CallExP2P(i,c.Authenticator.get().displayName,!1,o):new f.CallExServer(i,c.Authenticator.get().displayName,!1,o),
this._calls[i]=a,y.CallstatsIo.isModuleEnabled()&&(o.extraHeaders[d.Constants.CALLSTATSIOID_HEADER]=i),o.VP8first&&(a.rearangeCodecs=function(e){return new Promise(function(t,n){for(var r=0;r<e.sections.length;r++)"video"==e.sections[r].kind.toLowerCase()&&e.sections[r].codec.sort(function(e,t){return e.toLowerCase().indexOf("vp8")!=-1?-1:t.toLowerCase().indexOf("vp8")!=-1?1:0});t(e)})}),o.H264first&&(a.rearangeCodecs=function(e){return new Promise(function(t,n){for(var r=0;r<e.sections.length;r++)"video"==e.sections[r].kind.toLowerCase()&&e.sections[r].codec.sort(function(e,t){return e.toLowerCase().indexOf("h264")!=-1&&e.toLowerCase().indexOf("uc")==-1?-1:t.toLowerCase().indexOf("h264")!=-1&&t.toLowerCase().indexOf("uc")==-1?1:0});t(e)})});var l=!1;return Object.keys(this._calls).length>1&&(a.setActiveForce(!1),l=!0),"undefined"==typeof o.extraHeaders[d.Constants.DIRECT_CALL_HEADER]&&"2"==this.protocolVersion?this.voxSignaling.callRemoteFunction(v.RemoteFunction.createCall,-1,o.number,o.video,i,null,null,o.extraHeaders,o.extraParams):u.PCFactory.get().setupDirectPC(i,g.PeerConnectionMode.P2P,t.video,l).then(function(e){a.peerConnection=u.PCFactory.get().peerConnections[i];var t={tracks:a.peerConnection.getTrackKind()};n.voxSignaling.callRemoteFunction(v.RemoteFunction.createCall,-1,o.number,!0,i,null,null,o.extraHeaders,"",e.sdp,t)}),a},e.addCustomDataToHeaders=function(e){return"undefined"!=typeof e.customData&&("undefined"==typeof e.extraHeaders&&(e.extraHeaders={}),e.extraHeaders["VI-CallData"]=e.customData),e},e.prototype.handleIncomingConnection=function(e,t,n,r,o){if(this._calls[e])throw this.log.error("Call "+e+" already exists"),new Error("Internal error");var i,a=p.Client.getInstance().videoSupport,s={number:t,extraHeaders:r,video:a,wiredLocal:!0,wiredRemote:!0,forceActive:!1};i="3"==this.protocolVersion?new m.CallExMedia(e,n,!0,s):"undefined"!=typeof s.extraHeaders[d.Constants.DIRECT_CALL_HEADER]?new h.CallExP2P(e,n,!0,s):new f.CallExServer(e,n,!0,s),this._calls[e]=i,this._h264first&&(i.rearangeCodecs=function(e){return new Promise(function(t,n){for(var r=0;r<e.sections.length;r++)"video"==e.sections[r].kind.toLowerCase()&&e.sections[r].codec.sort(function(e,t){return e.toLowerCase().indexOf("h264")!=-1&&e.toLowerCase().indexOf("uc")==-1?-1:t.toLowerCase().indexOf("h264")!=-1&&t.toLowerCase().indexOf("uc")==-1?1:0});t(e)})});var c=!1;Object.keys(this._calls).length>1&&(i.setActiveForce(!1),c=!0),"undefined"==typeof s.extraHeaders[d.Constants.DIRECT_CALL_HEADER]&&"2"==this.protocolVersion?i.peerConnection=u.PCFactory.get().getPeerConnect(e):i.peerConnection=u.PCFactory.get().incomeDirectPC(e,{receiveVideo:!0,sendVideo:!0},o,c),p.Client.getInstance().onIncomingCall(e,t,n,r,a)},e.prototype.isSDPHasVideo=function(e){var t=e.indexOf("m=video");if(t===-1)return!1;var n=e.indexOf("a=sendrecv",t),r=e.indexOf("a=sendonly",t),o=e.indexOf("m=",t);return n!==-1&&(n<o||o===-1)||r!==-1&&(r<o||o===-1)},e.prototype.findCall=function(e,t){var n=this._calls[e];return""===e&&(n=this._calls[Object.keys(this._calls)[0]]),"undefined"==typeof n?(this.log.warning("Received "+t+" for unknown call "+e),null):n},e.prototype.handleRingOut=function(e){var t=this.findCall(e,"handleRingOut");"undefined"!=typeof t&&(p.Client.getInstance().playProgressTone(),t.onRingOut(),t.canStartSendingCandidates())},e.prototype.handleConnectionConnected=function(e,t,n){var r=this.findCall(e,"handleConnectionConnected");if(r.signalingConnected=!0,r.canStartSendingCandidates(),"undefined"!=typeof r&&(r.onConnected(t,n),"undefined"!=typeof n&&n.length>0)){var o=n.indexOf("m=video");if(o!==-1){var i=n.indexOf("a=sendrecv",o),a=n.indexOf("a=sendonly",o),s=n.indexOf("a=recvonly",o),c=n.indexOf("a=inactive",o);i===-1&&a===-1&&s===-1&&c===-1&&(n+="a=inactive\r\n")}r.peerConnection.processRemoteAnswer(t,n)}},e.prototype.startEarlyMedia=function(e,t,n){var r=this.findCall(e,"startEarlyMedia");r.hasEarlyMedia=!0,"undefined"!=typeof n&&r.peerConnection.processRemoteAnswer(t,n),p.Client.getInstance().stopProgressTone()},e.prototype.handleConnectionDisconnected=function(e,t,n){var r=this.findCall(e,"handleConnectionDisconnected");r&&(p.Client.getInstance().stopProgressTone(),r.onDisconnected(t,n),delete this._calls[e])},e.prototype.handleSIPInfo=function(e,t,n,r,o){var i=this.findCall(e,"handleSIPInfo");"undefined"!=typeof i&&i.onInfo(i,t,n,r,o)},e.prototype.stopRinging=function(e){var t=this.findCall(e,"stopRinging");t.canStartSendingCandidates(),"undefined"!=typeof t&&(p.Client.getInstance().stopProgressTone(),t.onStopRinging())},e.prototype.handleSipEvent=function(e){},e.prototype.handleTransferStarted=function(e){},e.prototype.handleTransferComplete=function(e){var t=this.findCall(e,"handleTransferComplete");"undefined"!=typeof t&&t.onTransferComplete()},e.prototype.handleTransferFailed=function(e){var t=this.findCall(e,"handleTransferFailed");"undefined"!=typeof t&&t.onTransferFailed()},e.prototype.handleReinvite=function(e,t,n){var r=this.findCall(e,"handleReinvite");if("undefined"!=typeof r){var o=this.isSDPHasVideo(n);r.peerConnection.handleReinvite(t,n,o)}},e.prototype.handleRejectReinvite=function(e,t,n){var r=this.findCall(e,"handleReinvite");"undefined"!=typeof r&&r.dispatchEvent({code:20,call:r})},e.prototype.handleInReinvite=function(e,t,n){var r=this.findCall(e,"handleReinvite");"undefined"!=typeof r&&(r.runIncomingReInvite(t,n),r.dispatchEvent({name:L,result:!0,call:r}))},e.prototype.handleConnectionFailed=function(e,t,n,r){var o=this.findCall(e,"handleConnectionFailed");"undefined"!=typeof o&&(delete this._calls[e],p.Client.getInstance().stopProgressTone(),o.onFailed(t,n,r))},e.prototype.onSignalingConnected=function(){},e.prototype.onSignalingClosed=function(){for(var e in this._calls)this._calls.hasOwnProperty(e)&&this._calls[e].hangup()},e.prototype.onSignalingConnectionFailed=function(e){},e.prototype.onMediaConnectionFailed=function(){},e.prototype.recalculateNumCalls=function(){this._numCalls=0;for(var e in this._calls)this._calls.hasOwnProperty(e)&&this._numCalls++},e.prototype.transferCall=function(e,t){for(var n=[e,t],r=0;r<n.length;r++){var i=this._calls[n[r].id()];if(!i)return void this.log.error("trying to transfer unknown call "+i.id());if(i.stateValue!=o.CallState.CONNECTED)return void this.log.error("trying to transfer call "+i.id()+" in state "+i.state())}this.voxSignaling.callRemoteFunction(v.RemoteFunction.transferCall,[e,t])},e.prototype.removeCall=function(e){delete this._calls[e]},e.cleanHeaders=function(e){var t={};for(var n in e)"X-"!=n.substring(0,2)&&n!=d.Constants.CALL_DATA_HEADER||(t[n]=e[n]);return t},e.prototype.setProtocolVersion=function(e){this.protocolVersion=e},r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"call",null),r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"handleIncomingConnection",null),r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"findCall",null),r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"handleRingOut",null),r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"handleConnectionConnected",null),r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"handleConnectionDisconnected",null),r([l.LogManager.d_trace(l.LogCategory.CALLEXSERVER)],e.prototype,"handleSIPInfo",null),r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"stopRinging",null),r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"handleSipEvent",null),r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"handleTransferStarted",null),r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"handleTransferComplete",null),r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"handleTransferFailed",null),r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"handleReinvite",null),r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"handleRejectReinvite",null),r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"handleInReinvite",null),r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"handleConnectionFailed",null),r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"onSignalingConnected",null),r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"onSignalingClosed",null),r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"onSignalingConnectionFailed",null),r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e.prototype,"removeCall",null),r([l.LogManager.d_trace(l.LogCategory.CALLMANAGER)],e,"addCustomDataToHeaders",null),e}();t.CallManager=S},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},o=n(17),i=n(26),a=n(3),s=n(4),c=n(10),d=n(5),l=n(1),u=n(8),p=n(6),g=n(18),f=n(43),h=n(2),v=n(13),C=n(16),m=n(20),y=n(36),L=n(35),S=n(21),E=function(){function e(){var t=this;if(this._connected=!1,this.progressToneScript={US:"440@-19,480@-19;*(2/4/1+2)",RU:"425@-19;*(1/3/1)"},this.playingNow=!1,this.serversList=[],this._vol=100,this.micRequired=!1,this.videoConstraints=null,this.progressToneCountry="US",this.progressTone=!0,this.showDebugInfo=!1,this.showWarnings=!1,this.RTCsupported=!1,this._deviceEnumAPI=!1,this.eventListeners={},this.applyMixins(e,[f.Callbackable]),e.instance)throw new Error("Error - use VoxImplant.getInstance()");e.instance=this,this._promises={},d.default.init();var n=u.PCFactory.get();n.requireMedia=!1,this.voxSignaling=a.VoxSignaling.get(),this.voxMediaManager=s.UserMediaManager.get(),this.voxCallManager=p.CallManager.get(),this.mediacache=m.MediaCache.get(),this.renderer=g.Renderer.get(),this.setLogLevelAll(l.LogLevel.NONE),l.LogManager.get().writeMessage(l.LogCategory.CLIENT,"SDK ver.",l.LogLevel.TRACE,this.version),a.VoxSignaling.get().setRPCHandler(v.RemoteEvent.onPCStats,function(e,n){u.PCFactory.get().getPeerConnect(e)&&t.dispatchEvent({name:"NetStatsReceived",stats:n})}),this._defaultSinkId=null}return e.prototype.applyMixins=function(e,t){t.forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(n){e.prototype[n]=t.prototype[n]})})},e.prototype.deviceEnumAPI=function(){var e=this;this.voxMediaManager.getDevices().then(function(){e._deviceEnumAPI=!0,e.dispatchEvent({name:o.Events.SourcesInfoUpdated})}).catch(function(e){this._deviceEnumAPI=!1})},e.prototype.playProgressTone=function(){null!==this.progressToneScript[this.progressToneCountry]&&(this.playingNow||this.playToneScript(this.progressToneScript[this.progressToneCountry]),this.playingNow=!0)},e.prototype.stopProgressTone=function(){this.playingNow&&(this.stopPlayback(),this.playingNow=!1)},e.prototype.onIncomingCall=function(e,t,n,r,i){this.dispatchEvent({name:o.Events.IncomingCall,call:p.CallManager.get().calls[e],headers:r,video:i})},e.prototype.checkConnection=function(){if(!this._connected)throw new Error("NOT_CONNECTED_TO_VOXIMPLANT")},e.prototype.init=function(e){var t=this;return new Promise(function(n,r){if(t._config="undefined"!=typeof e?e:{},void 0!==t._config.progressToneCountry&&(t.progressToneCountry=t._config.progressToneCountry),t._config.progressTone!==!0&&(t.progressTone=!1),void 0!==t._config.serverIp&&(t.serverIp=t._config.serverIp),void 0!==t._config.showDebugInfo&&(t.showDebugInfo=t._config.showDebugInfo),t._config.showWarnings!==!1&&(t.showWarnings=!0),"string"==typeof t._config.videoContainerId&&(t.remoteVideoContainerId=t._config.videoContainerId),"string"==typeof t._config.remoteVideoContainerId&&(t.remoteVideoContainerId=t._config.remoteVideoContainerId),"string"==typeof t._config.localVideoContainerId&&(t.localVideoContainerId=t._config.localVideoContainerId),t._config.micRequired!==!1&&(t.micRequired=!0),"undefined"!=typeof t._config.videoSupport?t.videoSupport=t._config.videoSupport:t.videoSupport=!1,"undefined"!=typeof t._config.H264first?(t._h264first=t._config.H264first,p.CallManager.get()._h264first=t._h264first):t._h264first=!1,"undefined"!=typeof t._config.VP8first?t._VP8first=t._config.VP8first:t._VP8first=!1,"undefined"!=typeof t._config.rtcStatsCollectionInterval?p.CallManager.get().rtcStatsCollectionInterval=t._config.rtcStatsCollectionInterval:p.CallManager.get().rtcStatsCollectionInterval=1e4,t.showWarnings&&t.setLogLevelAll(l.LogLevel.WARNING),t.showDebugInfo&&t.setLogLevelAll(l.LogLevel.TRACE),!t._config.protocolVersion||"2"!==t._config.protocolVersion&&"3"!==t._config.protocolVersion?t._callProtocolVersion="3":(t._callProtocolVersion=t._config.protocolVersion,p.CallManager.get().setProtocolVersion(t._callProtocolVersion)),t._config.callstatsIoParams&&C.CallstatsIo.get(t._config.callstatsIoParams),t._config.prettyPrint&&l.LogManager.get().setPrettyPrint(t._config.prettyPrint),void 0!==t._config.videoConstraints&&(t.videoConstraints=t._config.videoConstraints,s.UserMediaManager.get().setConstraints(t.videoConstraints,!1)),s.UserMediaManager.get().enableAudio(t.micRequired),s.UserMediaManager.get().enableVideo(t.videoSupport),"127.0.0.1"!=window.location.hostname&&"localhost"!=window.location.hostname&&"https:"!=window.location.protocol&&"undefined"!=typeof console.error&&t.showWarnings&&console.error("WARNING: getUserMedia() is deprecated on insecure origins, and support will be removed in the future. You should consider switching your application to a secure origin, such as HTTPS. See https://goo.gl/rStTGz for more details."),"undefined"!=typeof webkitRTCPeerConnection||"undefined"!=typeof mozRTCPeerConnection||"undefined"!=typeof RTCPeerConnection||"undefined"!=typeof RTCIceGatherer)if("undefined"!=typeof mozRTCPeerConnection)try{new mozRTCPeerConnection({iceServers:[]}),t.RTCsupported=!0}catch(e){}else t.RTCsupported=!0;if(!t.RTCsupported)throw r(new Error("NO_WEBRTC_SUPPORT")),new Error("NO_WEBRTC_SUPPORT");var i;null!=window.location.href.match(/^file\:\/{3}.*$/g)&&"undefined"!=typeof console.error&&t.showWarnings&&console.error("WebRTC requires application to be loaded from a web server"),t.voxAuth=c.Authenticator.get(),t.voxAuth.setHandler({onLoginSuccessful:function(e,n){t._promises.login&&t._promises.login.resolve({name:o.Events.AuthResult,displayName:e,result:!0}),t.dispatchEvent({name:o.Events.AuthResult,displayName:e,result:!0,tokens:n})},onLoginFailed:function(e){t._promises.login&&t._promises.login.reject({name:o.Events.AuthResult,code:e,result:!1}),t.dispatchEvent({name:o.Events.AuthResult,code:e,result:!1})},onSecondStageInitiated:function(){t._promises.login&&t._promises.login.reject({name:o.Events.AuthResult,code:301,result:!1}),t.dispatchEvent({name:o.Events.AuthResult,code:301,result:!1})},onOneTimeKeyGenerated:function(e){t._promises.loginkey&&t._promises.loginkey.resolve({name:o.Events.AuthResult,key:e,code:302,result:!1}),t.dispatchEvent({name:o.Events.AuthResult,key:e,code:302,result:!1})},onRefreshTokenFailed:function(e){t.dispatchEvent({name:o.Events.RefreshTokenResult,code:e,result:!1})},onRefreshTokenSuccess:function(e){t.dispatchEvent({name:o.Events.RefreshTokenResult,tokens:e,result:!0})}}),t.voxSignaling.addHandler(t),i=setInterval(function(){"undefined"!=typeof document&&(clearInterval(i),t.deviceEnumAPI(),t.dispatchEvent({name:o.Events.SDKReady,version:t.version}),n({name:o.Events.SDKReady,version:t.version}))},100)})},e.prototype.call=function(e,t,n,r){i.Utils.checkCA();var o={};o="string"==typeof e?{number:e,video:t,customData:n,extraHeaders:r}:e,"boolean"==typeof o.video?o.video={sendVideo:o.video,receiveVideo:o.video}:"undefined"==typeof o.video&&(o.video={sendVideo:!1,receiveVideo:!0}),"undefined"==typeof o.H264first&&(o.H264first=this._h264first),"undefined"==typeof o.VP8first&&(o.VP8first=this._VP8first);var a=this.voxCallManager.call(o);return a},e.prototype.config=function(){return this._config},e.prototype.connect=function(e){var t=this;return new Promise(function(n,r){if(t._promises.connect={resolve:n,reject:r},void 0!==t.serverIp){var o=void 0;"object"==typeof t.serverIp?(t.serversList=t.serverIp,o=t.serversList[0]):o=t.serverIp,t.connectTo(o,null,e)}else{var a=function(t){var n,r=String(t).indexOf(";");r==-1?n=t:(this.serversList=t.split(";"),n=this.serversList[0]),this.connectTo(n,null,e)};i.Utils.getServers(a.bind(t),!1,t)}})},e.prototype.connectTo=function(e,t,n){var r=this;if(this._connected)throw new Error("ALREADY_CONNECTED_TO_VOXIMPLANT");this.host=e,this.micRequired&&t!==!0?this.voxMediaManager.queryMedia().then(function(e){r.deviceEnumAPI(),r.micRequired&&r.voxSignaling.connectTo(r.host,!0,!0,n,r._callProtocolVersion),r.dispatchEvent({name:o.Events.MicAccessResult,result:!0,stream:e})}).catch(function(e){r.dispatchEvent({name:o.Events.MicAccessResult,result:!1,reason:e})}):this.voxSignaling.connectTo(e,!0,!0,n,this._callProtocolVersion)},e.prototype.disconnect=function(){this.checkConnection(),this.voxSignaling.disconnect(),this.voxMediaManager.stopLocalStream(),this.voxSignaling.removeRPCHandler(v.RemoteEvent.onCallRemoteFunctionError),this.voxSignaling.removeRPCHandler(v.RemoteEvent.handleError)},e.prototype.setOperatorACDStatus=function(e){var t=this;return new Promise(function(n,r){i.Utils.checkCA(),t._promises.acd_status={resolve:n,reject:r},t.voxSignaling.callRemoteFunction(h.RemoteFunction.setOperatorACDStatus,e)})},e.prototype.login=function(e,t,n){var r=this;return new Promise(function(o,a){if(r._promises.login={resolve:o,reject:a},n="undefined"!=typeof n?n:{},n=i.Utils.extend({},n),!r._connected)throw a(new Error("NOT_CONNECTED_TO_VOXIMPLANT")),new Error("NOT_CONNECTED_TO_VOXIMPLANT");r.voxAuth.basicLogin(e,t,n)})},e.prototype.loginWithCode=function(e,t,n){var r=this;return new Promise(function(o,a){if(r._promises.login={resolve:o,reject:a},n="undefined"!=typeof n?n:{},n=i.Utils.extend({serverPresenceControl:!1},n),!r._connected)throw a(new Error("NOT_CONNECTED_TO_VOXIMPLANT")),new Error("NOT_CONNECTED_TO_VOXIMPLANT");r.voxAuth.loginStage2(e,t,n)})},e.prototype.loginWithToken=function(e,t,n){var r=this;return new Promise(function(o,a){if(r._promises.login={resolve:o,reject:a},n="undefined"!=typeof n?n:{},n=i.Utils.extend({serverPresenceControl:!1},n),n.accessToken=t,!r._connected)throw a(new Error("NOT_CONNECTED_TO_VOXIMPLANT")),new Error("NOT_CONNECTED_TO_VOXIMPLANT");r.voxAuth.tokenLogin(e,n)})},e.prototype.tokenRefresh=function(e,t,n){this.voxAuth.tokenRefresh(e,t,n)},e.prototype.requestOneTimeLoginKey=function(e){var t=this;return new Promise(function(n,r){if(t._promises.loginkey={resolve:n,reject:r},!t._connected)throw r(new Error("NOT_CONNECTED_TO_VOXIMPLANT")),new Error("NOT_CONNECTED_TO_VOXIMPLANT");t.voxAuth.generateOneTimeKey(e)})},e.prototype.loginWithOneTimeKey=function(e,t,n){var r=this;return new Promise(function(o,a){if(r._promises.login={resolve:o,reject:a},n="undefined"!=typeof n?n:{},n=i.Utils.extend({serverPresenceControl:!1},n),!r._connected)throw a(new Error("NOT_COFNNECTED_TO_VOXIMPLANT")),new Error("NOT_CONNECTED_TO_VOXIMPLANT");r.voxAuth.loginUsingOneTimeKey(e,t,n)})},e.prototype.connected=function(){return this._connected},e.prototype.showLocalVideo=function(e,t,n){void 0===e&&(e=!0),void 0===t&&(t=!1),void 0===n&&(n=!1),this.voxMediaManager.showLocalVideo(e,t,n)},e.prototype.setLocalVideoPosition=function(e,t){throw new Error("Deprecated: please use CSS to position '#voximplantlocalvideo' element")},e.prototype.setLocalVideoSize=function(e,t){throw new Error("Deprecated: please use CSS to set size of '#voximplantlocalvideo' element")},e.prototype.setVideoSettings=function(e,t,n){var r=this;s.UserMediaManager.get().setConstraints(e,!0).then(function(e){null!==document.getElementById("voximplantlocalvideo")&&d.default.attachMedia(r.voxMediaManager.currentStream,document.getElementById("voximplantlocalvideo")),"function"==typeof t&&t(e)}).catch(function(e){"function"==typeof n&&n(e)})},e.prototype.setVideoBandwidth=function(e){this.checkConnection(),u.PCFactory.get().setBandwidthParams(e),this.voxSignaling.callRemoteFunction(h.RemoteFunction.setDesiredVideoBandwidth,e)},e.prototype.playToneScript=function(e,t){void 0===t&&(t=!1),i.Utils.playToneScript(e,t)},e.prototype.stopPlayback=function(){i.Utils.stopPlayback()&&this.dispatchEvent({name:o.Events.PlaybackFinished})},e.prototype.volume=function(e){return void 0===e?this._vol:(e>100&&(e=100),e<0&&(e=0),g.Renderer.get().setPlaybackVolume(e/100),this._vol=e,void 0)},e.prototype.audioSources=function(){return this.voxMediaManager.audioSourcesList},e.prototype.videoSources=function(){return this.voxMediaManager.videoSourcesList},e.prototype.audioOutputs=function(){return this.voxMediaManager.audioOutputsList},e.prototype.useAudioSource=function(e,t,n){var r=this;return new Promise(function(o,i){r.voxMediaManager.useAudioInputDevice(e),r.voxMediaManager.enableAudio(!0),r.voxMediaManager.queryMedia().then(function(e){"function"==typeof t&&t(e),o(e),s.UserMediaManager.get().updateLocalVideo(e)}).catch(function(e){"function"==typeof n&&n(e),i(e)})})},e.prototype.useVideoSource=function(e,t,n){var r=this;return new Promise(function(o,i){r.voxMediaManager.useVideoDevice(e),s.UserMediaManager.get().isVideoEnabled()?r.voxMediaManager.queryMedia().then(function(e){"function"==typeof t&&t(e),s.UserMediaManager.get().updateLocalVideo(e),o(e)}).catch(function(e){"function"==typeof n&&n(e),i(e)}):s.UserMediaManager.get().updateLocalVideo()})},e.prototype.useAudioOutput=function(e){var t=this;return new Promise(function(n,r){"chrome"!==d.default.getWSVendor(!0)&&r(new Error("Unsupported browser. Only Google Chrome 49 and above.")),t._defaultSinkId=e,n()})},e.prototype.attachRecordingDevice=function(e,t){var n=this;return this.voxMediaManager.enableAudio(!0),this._config.videoSupport&&this.voxMediaManager.enableVideo(!0),new Promise(function(r,i){return n.voxMediaManager.queryMedia().then(function(t){"function"==typeof e&&e(t),n.dispatchEvent({name:o.Events.MicAccessResult,result:!0,stream:t})}).catch(function(e){"function"==typeof t&&t(e),n.dispatchEvent({name:o.Events.MicAccessResult,result:!1,reason:e})})})},e.prototype.detachRecordingDevice=function(){s.UserMediaManager.get().stopLocalStream()},e.prototype.setCallActive=function(e,t){return void 0===t&&(t=!0),new Promise(function(n,r){return i.Utils.checkCA(),e?e.setActive(t):void r("trying to hold unknown call "+e)})},e.prototype.sendVideo=function(e){void 0===e&&(e=!0),this.voxMediaManager.sendVideo(e)},e.prototype.isRTCsupported=function(){if("undefined"!=typeof webkitRTCPeerConnection||"undefined"!=typeof mozRTCPeerConnection||"undefined"!=typeof RTCPeerConnection||"undefined"!=typeof RTCIceGatherer){if("undefined"==typeof mozRTCPeerConnection)return!0;try{return new mozRTCPeerConnection({iceServers:[]}),!0}catch(e){return!1}}},e.prototype.transferCall=function(e,t){i.Utils.checkCA(),this.voxCallManager.transferCall(e,t)},e.getInstance=function(){return"undefined"==typeof e.instance&&(e.instance=new e),e.instance},Object.defineProperty(e.prototype,"version",{get:function(){return"4.1.0887"},enumerable:!0,configurable:!0}),e.prototype.setLogLevel=function(e,t){l.LogManager.get().setLogLevel(e,t)},e.prototype.setLogLevelAll=function(e){this.setLogLevel(l.LogCategory.SIGNALING,e),this.setLogLevel(l.LogCategory.RTC,e),this.setLogLevel(l.LogCategory.ORTC,e),this.setLogLevel(l.LogCategory.USERMEDIA,e),this.setLogLevel(l.LogCategory.CALL,e),this.setLogLevel(l.LogCategory.CALLEXP2P,e),this.setLogLevel(l.LogCategory.CALLEXSERVER,e),this.setLogLevel(l.LogCategory.CALLMANAGER,e),this.setLogLevel(l.LogCategory.CLIENT,e),this.setLogLevel(l.LogCategory.AUTHENTICATOR,e),this.setLogLevel(l.LogCategory.PCFACTORY,e),this.setLogLevel(l.LogCategory.UTILS,e),this.setLogLevel(l.LogCategory.MESSAGING,e),this.setLogLevel(l.LogCategory.REINVITEQ,e)},e.prototype.onSignalingConnected=function(){this._connected=!0,void 0!==this._promises.connect&&this._promises.connect.resolve({name:o.Events.ConnectionEstablished}),this.dispatchEvent({name:o.Events.ConnectionEstablished})},e.prototype.onSignalingClosed=function(){this._connected=!1,this.dispatchEvent({name:o.Events.ConnectionClosed}),this.progressTone&&this.stopProgressTone()},e.prototype.onSignalingConnectionFailed=function(e){this._connected=!1,this.serversList.length>1&&("undefined"==typeof this.serverIp||"object"==typeof this.serverIp)?(this.serversList.splice(0,1),this.connectTo(this.serversList[0],!0)):(void 0!==this._promises.connect&&this._promises.connect.reject({name:o.Events.ConnectionFailed,message:e}),this.dispatchEvent({name:o.Events.ConnectionFailed,message:e}))},e.prototype.onMediaConnectionFailed=function(){},e.prototype.getCall=function(e){return p.CallManager.get().calls[e]},e.prototype.removeCall=function(e){p.CallManager.get().removeCall(e)},e.prototype.screenSharingSupported=function(){return d.default.screenSharingSupported()},e.prototype.dispatchEvent=function(e){},e.prototype.addEventListener=function(e,t){},e.prototype.removeEventListener=function(e,t){},e.prototype.on=function(e,t){},e.prototype.off=function(e,t){},e.prototype.sslset=function(e){this.voxSignaling.writeLog=e},e.prototype.sslget=function(){return this.voxSignaling.getLog()},e.prototype.getZingayaAPI=function(){return new y.ZingayaAPI(this)},e.prototype.getMediaCache=function(){return m.MediaCache.get()},e.prototype.registerForPushNotificatuons=function(e){return L.PushService.register(e)},e.prototype.unregisterForPushNotificatuons=function(e){return L.PushService.unregister(e)},e.prototype.handlePushNotification=function(e){return L.PushService.incomingPush(e)},e.prototype.getGUID=function(){return(new S.GUID).toString()},e.prototype.setSilentLogging=function(e){l.LogManager.get().shadowLogging=e},e.prototype.getSilentLog=function(){return l.LogManager.get().getSLog()},r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"deviceEnumAPI",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"playProgressTone",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"stopProgressTone",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"onIncomingCall",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"checkConnection",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"init",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"call",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"config",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"connect",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"connectTo",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"disconnect",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"setOperatorACDStatus",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"login",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"loginWithCode",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"loginWithToken",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"tokenRefresh",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"requestOneTimeLoginKey",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"loginWithOneTimeKey",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"connected",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"showLocalVideo",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"setLocalVideoPosition",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"setLocalVideoSize",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"setVideoSettings",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"setVideoBandwidth",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"playToneScript",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"stopPlayback",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"volume",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"audioSources",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"videoSources",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"audioOutputs",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"useAudioSource",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"useVideoSource",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"useAudioOutput",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"attachRecordingDevice",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"detachRecordingDevice",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"setCallActive",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"sendVideo",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"isRTCsupported",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"transferCall",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"setLogLevel",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"setLogLevelAll",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"onSignalingConnected",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"onSignalingClosed",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"onSignalingConnectionFailed",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"onMediaConnectionFailed",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"getCall",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"removeCall",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"dispatchEvent",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"addEventListener",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"removeEventListener",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"on",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e.prototype,"off",null),r([l.LogManager.d_trace(l.LogCategory.CLIENT)],e,"getInstance",null),e}();t.Client=E},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},o=n(19),i=n(3),a=n(4),s=n(1),c=n(6),d=n(14),l=n(5),u=n(2),p=n(13),g=function(){function e(){var e=this;this.iceConfig=null,this._peerConnections={},this.waitingPeerConnections={},this.log=s.LogManager.get().createLogger(s.LogCategory.RTC,"PCFactory"),this._requireMedia=!0,i.VoxSignaling.get().setRPCHandler(p.RemoteEvent.createPC,function(t,n){e.rpcHandlerCreatePC(t,n)}),i.VoxSignaling.get().setRPCHandler(p.RemoteEvent.destroyPC,function(t){e.rpcHandlerDestroyPC(t)}),i.VoxSignaling.get().addHandler(this)}return e.get=function(){return null===this.inst&&(this.inst=new e),this.inst},e.sdpOffersVideo=function(e){return{receiveVideo:e.indexOf("m=video")!==-1,sendVideo:!0}},e.prototype.rpcHandlerCreatePC=function(t,n){return a.UserMediaManager.get().currentStream||!this._requireMedia?(i.VoxSignaling.get().callRemoteFunction(u.RemoteFunction.muteLocal,t,!1),i.VoxSignaling.get().callRemoteFunction(u.RemoteFunction.muteLocal,t,!1),this.createPC(t,n,o.PeerConnectionMode.CLIENT_SERVER_V1,e.sdpOffersVideo(n))):void(this.waitingPeerConnections[t]=n)},e.prototype.rpcHandlerDestroyPC=function(e){this._peerConnections[e]&&(this._peerConnections[e].close(),delete this._peerConnections[e]),delete this.waitingPeerConnections[e]},e.prototype.createPC=function(e,t,n,r){var o=this,s=l.default.peerConnectionFactory(e,n,r);a.UserMediaManager.get().attachTo(s),this._peerConnections[e]=s;
var p=c.CallManager.get().calls[e];return t&&s.processRemoteOffer(t).then(function(t){"undefined"==typeof p||p.checkCallMode(d.CallMode.SERVER)?i.VoxSignaling.get().callRemoteFunction(u.RemoteFunction.confirmPC,e,t):i.VoxSignaling.get().callRemoteFunction(u.RemoteFunction.acceptCall,[e,c.CallManager.cleanHeaders(p.headers()),t]),"__default"!==e&&"undefined"!=typeof c.CallManager.get().calls[e]&&(c.CallManager.get().calls[e].peerConnection=s)}).catch(function(e){o.log.error("Error during PC creation: "+e)}),s},e.prototype.setupDirectPC=function(e,t,n,r){var o=this,i=l.default.peerConnectionFactory(e,t,n);if(i.setHoldKey(r),n.sendVideo){var s=a.UserMediaManager.get().getConstrainWithSendFlag(!0,n.sendVideo);return i.setVideoEnabled(n),a.UserMediaManager.get().getQueryMediaSilent(s).then(function(t){return i.bindLocalMedia(t),o._peerConnections[e]=i,i.getLocalOffer()})}return a.UserMediaManager.get().attachToSound(i),this._peerConnections[e]=i,i.getLocalOffer()},e.prototype.incomeDirectPC=function(e,t,n,r){var i=l.default.peerConnectionFactory(e,o.PeerConnectionMode.P2P,t);return i.setHoldKey(r),i._setRemoteDescription(n),this._peerConnections[e]=i,i},e.prototype.getPeerConnect=function(e){return this._peerConnections[e]},e.prototype.onMediaAccessRejected=function(){},e.prototype.onMediaAccessGranted=function(t){for(var n in this.waitingPeerConnections)this.createPC(n,this.waitingPeerConnections[n],o.PeerConnectionMode.CLIENT_SERVER_V1,e.sdpOffersVideo(this.waitingPeerConnections[n]));this.waitingPeerConnections={}},e.prototype.onSignalingConnected=function(){},e.prototype.onSignalingClosed=function(){this.log.info("Closing all peer connections because signaling connection has closed"),this.waitingPeerConnections={};for(var e in this._peerConnections)this._peerConnections[e].close();this._peerConnections={}},e.prototype.onSignalingConnectionFailed=function(e){},e.prototype.onMediaConnectionFailed=function(){},Object.defineProperty(e.prototype,"requireMedia",{get:function(){return this._requireMedia},set:function(e){this._requireMedia=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"peerConnections",{get:function(){return this._peerConnections},enumerable:!0,configurable:!0}),e.prototype.closeAll=function(){for(var e in this._peerConnections)this._peerConnections[e].close();this._peerConnections={}},e.prototype.setBandwidthParams=function(e){this._bandwidthParams=e},e.prototype.addBandwidthParams=function(e){return this._bandwidthParams&&(e.sdp=e.sdp.replace(/(a=mid:video.*\r\n)/g,"$1b=AS:"+this._bandwidthParams+"\r\n")),e},e.inst=null,r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"rpcHandlerCreatePC",null),r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"rpcHandlerDestroyPC",null),r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"createPC",null),r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"setupDirectPC",null),r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"incomeDirectPC",null),r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"getPeerConnect",null),r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"onMediaAccessRejected",null),r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"onMediaAccessGranted",null),r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"onSignalingConnected",null),r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"onSignalingClosed",null),r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"onSignalingConnectionFailed",null),r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"onMediaConnectionFailed",null),r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"closeAll",null),r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"setBandwidthParams",null),r([s.LogManager.d_trace(s.LogCategory.PCFACTORY)],e.prototype,"addBandwidthParams",null),e}();t.PCFactory=g},function(e,t){"use strict";var n=!0,r=!0,o={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(n=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(r=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(n)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){r&&console.warn(e+" is deprecated, please use "+t+" instead.")},extractVersion:function(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)},detectBrowser:function(e){var t=e&&e.navigator,n={};if(n.browser=null,n.version=null,"undefined"==typeof e||!e.navigator)return n.browser="Not a browser.",n;if(t.mozGetUserMedia)n.browser="firefox",n.version=this.extractVersion(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)if(e.webkitRTCPeerConnection)n.browser="chrome",n.version=this.extractVersion(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!t.userAgent.match(/Version\/(\d+).(\d+)/))return n.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",n;n.browser="safari",n.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=this.extractVersion(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!t.mediaDevices||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return n},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype){var n=t.createObjectURL.bind(t),r=t.revokeObjectURL.bind(t),i=new Map,a=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++a;return i.set(t,e),o.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return n(e)},t.revokeObjectURL=function(e){r(e),i.delete(e)};var s=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return s.get.apply(this)},set:function(e){return this.srcObject=i.get(e)||null,s.set.apply(this,[e])}});var c=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=i.get(arguments[1])||null),c.apply(this,arguments)}}}};e.exports={log:o.log,deprecated:o.deprecated,disableLog:o.disableLog,disableWarnings:o.disableWarnings,extractVersion:o.extractVersion,shimCreateObjectURL:o.shimCreateObjectURL,detectBrowser:o.detectBrowser.bind(o)}},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},o=n(3),i=n(1),a=n(8),s=n(2),c=n(13),d=n(16);!function(e){e[e.IDLE=0]="IDLE",e[e.IN_PROGRESS=1]="IN_PROGRESS"}(t.AuthenticatorState||(t.AuthenticatorState={}));var l=t.AuthenticatorState,u=function(){function e(){var e=this;this.FAIL_CODE_SECOND_STAGE=301,this.FAIL_CODE_ONE_TIME_KEY=302,this._displayName=null,this._username=null,this._authorized=!1,this.signaling=o.VoxSignaling.get(),this.currentState=l.IDLE,this.log=i.LogManager.get().createLogger(i.LogCategory.SIGNALING,"Authenticator"),this.signaling.setRPCHandler(c.RemoteEvent.loginFailed,function(t,n){e.onLoginFailed(t,n)}),this.signaling.setRPCHandler(c.RemoteEvent.loginSuccessful,function(t,n){e.onLoginSuccesful(t,n)}),this.signaling.setRPCHandler(c.RemoteEvent.refreshOauthTokenFailed,function(t){e.handler.onRefreshTokenFailed(t)}),this.signaling.setRPCHandler(c.RemoteEvent.refreshOauthTokenSuccessful,function(t){e.handler.onRefreshTokenSuccess(t.OAuth)}),this.signaling.addHandler(this)}return e.get=function(){return"undefined"==typeof this.inst&&(this.inst=new e),this.inst},e.prototype.setHandler=function(e){this.handler=e},e.prototype.onLoginFailed=function(e,t){switch(this.currentState=l.IDLE,e){case this.FAIL_CODE_ONE_TIME_KEY:this.handler.onOneTimeKeyGenerated(t);break;case this.FAIL_CODE_SECOND_STAGE:this.handler.onSecondStageInitiated();break;default:this.handler.onLoginFailed(e)}},e.prototype.onLoginSuccesful=function(e,t){this.currentState=l.IDLE,this._authorized=!0,t&&(a.PCFactory.get().iceConfig=t.iceConfig),this._displayName=e,d.CallstatsIo.get().init({userName:this._username,aliasName:this._displayName}),this.handler.onLoginSuccessful(e,t.OAuth)},Object.defineProperty(e.prototype,"displayName",{get:function(){return this._displayName},enumerable:!0,configurable:!0}),e.prototype.basicLogin=function(e,t,n){return this.currentState!=l.IDLE?void this.log.error("Login operation already in progress"):(this._username=e,this.currentState=l.IN_PROGRESS,void this.signaling.callRemoteFunction(s.RemoteFunction.login,e,t,n))},e.prototype.tokenLogin=function(e,t){return this.currentState!=l.IDLE?void this.log.error("Login operation already in progress"):(this._username=e,this.currentState=l.IN_PROGRESS,void this.signaling.callRemoteFunction(s.RemoteFunction.login,e,"",t))},e.prototype.tokenRefresh=function(e,t,n){n?this.signaling.callRemoteFunction(s.RemoteFunction.refreshOauthToken,e,{refreshToken:t,deviceToken:n}):this.signaling.callRemoteFunction(s.RemoteFunction.refreshOauthToken,e,t)},e.prototype.loginUsingOneTimeKey=function(e,t,n){return this.currentState!=l.IDLE?void this.log.error("Login operation already in progress"):(this._username=e,this.currentState=l.IN_PROGRESS,void this.signaling.callRemoteFunction(s.RemoteFunction.loginUsingOneTimeKey,e,t,n))},e.prototype.loginStage2=function(e,t,n){return this.currentState!=l.IDLE?void this.log.error("Login operation already in progress"):(this._username=e,this.currentState=l.IN_PROGRESS,void this.signaling.callRemoteFunction(s.RemoteFunction.loginStage2,e,t,n))},e.prototype.generateOneTimeKey=function(e){return this.currentState!=l.IDLE?void this.log.error("Login operation already in progress"):(this.currentState=l.IN_PROGRESS,void this.signaling.callRemoteFunction(s.RemoteFunction.loginGenerateOneTimeKey,e))},e.prototype.username=function(){return this._username},e.prototype.authorized=function(){return this._authorized},e.prototype.onSignalingConnected=function(){},e.prototype.onSignalingConnectionFailed=function(e){},e.prototype.onSignalingClosed=function(){this._authorized=!1,this._displayName=null,this._username=null},e.prototype.onMediaConnectionFailed=function(){},e.prototype.ziAuthorized=function(e){this._authorized=e},r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"setHandler",null),r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"onLoginFailed",null),r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"onLoginSuccesful",null),r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"basicLogin",null),r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"tokenLogin",null),r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"tokenRefresh",null),r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"loginUsingOneTimeKey",null),r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"loginStage2",null),r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"generateOneTimeKey",null),r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"username",null),r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"authorized",null),r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"onSignalingConnected",null),r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"onSignalingConnectionFailed",null),r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"onSignalingClosed",null),r([i.LogManager.d_trace(i.LogCategory.AUTHENTICATOR)],e.prototype,"onMediaConnectionFailed",null),e}();t.Authenticator=u},function(e,t){"use strict";!function(e){e[e.Connected="Connected"]="Connected",e[e.Disconnected="Disconnected"]="Disconnected",e[e.Failed="Failed"]="Failed",e[e.ProgressToneStart="ProgressToneStart"]="ProgressToneStart",e[e.ProgressToneStop="ProgressToneStop"]="ProgressToneStop",e[e.MessageReceived="onSendMessage"]="MessageReceived",e[e.InfoReceived="InfoReceived"]="InfoReceived",e[e.TransferComplete="TransferComplete"]="TransferComplete",e[e.TransferFailed="TransferFailed"]="TransferFailed",e[e.ICETimeout="ICETimeout"]="ICETimeout",e[e.RTCStatsReceived="RTCStatsReceived"]="RTCStatsReceived",e[e.MediaElementCreated="MediaElementCreated"]="MediaElementCreated",e[e.ICECompleted="ICECompleted"]="ICECompleted",e[e.Updated="Updated"]="Updated",e[e.PendingUpdate="PendingUpdate"]="PendingUpdate",e[e.UpdateFailed="UpdateFailed"]="UpdateFailed",e[e.LocalVideoStreamAdded="LocalVideoStreamAdded"]="LocalVideoStreamAdded"}(t.CallEvents||(t.CallEvents={}));t.CallEvents},function(e,t){"use strict";var n=function(){function e(){}return e.DIRECT_CALL_HEADER="X-DirectCall",e.VIAMEDIA_CALL_HEADER="X-ViaMedia",e.CALLSTATSIOID_HEADER="X-CallstatsIOID",e.CALL_DATA_HEADER="VI-CallData",e.ZINGAYA_IM_MIME_TYPE="application/zingaya-im",e.P2P_SPD_FRAG_MIME_TYPE="voximplant/sdpfrag",e.VI_HOLD_EMUL="vi/holdemul",e.VI_SPD_OFFER_MIME_TYPE="vi/sdpoffer",e.VI_SPD_ANSWER_MIME_TYPE="vi/sdpanswer",e}();t.Constants=n},function(e,t){"use strict";!function(e){e[e.loginFailed="loginFailed"]="loginFailed",e[e.loginSuccessful="loginSuccessful"]="loginSuccessful",e[e.handleError="handleError"]="handleError",e[e.onPCStats="__onPCStats"]="onPCStats",e[e.handleIncomingConnection="handleIncomingConnection"]="handleIncomingConnection",e[e.handleConnectionConnected="handleConnectionConnected"]="handleConnectionConnected",e[e.handleConnectionDisconnected="handleConnectionDisconnected"]="handleConnectionDisconnected",e[e.handleRingOut="handleRingOut"]="handleRingOut",e[e.startEarlyMedia="startEarlyMedia"]="startEarlyMedia",e[e.stopRinging="stopRinging"]="stopRinging",e[e.handleConnectionFailed="handleConnectionFailed"]="handleConnectionFailed",e[e.handleSIPInfo="handleSIPInfo"]="handleSIPInfo",e[e.handleSipEvent="handleSipEvent"]="handleSipEvent",e[e.handleTransferStarted="handleTransferStarted"]="handleTransferStarted",e[e.handleTransferComplete="handleTransferComplete"]="handleTransferComplete",e[e.handleTransferFailed="handleTransferFailed"]="handleTransferFailed",e[e.handleReInvite="handleReInvite"]="handleReInvite",e[e.handleAcceptReinvite="handleAcceptReinvite"]="handleAcceptReinvite",e[e.handleRejectReinvite="handleRejectReinvite"]="handleRejectReinvite",e[e.createPC="__createPC"]="createPC",e[e.destroyPC="__destroyPC"]="destroyPC",e[e.connectionSuccessful="__connectionSuccessful"]="connectionSuccessful",e[e.connectionFailed="__connectionFailed"]="connectionFailed",e[e.createConnection="__createConnection"]="createConnection",e[e.pong="__pong"]="pong",e[e.increaseGain="increaseGain"]="increaseGain",e[e.handlePreFlightCheckResult="handlePreFlightCheckResult"]="handlePreFlightCheckResult",e[e.handleVoicemail="handleVoicemail"]="handleVoicemail",e[e.onCallRemoteFunctionError="onCallRemoteFunctionError"]="onCallRemoteFunctionError",e[e.refreshOauthTokenFailed="refreshOauthTokenFailed"]="refreshOauthTokenFailed",e[e.refreshOauthTokenSuccessful="refreshOauthTokenSuccessful"]="refreshOauthTokenSuccessful"}(t.RemoteEvent||(t.RemoteEvent={}));t.RemoteEvent},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},o=n(11),i=n(3),a=n(12),s=n(1),c=n(4),d=n(8),l=n(6),u=n(5),p=n(2),g=n(38),f=n(7);!function(e){e[e.ALERTING="ALERTING"]="ALERTING",e[e.PROGRESSING="PROGRESSING"]="PROGRESSING",e[e.CONNECTED="CONNECTED"]="CONNECTED",e[e.UPDATING="UPDATING"]="UPDATING",e[e.ENDED="ENDED"]="ENDED"}(t.CallState||(t.CallState={}));var h=t.CallState;!function(e){e[e.P2P=0]="P2P",e[e.SERVER=1]="SERVER"}(t.CallMode||(t.CallMode={}));var v=t.CallMode,C=function(){function e(e,t,n,r){this.eventListeners={},this.remoteMuteState=!0,this.signalingConnected=!1,this._id=e,this._num=r.number,this._displayName=t,this._headers=r.extraHeaders,this._state=n?h.ALERTING:h.PROGRESSING,this._mode=v.P2P,this._setupWiredLocal=r.wiredLocal,this._wiredLocal=r.wiredLocal,this._setupWiredRemote=r.wiredLocal,this._wiredRemote=r.wiredLocal,this._active=!0,this._usedSinkId=null,this.log=s.LogManager.get().createLogger(s.LogCategory.CALL,"Call "+e),this._callManager=l.CallManager.get(),this.audioDirections={sendAudio:!1},"boolean"==typeof r.video?this.videoDirections={sendVideo:r.video,receiveVideo:!0}:this.videoDirections=r.video,this.hasEarlyMedia=!1}return e.prototype.id=function(){return this._id},e.prototype.number=function(){return this._num},e.prototype.displayName=function(){return this._displayName},e.prototype.headers=function(){return this._headers},e.prototype.active=function(){return this._active},e.prototype.state=function(){return h[this._state]},Object.defineProperty(e.prototype,"stateValue",{get:function(){return this._state},enumerable:!0,configurable:!0}),e.prototype.answer=function(e,t,n){if("undefined"!=typeof e&&("undefined"!=typeof t&&"object"==typeof t||(t={}),t[a.Constants.CALL_DATA_HEADER]=e),"undefined"!=typeof n&&(n={sendVideo:f.Client.getInstance().config().videoSupport,receiveVideo:f.Client.getInstance().config().videoSupport}),this._state!=h.ALERTING)throw new Error("WRONG_CALL_STATE");"undefined"!=typeof n&&this._peerConnection.setVideoFlags(n)},e.prototype.decline=function(e){this.reject(e)},e.prototype.reject=function(e){if(this._state!=h.ALERTING)throw new Error("WRONG_CALL_STATE");i.VoxSignaling.get().callRemoteFunction(p.RemoteFunction.rejectCall,this._id,!0,l.CallManager.cleanHeaders(e))},e.prototype.hangup=function(e){if(this._state==h.CONNECTED||this._state==h.UPDATING||this._state==h.PROGRESSING)i.VoxSignaling.get().callRemoteFunction(p.RemoteFunction.disconnectCall,this._id,l.CallManager.cleanHeaders(e));else{if(this._state!=h.ALERTING)throw new Error("WRONG_CALL_STATE");i.VoxSignaling.get().callRemoteFunction(p.RemoteFunction.rejectCall,this._id,!0,l.CallManager.cleanHeaders(e))}},e.prototype.sendTone=function(e){this._active&&this._peerConnection.sendDTMF(e)},e.prototype.mutePlayback=function(){this.remoteMuteState=!1,c.UserMediaManager.updateMuteState(this._id,c.MediaDirection.REMOTE,!1)},e.prototype.unmutePlayback=function(){this.remoteMuteState=!0,c.UserMediaManager.updateMuteState(this._id,c.MediaDirection.REMOTE,!0)},e.prototype.restoreRMute=function(){c.UserMediaManager.updateMuteState(this._id,c.MediaDirection.REMOTE,this.remoteMuteState)},e.prototype.muteMicrophone=function(){this.peerConnection.muteMicrophone(!0)},e.prototype.unmuteMicrophone=function(){this.peerConnection.muteMicrophone(!1)},e.prototype.showRemoteVideo=function(e){void 0===e&&(e=!0),"undefined"==typeof e&&(e=!0),this.peerConnection.videoRenderer&&(this.peerConnection.videoRenderer.style.display=e?"block":"none")},e.prototype.setRemoteVideoPosition=function(e,t){throw new Error("Deprecated: please use CSS to position '#voximplantcontainer' element")},e.prototype.setRemoteVideoSize=function(e,t){throw new Error("Deprecated: please use CSS to set size of '#voximplantcontainer' element")},e.prototype.sendInfo=function(e,t,n){var r,o,a=e.indexOf("/");a==-1?(r="application",o=e):(r=e.substring(0,a),o=e.substring(a+1)),i.VoxSignaling.get().callRemoteFunction(p.RemoteFunction.sendSIPInfo,this._id,r,o,t,l.CallManager.cleanHeaders(n))},e.prototype.sendMessage=function(e){this.sendInfo(a.Constants.ZINGAYA_IM_MIME_TYPE,e,{})},e.prototype.setVideoSettings=function(e,t,n){c.UserMediaManager.get().setConstraints(e,!0).then(function(e){"function"==typeof t&&t(e)}).catch(function(e){"function"==typeof n&&n(e)})},e.prototype.getVideoElementId=function(){if(this.peerConnection&&this._wiredRemote){var e=this.peerConnection.videoRenderer;return null!=e?e.id:null}return null},e.prototype.addEventListener=function(e,t){"undefined"==typeof this.eventListeners[e]&&(this.eventListeners[e]=[]),this.eventListeners[e].push(t)},e.prototype.on=function(e,t){this.addEventListener(e,t)},e.prototype.removeEventListener=function(e,t){if("undefined"!=typeof this.eventListeners[e])if("function"==typeof t){for(var n=0;n<this.eventListeners[e].length;n++)if(this.eventListeners[e][n]==t){this.eventListeners[e].splice(n,1);break}}else this.eventListeners[e]=[]},e.prototype.off=function(e,t){this.removeEventListener(e,t)},e.prototype.dispatchEvent=function(e){var t=e.name;if(t!==o.CallEvents.Updated&&t!==o.CallEvents.UpdateFailed||(this._state=h.CONNECTED),"undefined"!=typeof this.eventListeners[t])for(var n=0;n<this.eventListeners[t].length;n++)"function"==typeof this.eventListeners[t][n]&&this.eventListeners[t][n](e)},e.prototype.checkState=function(e,t){if(e)if("string"!=typeof e){for(var n=!1,r=e,o=0;o<r.length;o++)r[o]==this._state&&(n=!0);if(!n)return this.log.warning("Received "+t+" in invalid state "+this._state),!1}else if(this._state!=e)return this.log.warning("Received "+t+" in invalid state "+this._state),!1;return!0},e.prototype.onConnected=function(e,t){if(this.signalingConnected)return!!this.checkState([h.PROGRESSING,h.ALERTING],"onConnected")&&(this._state=h.CONNECTED,this.dispatchEvent({name:"Connected",call:this,headers:e}),!0)},e.prototype.onDisconnected=function(e,t){return!!this.checkState([h.CONNECTED,h.ALERTING,h.PROGRESSING,h.UPDATING],"onDisconnected")&&(this._state=h.ENDED,this.dispatchEvent({name:"Disconnected",call:this,headers:e,params:t}),g.ReusableRenderer.get().freeRendersByCallId(this._id),!0)},e.prototype.onFailed=function(e,t,n){return this.dispatchEvent({name:"Failed",call:this,headers:n,code:e,reason:t}),this._state=h.ENDED,g.ReusableRenderer.get().freeRendersByCallId(this._id),!0},e.prototype.onStopRinging=function(){return!!this.checkState([h.PROGRESSING,h.CONNECTED],"onStopRinging")&&(this.dispatchEvent({name:"ProgressToneStop",call:this}),!0)},e.prototype.onRingOut=function(){return!!this.checkState(h.PROGRESSING,"onRingOut")&&(this.dispatchEvent({name:"ProgressToneStart",call:this}),!0)},e.prototype.onTransferComplete=function(){return!!this.checkState(h.CONNECTED,"onTransferComplete")&&(this.dispatchEvent({name:"TransferComplete",call:this}),!0)},e.prototype.onTransferFailed=function(){return!!this.checkState(h.CONNECTED,"onTransferFailed")&&(this.dispatchEvent({name:"TransferFailed",call:this}),!0)},e.prototype.onInfo=function(e,t,n,r,o){if(e.stateValue==h.CONNECTED||e.stateValue==h.PROGRESSING||e.stateValue==h.ALERTING){var i=t+"/"+n;if(i==a.Constants.ZINGAYA_IM_MIME_TYPE)this.dispatchEvent({name:"onSendMessage",call:this,text:r});else if(i==a.Constants.P2P_SPD_FRAG_MIME_TYPE){var s=JSON.parse(r);for(var c in s)e.peerConnection.addRemoteCandidate(s[c][1],s[c][0])}else i==a.Constants.VI_SPD_OFFER_MIME_TYPE?e.peerConnection.processRemoteOffer(r):i==a.Constants.VI_SPD_ANSWER_MIME_TYPE?e.peerConnection.processRemoteAnswer({},r):this.dispatchEvent({name:"InfoReceived",call:this,body:r,headers:o,mimeType:i});return!0}this.log.warning("received handleSIPInfo for call: "+e.id()+" in invalid state: "+e.state())},e.prototype.setActive=function(e){var t=this;return new Promise(function(n,r){return"firefox"===u.default.getWSVendor()?(t.sendInfo(a.Constants.VI_HOLD_EMUL,JSON.stringify({hold:!e})),void n({call:t,result:!0})):void(t._state==h.CONNECTED?(t._state=h.UPDATING,t._active=e,e?i.VoxSignaling.get().callRemoteFunction(p.RemoteFunction.unhold,t._id):i.VoxSignaling.get().callRemoteFunction(p.RemoteFunction.hold,t._id),n({result:!0,call:t})):r({code:11,call:t}))})},Object.defineProperty(e.prototype,"promise",{get:function(){return this._promise},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"peerConnection",{get:function(){return this._peerConnection},set:function(e){this._peerConnection=e},enumerable:!0,configurable:!0}),e.prototype.checkCallMode=function(e){return this._mode==e},e.prototype.canStartSendingCandidates=function(){"undefined"==typeof this._peerConnection&&(this._peerConnection=d.PCFactory.get().peerConnections[this._id]),this._peerConnection.canStartSendingCandidates()},e.prototype.notifyICETimeout=function(){this.dispatchEvent({name:"ICETimeout",call:this})},e.prototype.sendVideo=function(e){return this.videoDirections.sendVideo===e?new Promise(function(e,t){t()}):this.sendMedia(null,e)},e.prototype.receiveVideo=function(){var e=this;return this._state=h.UPDATING,new Promise(function(t,n){return e.videoDirections.receiveVideo===!0?void n():(e.videoDirections.receiveVideo=!0,void e._peerConnection.hdnFRS().then(t,n))})},e.prototype.sendMedia=function(e,t){var n=this;return this._state=h.UPDATING,this.peerConnection.sendMedia(e,t).then(function(r){return"undefined"!=typeof t&&null!==t?n.videoDirections.sendVideo=t:t=n.videoDirections.sendVideo,"undefined"!=typeof e&&null!==e?n.audioDirections.sendAudio=e:e=n.audioDirections.sendAudio,r})},e.prototype.sendAudio=function(e){return this._state=h.UPDATING,this.sendMedia(e,null)},e.prototype.getLocalStream=function(){var e=this;return this._wiredLocal?new Promise(function(t,n){e.peerConnection?t(e.peerConnection.localStream):n(new Error("We have no PC for this call yet"))}):c.UserMediaManager.get().queryMedia()},e.prototype.setLocalStream=function(e){return new Promise(function(e,t){t(new Error("Not implemented"))})},e.prototype.shareScreen=function(e){return void 0===e&&(e=!1),this._state=h.UPDATING,this.peerConnection.shareScreen(e)},e.prototype.stopSharingScreen=function(){return this._state=h.UPDATING,this.peerConnection.stopSharingScreen()},e.prototype.addLocalStream=function(e,t){return void 0===t&&(t=!1),this._state=h.UPDATING,this.peerConnection.addMediaStream(e,t)},e.prototype.wireRemoteStream=function(){var e=this;return new Promise(function(t,n){e.peerConnection?"undefined"!=typeof e.peerConnection.remoteStreams[0]?e.peerConnection.wireRemoteStream(!0).then(function(){e._wiredRemote=!0,t()}).catch(n):n(new Error("We have no remote MediaStream for this call yet")):n(new Error("We have no PC for this call yet"))})},e.prototype.getRemoteAudioStreams=function(){var e=this;return new Promise(function(t,n){e.peerConnection?(e.peerConnection.remoteStreams.forEach(function(e){if(e.getAudioTracks().length)return void t(new MediaStream(e.getAudioTracks()))}),n(new Error("We have no remote MediaStream for this call yet"))):n(new Error("We have no PC for this call yet"))})},e.prototype.getRemoteVideoStreams=function(){var e=this;return new Promise(function(t,n){e.peerConnection?"undefined"!=typeof e.peerConnection.remoteStreams[0]&&0!=e.peerConnection.remoteStreams[0].getVideoTracks().length?t(new MediaStream(e.peerConnection.remoteStreams[0].getVideoTracks())):n(new Error("We have no remote MediaStream for this call yet")):n(new Error("We have no PC for this call yet"))})},e.prototype.getRemoteWiredState=function(){return this._wiredRemote},e.prototype.getLocalWiredState=function(){return this._wiredLocal},e.prototype.useAudioOutput=function(e){return this.peerConnection.updateRenderersSink(e)},e.prototype.getAudioElementId=function(){return(this._peerConnection.remoteStreams.length=0)?null:(this._peerConnection.remoteStreams[0].getAudioTracks().length=0)?null:this._peerConnection.remoteStreams[0].getAudioTracks()[0].id},e.prototype.getDirections=function(){if("undefined"!=typeof this.peerConnection)return this.peerConnection.getDirections()},e.prototype.getStreamActivity=function(){return{}},e.prototype.hdnFRS=function(){this.peerConnection._hdnFRS()},e.prototype.hdnFRSPrep=function(){var e=this;"undefined"!=typeof this.peerConnection?this.peerConnection._hdnFRSPrep():setTimeout(function(){e.hdnFRSPrep()},1e3)},e.prototype.runIncomingReInvite=function(e,t){var n=this;if(this._state===h.UPDATING)this.dispatchEvent({code:11,call:this});else{this._state=h.UPDATING;var r=l.CallManager.get().isSDPHasVideo(t);this.peerConnection.handleReinvite(e,t,r).then(function(){n.peerConnection.restoreMute()})}},e.prototype.setActiveForce=function(e){this._active=e},r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"id",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"number",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"displayName",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"headers",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"active",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"state",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"answer",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"decline",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"reject",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"hangup",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"sendTone",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"mutePlayback",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"unmutePlayback",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"restoreRMute",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"muteMicrophone",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"unmuteMicrophone",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"showRemoteVideo",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"setRemoteVideoPosition",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"setRemoteVideoSize",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"sendInfo",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"sendMessage",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"setVideoSettings",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"getVideoElementId",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"addEventListener",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"on",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"removeEventListener",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"off",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"dispatchEvent",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"checkState",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"onConnected",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"onDisconnected",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"onFailed",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"onStopRinging",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"onRingOut",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"onTransferComplete",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"onTransferFailed",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"onInfo",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"setActive",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"checkCallMode",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"canStartSendingCandidates",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"notifyICETimeout",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"sendVideo",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"receiveVideo",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"sendAudio",null),
r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"getLocalStream",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"setLocalStream",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"addLocalStream",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"wireRemoteStream",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"getRemoteAudioStreams",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"getRemoteVideoStreams",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"getRemoteWiredState",null),r([s.LogManager.d_trace(s.LogCategory.CALL)],e.prototype,"getLocalWiredState",null),r([s.LogManager.d_trace(s.LogCategory.CLIENT)],e.prototype,"useAudioOutput",null),r([s.LogManager.d_trace(s.LogCategory.CLIENT)],e.prototype,"getAudioElementId",null),r([s.LogManager.d_trace(s.LogCategory.CLIENT)],e.prototype,"getStreamActivity",null),r([s.LogManager.d_trace(s.LogCategory.CLIENT)],e.prototype,"hdnFRS",null),r([s.LogManager.d_trace(s.LogCategory.CLIENT)],e.prototype,"hdnFRSPrep",null),r([s.LogManager.d_trace(s.LogCategory.CLIENT)],e.prototype,"runIncomingReInvite",null),r([s.LogManager.d_trace(s.LogCategory.CLIENT)],e.prototype,"setActiveForce",null),e}();t.Call=C},function(e,t,n){"use strict";var r=n(3),o=n(2),i=function(){function e(e){this._id=e}return e.prototype.insertDTMF=function(e,t,n){var r=this;e.split("").forEach(function(e){return r.sendKey(e)})},e.prototype.sendKey=function(e){var t;t="*"==e?10:"#"==e?11:parseInt(e),(t>=0||t<=11)&&r.VoxSignaling.get().callRemoteFunction(o.RemoteFunction.sendDTMF,this._id,t)},e}();t.SignalingDTMFSender=i},function(e,t,n){"use strict";var r=n(1);!function(e){e[e.multiplex="multiplex"]="multiplex",e[e.audio="audio"]="audio",e[e.video="video"]="video",e[e.screen="screen"]="screen",e[e.data="data"]="data",e[e.unbundled="unbundled"]="unbundled"}(t.CallstatsIoFabricUsage||(t.CallstatsIoFabricUsage={}));t.CallstatsIoFabricUsage;!function(e){e[e.fabricHold="fabricHold"]="fabricHold",e[e.fabricResume="fabricResume"]="fabricResume",e[e.audioMute="audioMute"]="audioMute",e[e.audioUnmute="audioUnmute"]="audioUnmute",e[e.videoPause="videoPause"]="videoPause",e[e.videoResume="videoResume"]="videoResume",e[e.fabricTerminated="fabricTerminated"]="fabricTerminated",e[e.screenShareStart="screenShareStart"]="screenShareStart",e[e.screenShareStop="screenShareStop"]="screenShareStop",e[e.dominantSpeaker="dominantSpeaker"]="dominantSpeaker",e[e.activeDeviceList="activeDeviceList"]="activeDeviceList"}(t.CallstatsIoFabricEvent||(t.CallstatsIoFabricEvent={}));t.CallstatsIoFabricEvent;!function(e){e[e.getUserMedia="getUserMedia"]="getUserMedia",e[e.createOffer="createOffer"]="createOffer",e[e.createAnswer="createAnswer"]="createAnswer",e[e.setLocalDescription="setLocalDescription"]="setLocalDescription",e[e.setRemoteDescription="setRemoteDescription"]="setRemoteDescription",e[e.addIceCandidate="addIceCandidate"]="addIceCandidate",e[e.iceConnectionFailure="iceConnectionFailure"]="iceConnectionFailure",e[e.signalingError="signalingError"]="signalingError",e[e.applicationLog="applicationLog"]="applicationLog"}(t.CallstatsioWrtcFuncNames||(t.CallstatsioWrtcFuncNames={}));var o=(t.CallstatsioWrtcFuncNames,function(){function e(e){this._params=e,this.inited=!1,this.pendingFabric=[];var t=window;"undefined"!=typeof t.callstats&&(this.callstats=new t.callstats(null,t.io))}return e.isModuleEnabled=function(){return e.moduleEnabled},e.get=function(t){var n=window;return"undefined"!=typeof n.callstats&&(e.moduleEnabled=!0),"undefined"==typeof e.instance&&(e.instance=new e(t)),"undefined"!=typeof t&&(e.instance._params=t),e.instance},e.prototype.init=function(t){var n=this;return!!e.moduleEnabled&&(r.LogManager.get().writeMessage(r.LogCategory.UTILS,"[CallstatsIo]",r.LogLevel.INFO," Callstats.io SDK initialization start"),this.callstats.initialize(this._params.AppID,this._params.AppSecret,t,function(){r.LogManager.get().writeMessage(r.LogCategory.UTILS,"[CallstatsIo]",r.LogLevel.INFO," Callstats.io SDK initialization successful"),n.inited=!0,n.pendingFabric.map(function(e){n.callstats.addNewFabric(e.pc,e.remoteUser,e.fabricUsage,e.callID)})},function(){},this.packParams()),!0)},e.prototype.packParams=function(){var e={};return this._params.disableBeforeUnloadHandler&&(e.disableBeforeUnloadHandler=this._params.disableBeforeUnloadHandler),this._params.applicationVersion&&(e.applicationVersion=this._params.applicationVersion),e},e.prototype.addNewFabric=function(t,n,o,i){return!!e.moduleEnabled&&void(this.inited?(r.LogManager.get().writeMessage(r.LogCategory.UTILS,"[CallstatsIo]",r.LogLevel.INFO," Callstats.io addNewFabric"),this.callstats.addNewFabric(t,n,o,i)):this.pendingFabric.push({pc:t,remoteUser:n,fabricUsage:o,callID:i}))},e.prototype.sendFabricEvent=function(t,n,r){return!!e.moduleEnabled&&void this.callstats.sendFabricEvent(t,n,r)},e.prototype.reportError=function(t,n,r,o,i,a){return!!e.moduleEnabled&&void this.callstats.reportError(t,n,r,o,i,a)},e.moduleEnabled=!1,e}());t.CallstatsIo=o},function(e,t){"use strict";!function(e){e[e.SDKReady="SDKReady"]="SDKReady",e[e.ConnectionEstablished="ConnectionEstablished"]="ConnectionEstablished",e[e.ConnectionFailed="ConnectionFailed"]="ConnectionFailed",e[e.ConnectionClosed="ConnectionClosed"]="ConnectionClosed",e[e.AuthResult="AuthResult"]="AuthResult",e[e.RefreshTokenResult="RefreshTokenResult"]="RefreshTokenResult",e[e.PlaybackFinished="PlaybackFinished"]="PlaybackFinished",e[e.MicAccessResult="MicAccessResult"]="MicAccessResult",e[e.IncomingCall="IncomingCall"]="IncomingCall",e[e.SourcesInfoUpdated="SourcesInfoUpdated"]="SourcesInfoUpdated",e[e.NetStatsReceived="NetStatsReceived"]="NetStatsReceived"}(t.Events||(t.Events={}));t.Events},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},o=n(5),i=n(1),a=function(){function e(){this.videoElements=new Array,this.audioElements=new Array,this.log=i.LogManager.get().createLogger(i.LogCategory.RTC,"Renderer")}return e.get=function(){return this.inst||(this.inst=new e),this.inst},Object.defineProperty(e.prototype,"defaultContainer",{get:function(){return this._defaultContainer},set:function(e){this._defaultContainer=e},enumerable:!0,configurable:!0}),e.prototype.getElement=function(e,t,n){var r=n||this._defaultContainer||document.body;if(document.getElementById(e)){var o=document.getElementById(e);r&&o.parentElement.removeChild(o)}var i;return i=document.createElement(t?"video":"audio"),t||(i.autoplay=!0),t?(this.videoElements.push(i),i.width=400,i.height=300):this.audioElements.push(i),i.id=e,r&&r.appendChild(i),i},e.prototype.getElementId=function(e,t){},e.prototype.renderStream=function(e,t){var n=this.getElement(e.id,e.getVideoTracks().length>0,t);return o.default.attachMedia(e,n),n},e.prototype.setPlaybackVolume=function(e){for(var t in this.audioElements)this.audioElements.hasOwnProperty(t)&&(this.audioElements[t].volume=e);for(var t in this.videoElements)this.videoElements.hasOwnProperty(t)&&(this.videoElements[t].volume=e)},e.prototype.releaseElement=function(e){e&&(e.id="","undefined"!=typeof e.parentElement&&null!==e.parentElement?e.parentElement&&e.parentElement.removeChild(e):e.parentNode&&e.parentNode&&e.parentNode.removeChild(e),o.default.detachMedia(e))},r([i.LogManager.d_trace(i.LogCategory.USERMEDIA)],e.prototype,"getElement",null),r([i.LogManager.d_trace(i.LogCategory.USERMEDIA)],e.prototype,"getElementId",null),r([i.LogManager.d_trace(i.LogCategory.USERMEDIA)],e.prototype,"renderStream",null),r([i.LogManager.d_trace(i.LogCategory.USERMEDIA)],e.prototype,"setPlaybackVolume",null),r([i.LogManager.d_trace(i.LogCategory.USERMEDIA)],e.prototype,"releaseElement",null),e}();t.Renderer=a},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},o=n(1),i=n(3),a=n(18),s=n(6),c=n(12),d=n(2),l=n(23),u=n(5),p=n(4);!function(e){e[e.IDLE=0]="IDLE",e[e.REMOTEOFFER=1]="REMOTEOFFER",e[e.LOCALOFFER=2]="LOCALOFFER",e[e.ESTABLISHING=3]="ESTABLISHING",e[e.ESTABLISHED=4]="ESTABLISHED",e[e.CLOSED=5]="CLOSED"}(t.PeerConnectionState||(t.PeerConnectionState={}));var g=t.PeerConnectionState;!function(e){e[e.CLIENT_SERVER_V1=0]="CLIENT_SERVER_V1",e[e.P2P=1]="P2P"}(t.PeerConnectionMode||(t.PeerConnectionMode={}));var f=t.PeerConnectionMode,h=function(){function e(e,t,n){this.id=e,this.mode=t,this.videoEnabled=n,this.SEND_CANDIDATE_DELAY=1e3,this.mediaRepository=[],this.candidateList=[],this.localCandidateTimer=-1,this.onHold=!1,this.muteMicState=!1,this.log=o.LogManager.get().createLogger(o.LogCategory.RTC,"PeerConnection "+e),this.state=g.IDLE,this.log.info("Created PC"),this.renderers=[],this.pendingCandidates=[],"_default"!==e&&s.CallManager.get().calls[e]&&(this.reInviteQ=new l.ReInviteQ(s.CallManager.get().calls[e],this._canReInvite))}return e.prototype.getId=function(){return this.id},e.prototype.setState=function(e){this.log.info("Transmitting from "+g[this.state]+" to "+g[e]),this.state=e},e.prototype.getState=function(){return this.state},e.prototype.processRemoteAnswer=function(e,t){return this.log.info("Called processRemoteAnswer"),this.state=g.ESTABLISHING,this._processRemoteAnswer(e,t)},e.prototype.getLocalOffer=function(){return this.state===g.IDLE||this.state===g.ESTABLISHED||g.LOCALOFFER?(this.log.info("Called getLocalOffer"),this.state=g.LOCALOFFER,this._getLocalOffer()):(this.log.error("Called getLocalOffer in state "+g[this.state]),new Promise(function(e,t){t("Invalid state")}))},e.prototype.getLocalAnswer=function(){return this._getLocalAnswer()},e.prototype.processRemoteOffer=function(e){return this.state===g.IDLE||this.state===g.ESTABLISHED?(this.log.info("Called processRemoteOffer"),this.state=g.ESTABLISHING,this._processRemoteOffer(e)):(this.log.error("Called processRemoteOffer in state "+g[this.state]),new Promise(function(e,t){t("Invalid state")}))},e.prototype.close=function(){this.log.info("Called close"),this._stopSharing(),this._close(),this.renderers.forEach(function(e){return a.Renderer.get().releaseElement(e)}),this.mediaRepository.forEach(function(e){e.stop()}),this.mediaRepository=[]},e.prototype.addRemoteCandidate=function(e,t){return this.log.info("Called addRemoteCandidate"),this._addRemoteCandidate(e,t)},e.prototype.sendLocalCandidateToPeer=function(e,t){var n=this;switch(this._call=s.CallManager.get().calls[this.id],this.mode){case f.P2P:this.candidateList.push([t,e]),this.localCandidateTimer<=0&&(this.localCandidateTimer=setTimeout(function(){clearTimeout(n.localCandidateTimer),n.localCandidateTimer=-1,s.CallManager.get().calls[n.id].sendInfo(c.Constants.P2P_SPD_FRAG_MIME_TYPE,JSON.stringify(n.candidateList),{}),n.candidateList=[]},200));break;case f.CLIENT_SERVER_V1:i.VoxSignaling.get().callRemoteFunction(d.RemoteFunction.addCandidate,this.id,e,t)}},e.prototype.bindLocalMedia=function(e){var t=this;if("undefined"!=typeof this._localStream&&this._unbindLocalMegia(),"undefined"!=typeof e&&null!==e){var n=new MediaStream(e.getTracks().map(function(e){var n=e;return"undefined"!=typeof e.clone&&(n=e.clone()),t.mediaRepository.push(n),n}));this._localStream=n,this._call&&n.getAudioTracks().length>0&&(this._call.audioDirections.sendAudio=!0),this._bindLocalMedia()}},Object.defineProperty(e.prototype,"localStream",{get:function(){return this._localStream},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remoteStreams",{get:function(){return this._remoteStreams},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"videoRenderer",{get:function(){var e=null;return this.renderers.forEach(function(t){"video"===t.tagName.toLowerCase()&&(e=t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audioRenderer",{get:function(){return this.renderers.forEach(function(e){if("audio"===e.tagName.toLowerCase())return e}),null},enumerable:!0,configurable:!0}),e.prototype.handleReinvite=function(e,t,n){return this._handleReinvite(e,t,n)},e.prototype.addCandidateToSend=function(e,t){this.pendingCandidates.push([t,e]),this.canSendCandidates&&this.startCandidateSendTimer()},e.prototype.startCandidateSendTimer=function(){var e=this;null!==this.candidateSendTimer&&"undefined"!=typeof this.candidateSendTimer||(this.candidateSendTimer=setTimeout(function(){e.candidateSendTimer=null,e.pendingCandidates.length>0&&s.CallManager.get().calls[e.id].sendInfo(c.Constants.P2P_SPD_FRAG_MIME_TYPE,JSON.stringify(e.pendingCandidates),{}),e.pendingCandidates=[]},this.SEND_CANDIDATE_DELAY))},e.prototype.canStartSendingCandidates=function(){this.canSendCandidates=!0,this.startCandidateSendTimer()},e.prototype.sendDTMF=function(e){var t=500,n=50;this._sendDTMF(e,t,n)},e.prototype.setVideoEnabled=function(e){var t=this.videoEnabled.receiveVideo;this.videoEnabled=e,t!=e.receiveVideo&&this._hold(this.onHold)},e.prototype.setVideoFlags=function(e){this.videoEnabled=e},e.prototype.updateRenderersSink=function(e){var t=this;return new Promise(function(n,r){if("chrome"!==u.default.getWSVendor(!0))return void r(new Error("Unsupported browser. Only Google Chrome 49 and above."));t.sinkId=e;for(var o=[],i=0,a=t.renderers;i<a.length;i++){var s=a[i];o.push(s.setSinkId(e))}Promise.all(o).then(function(){n()},r)})},e.prototype.getDirections=function(){return this._getDirections()},e.prototype.setHoldKey=function(e){this.onHold=e},e.prototype.getTrackKind=function(){return this._getTrackKind()},e.prototype.shareScreen=function(e){var t=this;return u.default.isScreenSharingSupported?new Promise(function(n,r){return t.onHold?void r({result:!1,call:t._call}):(t.onHold&&r(),void t.reInviteQ.add({fx:function(){u.default.getScreenMedia().then(function(n){t._addMediaStream(n,e),n.getTracks().forEach(function(e){return t.mediaRepository.push(e)})}).catch(r)},reject:r,resolve:function(e){t.restoreMute(),n(e)}}))}):new Promise(function(e,n){return t.onHold?void n({result:!1,call:t._call}):(o.LogManager.get().writeMessage(o.LogCategory.CALL,"SCREEN SHARING",o.LogLevel.WARNING,"Sorry, this browser does not support screen sharing."),void n(new Error("Sorry, this browser does not support screen sharing.")))})},e.prototype.sendMedia=function(e,t){var n=this;return new Promise(function(r,o){return n.onHold?void o({result:!1,call:n._call}):void n.reInviteQ.add({fx:function(){var r=p.UserMediaManager.get().getConstrainWithSendFlag(e,t);n.setVideoEnabled({receiveVideo:n.videoEnabled.receiveVideo,sendVideo:t}),p.UserMediaManager.get().getQueryMediaSilent(r).then(function(e){n.bindLocalMedia(e)})},reject:o,resolve:function(e){n.restoreMute(),r(e)}})})},e.prototype.stopSharingScreen=function(){var e=this;return u.default.isScreenSharingSupported?void this._stopSharing():new Promise(function(t,n){return e.onHold?void n({result:!1,call:e._call}):(o.LogManager.get().writeMessage(o.LogCategory.CALL,"SCREEN SHARING",o.LogLevel.WARNING,"Sorry, this browser does not support screen sharing."),void n(new Error("Sorry, this browser does not support screen sharing.")))})},e.prototype.hold=function(e){var t=this;return new Promise(function(n,r){t.reInviteQ.add({fx:function(){t._hold(e)},reject:r,resolve:function(e){t.restoreMute(),n(e)}})})},e.prototype.hdnFRS=function(){var e=this;return new Promise(function(t,n){return e.onHold?void n({result:!1,call:e._call}):void e.reInviteQ.add({fx:function(){e._hdnFRS()},reject:n,resolve:function(n){e.restoreMute(),t(n)}})})},e.prototype.addMediaStream=function(e,t){var n=this;return new Promise(function(r,o){return n.onHold?void o({result:!1,call:n._call}):void n.reInviteQ.add({fx:function(){n._addMediaStream(e,t)},reject:o,resolve:function(e){n.restoreMute(),r(e)}})})},e.prototype.muteMicrophone=function(e){var t=this;this.muteMicState!==e&&(this.muteMicState=e,this.localStream.getAudioTracks().forEach(function(e){e.enabled=!t.muteMicState}))},e.prototype.restoreMute=function(){var e=this,t=this;setTimeout(function(){e._call.restoreRMute(),e.localStream&&e.localStream.getAudioTracks().forEach(function(e){e.enabled=!t.muteMicState})},300)},r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"setState",null),r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"getState",null),r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"processRemoteAnswer",null),r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"getLocalOffer",null),r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"getLocalAnswer",null),r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"processRemoteOffer",null),r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"close",null),r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"addRemoteCandidate",null),r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"sendLocalCandidateToPeer",null),r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"bindLocalMedia",null),r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"addCandidateToSend",null),r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"startCandidateSendTimer",null),r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"canStartSendingCandidates",null),r([o.LogManager.d_trace(o.LogCategory.RTC)],e.prototype,"hold",null),e}();t.PeerConnection=h},function(e,t,n){"use strict";var r=n(4),o=function(){function e(){this.audioCache={},this.videoCache={}}return e.get=function(){return this.inst||(this.inst=new e),this.inst},e.prototype.clear=function(){for(var e=0,t=this.videoCache;e<t.length;e++){var n=t[e];n.stop()}for(var r=0,o=this.audioCache;r<o.length;r++){var n=o[r];n.stop()}},e.prototype.getTrack=function(e,t){var n=this;return new Promise(function(r,o){switch(""==e&&(e="def"),t){case"audio":r(n.audioCache[e]);break;case"video":r(n.videoCache[e]);break;default:r()}})},e.prototype.setTrack=function(t,n,r){switch(""==t&&(t="def"),n){case"audio":this.audioCache[t]=r;break;case"video":this.videoCache[t]=r;break;default:return}r.onmute=function(t){e.get().removeTrackByTrack(t.target)}},e.prototype.removeTrackByTrack=function(e){switch(e.kind){case"audio":this.deleteTrackFromCache(this.audioCache,e);break;case"video":this.deleteTrackFromCache(this.videoCache,e);break;default:return}r.UserMediaManager.get().resetLocalVideo()},e.prototype.deleteTrackFromCache=function(e,t){for(var n in e)e.hasOwnProperty(n)&&e[n].id===t.id&&delete e[n];t.stop()},e.prototype.getAudioCache=function(){return this.audioCache},e.prototype.getVideoCache=function(){return this.videoCache},e}();t.MediaCache=o},function(e,t){"use strict";var n=function(){function e(t){this.str=t||e.getNewGUIDString()}return e.prototype.toString=function(){return this.str},e.getNewGUIDString=function(){var e=(new Date).getTime();return window.performance&&"function"==typeof window.performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)})},e}();t.GUID=n},function(e,t,n){"use strict";var r,o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=n(25),a=n(21),s=n(1),c=n(10),d=n(24);!function(e){var t=function(){function e(e,t,n,r,o){this._distinct=t,this._publicJoin=n,this._participants=e,this._customData=r,this._moderators=o}return Object.defineProperty(e.prototype,"lastRead",{get:function(){return this._lastRead},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uuid",{get:function(){return this._uuid},set:function(e){throw Error("You can't change UUID for conversation.")},enumerable:!0,configurable:!0}),e.prototype.getPayload=function(){if("undefined"==typeof this._uuid)throw Error("You must create UUID with createUUID() function!");var e={uuid:this._uuid,participants:this.prepareParticipants(this._participants)};return"undefined"!=typeof this._title?e.title=this._title:e.title="","undefined"!=typeof this._moderators?e.moderators=this._moderators:e.moderators=[],"undefined"!=typeof this._lastRead&&(e.last_readed=this._lastRead),"undefined"!=typeof this._distinct?e.distinct=this._distinct:e.distinct=!1,"undefined"!=typeof this._publicJoin?e.enable_public_join=this._publicJoin:e.enable_public_join=!1,"undefined"!=typeof this._customData?e.custom_data=this._customData:e.custom_data={},"undefined"!=typeof this._createdAt&&(e.created_at=this._createdAt),e},e.prototype.getSimplePayload=function(){if("undefined"==typeof this._uuid)throw Error("You must create UUID with createUUID() function!");return{uuid:this._uuid,title:"undefined"!=typeof this._title?this._title:"",distinct:"undefined"!=typeof this._distinct&&this._distinct,enable_public_join:"undefined"!=typeof this._publicJoin&&this._publicJoin,custom_data:"undefined"!=typeof this._customData?this._customData:{}}},e.prototype.prepareParticipants=function(e){for(var t=[],r=0,o=e;r<o.length;r++){var i=o[r];if("undefined"!=typeof i.userId){var a={user_id:n.extractUserName(i.userId)};a.can_write="undefined"==typeof i.canWrite||i.canWrite,a.can_manage_participants="undefined"!=typeof i.canManageParticipants&&i.canManageParticipants,t.push(a)}}return t},e.prototype.createUUID=function(){if("undefined"!=typeof this._uuid)throw Error("UUID already created!");this._uuid=(new a.GUID).toString()},e.createFromBus=function(t,n){var r=new e([]);return r._lastSeq=n,r._uuid=t.uuid,r._title=t.title,r._moderators=t.moderators,r._createdAt=t.created_at,r._lastRead=t.last_read,r._distinct=t.distinct,r._publicJoin=t.public_join,t.participants&&(r._participants=t.participants.map(function(e){return{userId:e.user_id,canWrite:e.can_write,canManageParticipants:e.can_manage_participants}})),t.custom_data&&(r._customData=t.custom_data),r._lastUpdate=t.last_update,r},e.createFromCache=function(t){var n=new e([]);return n._uuid=t.uuid,n._lastSeq=t.seq,n._lastUpdate=t.lastUpdate,n._title=t.title,n._moderators=t.moderators,n._createdAt=t.createdAt,n._lastRead=t.lastRead,n._distinct=t.distinct,n._publicJoin=t.publicJoin,n._participants=t.participants,n._customData=t.customData,n},e.prototype.toCache=function(){return{uuid:this._uuid,seq:this._lastSeq,lastUpdate:this._lastUpdate,moderators:this._moderators,title:this._title,createdAt:this._createdAt,lastRead:this._lastRead,distinct:this._distinct,publicJoin:this._publicJoin,participants:this._participants,customData:this._customData}},Object.defineProperty(e.prototype,"title",{get:function(){return this._title},set:function(e){this._title=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distinct",{get:function(){return this._distinct},set:function(e){this._distinct=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"publicJoin",{get:function(){return this._publicJoin},set:function(e){this._publicJoin=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"customData",{get:function(){return this._customData},set:function(e){this._customData=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"moderators",{get:function(){return this._moderators},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"createdAt",{get:function(){return this._createdAt},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"participants",{get:function(){return this._participants},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastSeq",{get:function(){return this._lastSeq},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastUpdate",{get:function(){return this._lastUpdate},enumerable:!0,configurable:!0}),e.prototype.sendMessage=function(e,t){var n=new r(e,t);return n.sendTo(this),n},e.prototype.typing=function(){var e=this;return!this._debounceLock&&(setTimeout(function(){e._debounceLock=!1},1e4),this._debounceLock=!0,i.MsgSignaling.get().sendPayload(d.MsgAction.typingMessage,{conversation:this._uuid}),!0)},e.prototype.markAsRead=function(e){i.MsgSignaling.get().sendPayload(d.MsgAction.isRead,{conversation:this._uuid,seq:e}),this._lastRead=e},e.prototype.markAsDelivered=function(e){i.MsgSignaling.get().sendPayload(d.MsgAction.isDelivered,{conversation:this._uuid,seq:e})},e.prototype.remove=function(){n.get().removeConversation(this._uuid)},e.prototype.update=function(){n.get().editConversation(this)},e.prototype.setTitle=function(e){this._title=e,n.get().editConversation(this)},e.prototype.setPublicJoin=function(e){this._publicJoin=e,n.get().editConversation(this)},e.prototype.setDistinct=function(e){this._distinct=e,n.get().editConversation(this)},e.prototype.setCustomData=function(e){},e.prototype.addParticipants=function(e){var t=this;return new Promise(function(n,r){0==e.length&&r(),i.MsgSignaling.get().sendPayload(d.MsgAction.addParticipants,{uuid:t._uuid,participants:t.prepareParticipants(e)}),l.getInstance().registerPromise(u.EditConversation,n,r)})},e.prototype.editParticipants=function(e){var t=this;return new Promise(function(n,r){0==e.length&&r(),i.MsgSignaling.get().sendPayload(d.MsgAction.editParticipants,{uuid:t._uuid,participants:t.prepareParticipants(e)}),l.getInstance().registerPromise(u.EditConversation,n,r)})},e.prototype.removeParticipants=function(e){var t=this;return new Promise(function(n,r){0==e.length&&r(),i.MsgSignaling.get().sendPayload(d.MsgAction.removeParticipants,{uuid:t._uuid,participants:e.map(function(e){if("undefined"!=typeof e.userId)return e.userId})}),l.getInstance().registerPromise(u.EditConversation,n,r)})},e.prototype.addModerators=function(e){var t=this;return new Promise(function(n,r){0==e.length&&r(),i.MsgSignaling.get().sendPayload(d.MsgAction.addModerators,{uuid:t._uuid,moderators:e}),l.getInstance().registerPromise(u.EditConversation,n,r)})},e.prototype.removeModerators=function(e){var t=this;return new Promise(function(n,r){0==e.length&&r(),i.MsgSignaling.get().sendPayload(d.MsgAction.removeModerators,{uuid:t._uuid,moderators:e}),l.getInstance().registerPromise(u.EditConversation,n,r)})},e.prototype.retransmitEvents=function(e,t){e|=0,t|=0,i.MsgSignaling.get().sendPayload(d.MsgAction.retransmitEvents,{uuid:this._uuid,eventsFrom:e,eventsTo:t})},e.prototype.updateSeq=function(e){e>this._lastSeq&&(this._lastSeq=e),this._lastUpdate=Date.now()/1e3|0},o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"getPayload",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"getSimplePayload",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"prepareParticipants",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"createUUID",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"toCache",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"markAsRead",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"markAsDelivered",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"remove",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"update",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"addParticipants",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"editParticipants",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"removeParticipants",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"addModerators",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"removeModerators",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"retransmitEvents",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"updateSeq",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e,"createFromBus",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e,"createFromCache",null),e}();e.Conversation=t;var n=function(){function e(){var n=this;if(e.instance)throw new Error("Error - use ConversationManager.get()");this.signalling=i.MsgSignaling.get(),this.awaitingConversations={},this.signalling.addEventListener(d.MsgEvent.onEditConversation,function(e){n.resolveEvent(e,u.EditConversation)}),this.signalling.addEventListener(d.MsgEvent.onGetConversation,function(e){n.resolveEvent(e,u.GetConversation)}),this.signalling.addEventListener(d.MsgEvent.onRemoveConversation,function(e){n.resolveEvent(e,u.RemoveConversation)}),this.signalling.addEventListener(d.MsgEvent.onCreateConversation,function(e){n.resolveEvent(e,u.CreateConversation)}),this.signalling.addEventListener(d.MsgEvent.onSendMessage,function(e){n.resolveMessageEvent(e,u.SendMessage)}),this.signalling.addEventListener(d.MsgEvent.onEditMessage,function(e){n.resolveMessageEvent(e,u.EditMessage)}),this.signalling.addEventListener(d.MsgEvent.onRemoveMessage,function(e){n.resolveMessageEvent(e,u.RemoveMessage)}),this.signalling.addEventListener(d.MsgEvent.isRead,function(e){var t=e.object;l.getInstance().dispatchEvent(u.Read,{conversation:t.conversation,timestamp:new Date(1e3*t.timestamp),userId:e.user_id,seq:t.seq,onIncomingEvent:e.on_incoming_event,name:u[u.Read]})}),this.signalling.addEventListener(d.MsgEvent.isDelivered,function(e){var t=e.object;l.getInstance().dispatchEvent(u.Delivered,{conversation:t.conversation,timestamp:new Date(1e3*t.timestamp),userId:e.user_id,seq:t.seq,onIncomingEvent:e.on_incoming_event,name:u[u.Delivered]})}),this.signalling.addEventListener(d.MsgEvent.onTyping,function(e){l.getInstance().dispatchEvent(u.Typing,{name:u[u.Typing],conversation:e.object.conversation,userId:e.user_id,onIncomingEvent:e.on_incoming_event})}),this.signalling.addEventListener(d.MsgEvent.onRetransmitEvents,function(e){l.getInstance().dispatchEvent(u.RetransmitEvents,{events:e.object.map(function(e){if(e.event)return e.event.indexOf("Message")==-1?{name:e.event,conversation:t.createFromBus(e.payload.object,e.payload.seq),userId:e.payload.user_id,seq:e.payload.seq,onIncomingEvent:e.payload.on_incoming_event}:{name:e.event,message:r.createFromBus(e.payload.object,e.payload.seq),userId:e.payload.user_id,seq:e.payload.seq,onIncomingEvent:e.payload.on_incoming_event}}),userId:e.user_id,seq:e.seq,onIncomingEvent:e.on_incoming_event})}),this._converasationList=[]}return e.prototype.resolveEvent=function(e,n){if(u[n]===u[u.RemoveConversation]){var r=e.object;return void l.getInstance().dispatchEvent(n,{name:u[n],uuid:r.uuid,userId:e.user_id,seq:e.seq,onIncomingEvent:e.on_incoming_event})}var o=t.createFromBus(e.object,e.seq);this.registerConversation(o),"undefined"!=typeof o&&o.updateSeq(e.seq),l.getInstance().dispatchEvent(n,{name:u[n],conversation:o,userId:e.user_id,seq:e.seq,onIncomingEvent:e.on_incoming_event}),n===u.GetConversation&&"undefined"!=typeof this.awaitingConversations[o.uuid]&&(this.awaitingConversations[o.uuid](o),delete this.awaitingConversations[o.uuid])},e.prototype.resolveMessageEvent=function(e,t){var n=this;r.createFromBus(e.object,e.seq).then(function(r){"undefined"!=typeof n._converasationList[r.conversation]&&n._converasationList[r.conversation].updateSeq(e.seq),l.getInstance().dispatchEvent(t,{name:u[t],message:r,userId:e.user_id,seq:e.seq,onIncomingEvent:e.on_incoming_event})})},e.get=function(){return e.instance=e.instance||new e,e.instance},e.extractUserName=function(e){var t=e.split("@");return t[1]=t[1].split(".").splice(0,2).join("."),t.join("@")},e.prototype.createConversation=function(e,n,r,o,i,a){var s=new t(e,r,o,i,a);
s.title=n,s.createUUID(),this.signalling.sendPayload(d.MsgAction.createConversation,s.getPayload())},e.prototype.registerConversation=function(e){this._converasationList.filter(function(t){return t.uuid!==e.uuid}),this._converasationList.push(e)},e.prototype.removeConversation=function(e){this.signalling.sendPayload(d.MsgAction.removeConversation,{uuid:e})},e.prototype.editConversation=function(e){this.signalling.sendPayload(d.MsgAction.editConversation,e.getSimplePayload())},e.prototype.getConversation=function(e){this.signalling.sendPayload(d.MsgAction.getConversation,{uuid:e})},e.prototype.getConversationByUUID=function(e){var t=this;return new Promise(function(n,r){for(var o=0,i=t._converasationList;o<i.length;o++){var a=i[o];if(a.uuid===e)return l.getInstance().dispatchEvent(u.GetConversation,{conversation:a}),void n(a)}t.awaitingConversations[e]=n})},e.deserialize=function(e){return t.createFromCache(e)},e.serialize=function(e){return e.toCache()},e.prototype.getConversations=function(e){this.signalling.sendPayload(d.MsgAction.getConversations,{uuids:e})},o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"resolveEvent",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"resolveMessageEvent",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"createConversation",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"registerConversation",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"removeConversation",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"editConversation",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"getConversation",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"getConversationByUUID",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"getConversations",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e,"get",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e,"extractUserName",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e,"deserialize",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e,"serialize",null),e}(),r=function(){function e(e,t){this._text=e,this._payload=t,this._uuid=(new a.GUID).toString()}return e.prototype.sendTo=function(e){this._conversation=e.uuid,i.MsgSignaling.get().sendPayload(d.MsgAction.sendMessage,this.getPayload())},e.prototype.getPayload=function(){var e={uuid:this._uuid,text:this._text,conversation:this._conversation};return"undefined"!=typeof this._payload?e.payload=this._payload:e.payload=[],e},Object.defineProperty(e.prototype,"uuid",{get:function(){return this._uuid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"conversation",{get:function(){return this._conversation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(e){this._text=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"payload",{get:function(){return this._payload},set:function(e){this._payload=e},enumerable:!0,configurable:!0}),e.prototype.update=function(){i.MsgSignaling.get().sendPayload(d.MsgAction.editMessage,this.getPayload())},e.prototype.remove=function(){i.MsgSignaling.get().sendPayload(d.MsgAction.removeMessage,{uuid:this._uuid,conversation:this.conversation})},Object.defineProperty(e.prototype,"seq",{get:function(){return this._seq},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sender",{get:function(){return this._sender},enumerable:!0,configurable:!0}),e.createFromBus=function(t,n){return new Promise(function(r,o){var i=new e(t.text,t.payload);i._uuid=t.uuid,i._conversation=t.conversation,i._sender=t.sender,i._seq=n,r(i)})},e.createFromCache=function(t){var n=new e(t.text,t.payload);return n._uuid=t.uuid,n._conversation=t.conversation,n._sender=t.sender,n._seq=t.seq,n},e.prototype.toCache=function(){return{seq:this._seq,uuid:this._uuid,text:this._text,payload:this._payload,conversation:this._conversation,sender:this._sender}},o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"sendTo",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"getPayload",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"update",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"remove",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"toCache",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e,"createFromBus",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e,"createFromCache",null),e}();e.Message=r;var l=function(){function e(){var t=this;if(e.instance)throw new Error("Error - use Client.getIM()");this.eventListeners={},this.signalling=i.MsgSignaling.get(),this.cm=n.get(),this.signalling.addEventListener(d.MsgEvent.onError,function(e){t.dispatchEvent(u.Error,e)}),n.get(),this.signalling.addEventListener(d.MsgEvent.onEditUser,function(e){var n=e.object,r={user:{customData:n.custom_data,privateCustomData:n.private_custom_data,userId:n.user_id},userId:e.user_id,seq:e.seq,onIncomingEvent:e.on_incoming_event};t.dispatchEvent(u.EditUser,r)}),this.signalling.addEventListener(d.MsgEvent.onGetUser,function(e){var n=e.object,r={user:{conversationsList:n.conversations_list,customData:n.custom_data,privateCustomData:n.private_custom_data,userId:n.user_id},userId:e.user_id,seq:e.seq,onIncomingEvent:e.on_incoming_event};t.dispatchEvent(u.GetUser,r)}),this.signalling.addEventListener(d.MsgEvent.onSubscribe,function(e){t.dispatchEvent(u.Subscribe,{users:e.users})}),this.signalling.addEventListener(d.MsgEvent.onUnSubscribe,function(e){t.dispatchEvent(u.UnSubscribe,{users:e.users})}),this.signalling.addEventListener(d.MsgEvent.onSetStatus,function(e){t.dispatchEvent(u.SetStatus,{user:{userId:e.object.user_id,online:e.object.online,timestamp:e.object.timestamp},userId:e.user_id,seq:e.seq,onIncomingEvent:e.on_incoming_event})}),this.awaitPromiseList=[]}return e.getInstance=function(){return e.instance=e.instance||new e,e.instance},e.prototype.createConversation=function(e,t,n,r,o,i){this.cm.createConversation(e,t,n,r,o,i)},e.prototype.getConversation=function(e){this.cm.getConversation(e)},e.prototype.getConversations=function(e){return e.length>30?void s.LogManager.get().writeMessage(s.LogCategory.MESSAGING,"Rate limit",s.LogLevel.ERROR,"you can get maximum 30 conversation in one getConversations"):this.cm.getConversations(e)},e.prototype.getRawConversations=function(e){return this.cm.getConversations(e)},e.prototype.removeConversation=function(e){this.cm.removeConversation(e)},e.prototype.joinConversation=function(e){this.signalling.sendPayload(d.MsgAction.joinConversation,{uuid:e})},e.prototype.leaveConversation=function(e){this.signalling.sendPayload(d.MsgAction.leaveConversation,{uuid:e})},e.prototype.getUser=function(e){this.signalling.sendPayload(d.MsgAction.getUser,{user_id:e})},e.prototype.getMe=function(){return n.extractUserName(c.Authenticator.get().username())},e.prototype.editUser=function(e,t){var r={user_id:n.extractUserName(c.Authenticator.get().username())};e&&(r.custom_data=e),t&&(r.private_custom_data=t),this.signalling.sendPayload(d.MsgAction.editUser,r)},e.prototype.getUsers=function(e){this.signalling.sendPayload(d.MsgAction.getUsers,{users:e})},e.prototype.addEventListener=function(e,t){"undefined"==typeof this.eventListeners[e]&&(this.eventListeners[e]=[]),this.eventListeners[e].push(t)},e.prototype.removeEventListener=function(e,t){if("undefined"!=typeof this.eventListeners[e])if("function"==typeof t){for(var n=0;n<this.eventListeners[e].length;n++)if(this.eventListeners[e][n]===t){this.eventListeners[e].splice(n,1);break}}else this.eventListeners[e]=[]},e.prototype.dispatchEvent=function(e,t){if(t.name=u[e],"undefined"!=typeof this.eventListeners[e]&&this.eventListeners[e].forEach(function(e){"function"==typeof e&&e(t)}),"undefined"!=typeof this.awaitPromiseList[e]&&0!=this.awaitPromiseList[e].length){var n=this.awaitPromiseList[e].splice(0,1);n.resolve(t),window.clearTimeout(n.expire)}},e.prototype.on=function(e,t){this.addEventListener(e,t)},e.prototype.off=function(e,t){this.removeEventListener(e,t)},e.prototype.registerPromise=function(e,t,n){"undefined"==typeof this.awaitPromiseList[e]&&(this.awaitPromiseList[e]=[]),this.awaitPromiseList[e].push({resolve:t,reject:n,expire:setTimeout(function(){n()},2e4)})},e.prototype.createConversationFromCache=function(e){return"undefined"==typeof e?null:t.createFromCache(e)},e.prototype.createMessageFromCache=function(e){return"undefined"==typeof e?null:r.createFromCache(e)},e.prototype.subscribe=function(e){this.signalling.sendPayload(d.MsgAction.subscribe,{users:e})},e.prototype.unSubscribe=function(e){this.signalling.sendPayload(d.MsgAction.unSubscribe,{users:e})},e.prototype.setPresence=function(e){this.setStatus(e)},e.prototype.setStatus=function(e){this.signalling.sendPayload(d.MsgAction.setStatus,{online:e})},o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"createConversation",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"getConversation",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"getConversations",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"getRawConversations",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"removeConversation",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"joinConversation",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"leaveConversation",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"getUser",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"getMe",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"editUser",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"getUsers",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"addEventListener",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"removeEventListener",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"dispatchEvent",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"on",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"off",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"registerPromise",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"createConversationFromCache",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"createMessageFromCache",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"subscribe",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"unSubscribe",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"setPresence",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e.prototype,"setStatus",null),o([s.LogManager.d_trace(s.LogCategory.MESSAGING)],e,"getInstance",null),e}();e.Messenger=l,function(e){e[e.CreateConversation="CreateConversation"]="CreateConversation",e[e.EditConversation="EditConversation"]="EditConversation",e[e.RemoveConversation="RemoveConversation"]="RemoveConversation",e[e.GetConversation="GetConversation"]="GetConversation",e[e.SendMessage="SendMessage"]="SendMessage",e[e.EditMessage="EditMessage"]="EditMessage",e[e.RemoveMessage="RemoveMessage"]="RemoveMessage",e[e.Typing="Typing"]="Typing",e[e.EditUser="EditUser"]="EditUser",e[e.GetUser="GetUser"]="GetUser",e[e.Error="Error"]="Error",e[e.RetransmitEvents="RetransmitEvents"]="RetransmitEvents",e[e.Read="Read"]="Read",e[e.Delivered="Delivered"]="Delivered",e[e.Subscribe="Subscribe"]="Subscribe",e[e.UnSubscribe="UnSubscribe"]="UnSubscribe",e[e.SetStatus="SetStatus"]="SetStatus"}(e.MessengerEvents||(e.MessengerEvents={}));var u=e.MessengerEvents;!function(e){e[e.createConversation="createConversation"]="createConversation",e[e.editConversation="editConversation"]="editConversation",e[e.removeConversation="removeConversation"]="removeConversation",e[e.joinConversation="joinConversation"]="joinConversation",e[e.leaveConversation="leaveConversation"]="leaveConversation",e[e.getConversation="getConversation"]="getConversation",e[e.getConversations="getConversations"]="getConversations",e[e.sendMessage="sendMessage"]="sendMessage",e[e.editMessage="editMessage"]="editMessage",e[e.removeMessage="removeMessage"]="removeMessage",e[e.typingMessage="typingMessage"]="typingMessage",e[e.editUser="editUser"]="editUser",e[e.getUser="getUser"]="getUser",e[e.getUsers="getUsers"]="getUsers",e[e.retransmitEvents="retransmitEvents"]="retransmitEvents",e[e.isRead="isRead"]="isRead",e[e.isDelivered="isDelivered"]="isDelivered",e[e.addParticipants="addParticipants"]="addParticipants",e[e.editParticipants="editParticipants"]="editParticipants",e[e.removeParticipants="removeParticipants"]="removeParticipants",e[e.addModerators="addModerators"]="addModerators",e[e.removeModerators="removeModerators"]="removeModerators",e[e.subscribe="subscribe"]="subscribe",e[e.unSubscribe="unSubscribe"]="unSubscribe",e[e.setStatus="setStatus"]="setStatus"}(e.MessengerAction||(e.MessengerAction={}));e.MessengerAction;!function(e){e[e.Error_1="1"]="Error_1",e[e.Error_2="2"]="Error_2",e[e.Error_3="3"]="Error_3",e[e.Error_4="4"]="Error_4",e[e.Error_5="5"]="Error_5",e[e.Error_6="6"]="Error_6",e[e.Error_7="7"]="Error_7",e[e.Error_8="8"]="Error_8",e[e.Error_9="9"]="Error_9",e[e.Error_10="10"]="Error_10",e[e.Error_11="11"]="Error_11",e[e.Error_12="12"]="Error_12",e[e.Error_13="13"]="Error_13",e[e.Error_14="14"]="Error_14",e[e.Error_15="15"]="Error_15",e[e.Error_16="16"]="Error_16",e[e.Error_17="17"]="Error_17",e[e.Error_18="18"]="Error_18",e[e.Error_19="19"]="Error_19",e[e.Error_21="21"]="Error_21",e[e.Error_22="22"]="Error_22",e[e.Error_23="23"]="Error_23",e[e.Error_24="24"]="Error_24",e[e.Error_30="30"]="Error_30",e[e.Error_500="500"]="Error_500",e[e.Error_777="777"]="Error_777"}(e.MessengerError||(e.MessengerError={}));e.MessengerError}(r=t.Messaging||(t.Messaging={}))},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},o=n(11),i=n(1),a=function(){function e(e,t){var n=this;this._pcStatus=t,this._q=[],e.on(o.CallEvents.Updated,function(e){i.LogManager.get().writeMessage(i.LogCategory.REINVITEQ,"CallEvent",i.LogLevel.TRACE,"Updated with result "+e.result),n._currentReinvite&&(e.result?n._currentReinvite.resolve(e):n._currentReinvite.reject(e),n._currentReinvite=void 0),n.runNext()}),e.on(o.CallEvents.PendingUpdate,function(e){i.LogManager.get().writeMessage(i.LogCategory.REINVITEQ,"CallEvent",i.LogLevel.TRACE,"IncomingUpdate. Local RI=="+typeof n._currentReinvite),n._currentReinvite&&(n._currentReinvite.reject(),n._currentReinvite=void 0)}),e.on(o.CallEvents.UpdateFailed,function(e){i.LogManager.get().writeMessage(i.LogCategory.REINVITEQ,"CallEvent",i.LogLevel.TRACE,"UpdateFailed"),n._currentReinvite&&(n._currentReinvite.reject(),n._currentReinvite=void 0)})}return e.prototype.runNext=function(){"undefined"==typeof this._currentReinvite&&this._q.length>0&&this._pcStatus()&&(console.log(this._q),this._currentReinvite=this._q.splice(0,1)[0],this._currentReinvite.fx())},e.prototype.add=function(e){this._q.push(e),this.runNext()},e.prototype.clear=function(){this._q.forEach(function(e){e.reject()})},r([i.LogManager.d_trace(i.LogCategory.REINVITEQ)],e.prototype,"runNext",null),r([i.LogManager.d_trace(i.LogCategory.REINVITEQ)],e.prototype,"add",null),r([i.LogManager.d_trace(i.LogCategory.REINVITEQ)],e.prototype,"clear",null),e}();t.ReInviteQ=a},function(e,t){"use strict";!function(e){e[e.Chat="chat"]="Chat"}(t.MsgService||(t.MsgService={}));t.MsgService;!function(e){e[e.createConversation="createConversation"]="createConversation",e[e.editConversation="editConversation"]="editConversation",e[e.removeConversation="removeConversation"]="removeConversation",e[e.joinConversation="joinConversation"]="joinConversation",e[e.leaveConversation="leaveConversation"]="leaveConversation",e[e.getConversation="getConversation"]="getConversation",e[e.getConversations="getConversations"]="getConversations",e[e.sendMessage="sendMessage"]="sendMessage",e[e.editMessage="editMessage"]="editMessage",e[e.removeMessage="removeMessage"]="removeMessage",e[e.typingMessage="typingMessage"]="typingMessage",e[e.editUser="editUser"]="editUser",e[e.getUser="getUser"]="getUser",e[e.getUsers="getUsers"]="getUsers",e[e.retransmitEvents="retransmitEvents"]="retransmitEvents",e[e.isRead="isRead"]="isRead",e[e.isDelivered="isDelivered"]="isDelivered",e[e.addParticipants="addParticipants"]="addParticipants",e[e.editParticipants="editParticipants"]="editParticipants",e[e.removeParticipants="removeParticipants"]="removeParticipants",e[e.addModerators="addModerators"]="addModerators",e[e.removeModerators="removeModerators"]="removeModerators",e[e.subscribe="subscribe"]="subscribe",e[e.unSubscribe="unSubscribe"]="unSubscribe",e[e.setStatus="setStatus"]="setStatus"}(t.MsgAction||(t.MsgAction={}));t.MsgAction;!function(e){e[e.onCreateConversation="onCreateConversation"]="onCreateConversation",e[e.onEditConversation="onEditConversation"]="onEditConversation",e[e.onRemoveConversation="onRemoveConversation"]="onRemoveConversation",e[e.onJoinConversation="onJoinConversation"]="onJoinConversation",e[e.onLeaveConversation="onLeaveConversation"]="onLeaveConversation",e[e.onGetConversation="onGetConversation"]="onGetConversation",e[e.onSendMessage="onSendMessage"]="onSendMessage",e[e.onEditMessage="onEditMessage"]="onEditMessage",e[e.onRemoveMessage="onRemoveMessage"]="onRemoveMessage",e[e.onTyping="onTyping"]="onTyping",e[e.onRetransmitEvents="onRetransmitEvents"]="onRetransmitEvents",e[e.onEditUser="onEditUser"]="onEditUser",e[e.onGetUser="onGetUser"]="onGetUser",e[e.onError="onError"]="onError",e[e.isRead="isRead"]="isRead",e[e.isDelivered="isDelivered"]="isDelivered",e[e.onSubscribe="onSubscribe"]="onSubscribe",e[e.onUnSubscribe="onUnSubscribe"]="onUnSubscribe",e[e.onSetStatus="onSetStatus"]="onSetStatus"}(t.MsgEvent||(t.MsgEvent={}));t.MsgEvent},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},o=n(1),i=n(24),a=n(3),s=function(){function e(){var t=this;if(e.instance)throw new Error("Error - use Client.getMessagingInstance()");this.eventListeners=[],this.query=[],setInterval(function(){t.updateQuery()},220)}return e.prototype.handleWsData=function(e){var t=["onCreateConversation","onEditConversation","onRemoveConversation","onJoinConversation","onLeaveConversation","onGetConversation","onSendMessage","onEditMessage","onRemoveMessage","onTyping","onRetransmitEvents","onEditUser","onGetUser","isRead","isDelivered","onError","onSubscribe","onUnSubscribe","onSetStatus"];if(t.indexOf(e.event)==-1)throw new Error("Unknown messaging event "+e.event+" with payload "+JSON.stringify(e.payload));this.dispatchEvent(e.event,e)},e.get=function(){return e.instance=e.instance||new e,e.instance},e.prototype.sendPayload=function(e,t){var n={service:i.MsgService.Chat,event:e,payload:t};return this.query.push(n),!0},e.prototype.updateQuery=function(){if(this.query.length){var e=this.query.splice(0,1);a.VoxSignaling.get().sendRaw(e[0])}},e.prototype.addEventListener=function(e,t){"undefined"==typeof this.eventListeners[e]&&(this.eventListeners[e]=[]),this.eventListeners[e].push(t)},e.prototype.removeEventListener=function(e,t){if("undefined"!=typeof this.eventListeners[e]&&"function"==typeof t)for(var n=0;n<this.eventListeners[e].length;n++){if(this.eventListeners[e][n]==t){this.eventListeners[e].splice(n,1);break}this.eventListeners[e]=[]}},e.prototype.dispatchEvent=function(e,t){if("undefined"!=typeof this.eventListeners[e])for(var n=0;n<this.eventListeners[e].length;n++)"function"==typeof this.eventListeners[e][n]&&this.eventListeners[e][n](t.payload)},e.prototype.on=function(e,t){this.addEventListener(e,t)},e.prototype.off=function(e,t){this.removeEventListener(e,t)},r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"handleWsData",null),r([o.LogManager.d_trace(o.LogCategory.MESSAGING)],e.prototype,"sendPayload",null),e}();t.MsgSignaling=s},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},o=n(1),i=n(7),a=n(10),s=n(4),c=function(){function e(){}return e.extend=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var n={},r=function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t])};r(arguments[0]);for(var o=1;o<arguments.length;o++){var i=arguments[o];r(i)}return n},e.stringifyExtraHeaders=function(e){return e="[object Object]"==Object.prototype.toString.call(e)?JSON.stringify(e):null},e.cadScript=function(e){var t=e.split(";");return t.map(function(e){if(0!==e.length){var t=e.match(/\([0-9\/\.,\*\+]*\)$/),n=e.substring(0,t.index),r=t.pop();if(t.length)throw new Error("cadence script should be of the form `%f(%f/%f[,%f/%f])`");if(n="*"===n?1/0:parseFloat(n),isNaN(n))throw new Error("cadence length should be of the form `%f`");return r=r.slice(1,r.length-1).split(",").map(function(e){try{var t=e.split("/");if(t.length>3)throw new Error;return t=t.map(function(e,t){if(2===t){var n=e.split("+").map(function(e){var t=parseInt(e,10);if(isNaN(t))throw new Error;return t-1});return n}var r;if("*"==e&&(r=1/0),r=r?r:parseFloat(e),isNaN(r))throw new Error;return r}),{on:t[0],off:t[1],frequencies:t[2]}}catch(e){throw new Error("cadence segments should be of the form `%f/%f[%d[+%d]]`")}}),{duration:n,sections:r}}})},e.freqScript=function(e){var t=e.split(",");return t.map(function(e){try{var t=e.split("@"),n=parseInt(t.shift()),r=parseFloat(t.shift());if(t.length)throw Error();return{frequency:n,decibels:r}}catch(e){throw new Error("freqScript pairs are expected to be of the form `%d@%f[,%d@%f]`")}})},e.toneScript=function(e){var t=e.split(";"),n=this.freqScript(t.shift()),r=this.cadScript(t.join(";"));return{frequencies:n,cadences:r}},e.playToneScript=function(e,t){if(void 0===t&&(t=!1),"undefined"!=typeof window.AudioContext||"undefined"!=typeof window.webkitAudioContext){var n=s.UserMediaManager.get().audioContext,r=this.toneScript(e),o=[],i=0,a=function(e){for(var t=0;t<n.sampleRate*e;t++)o.push(0)},c=function(e,t){for(var i=0;i<n.sampleRate*t;i++){for(var a=0,s=0;s<e.length;s++)a+=Math.pow(10,r.frequencies[e[s]].decibels/20)*Math.sin((o.length+i)*(3.14159265359/n.sampleRate)*r.frequencies[e[s]].frequency),i<10&&(a*=i/10),i>n.sampleRate*t-10&&(a*=(n.sampleRate*t-i)/10);o.push(a)}},d=function(e,t){if(t!=1/0)var n=t;else n=t=20;if(0!==e.off&&e.off!=1/0)for(;n>0;){c(e.frequencies,e.on),n-=e.on,a(e.off),n-=e.off;n=parseInt(String(10*n))/10}else c(e.frequencies,t)},l=function(e){i+=e.duration!=1/0?e.duration:20;for(var t=0;t<e.sections.length;t++)d(e.sections[t],e.duration)};this.source=n.createBufferSource();for(var u=0;u<r.cadences.length;u++)r.cadences[u].duration==1/0&&(this.source.loop=!0),l(r.cadences[u]);this.source.connect(n.destination);for(var p=n.createBuffer(1,i*n.sampleRate,n.sampleRate),g=p.getChannelData(0),f=0;f<i*n.sampleRate;f++)g[f]=o[f];o=null,this.source.buffer=p,t===!0&&(this.source.loop=!0),this.source.start(0)}},e.stopPlayback=function(){return null!==this.source&&(this.source.stop(0),this.source=null,!0)},e.sendRequest=function(e,t,n,r){var o=!1,i=function(){for(var e,t=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],n=0;n<t.length;n++){try{e=t[n](),0===n&&(o=!0)}catch(e){continue}break}return e},a=i();if(a){var s=r?"POST":"GET";if(o)a.onerror=function(){n(a)},a.ontimeout=function(){n(a)},a.onload=function(){t(a)},a.open(s,e),a.timeout=5e3,a.send();else{if(a.open(s,e,!0),r&&a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){if(4==a.readyState)return 200!=a.status&&304!=a.status?void n(a):void t(a)},4==a.readyState)return;a.send(r)}}},e.getServers=function(e,t,n){function r(r){null!==r?e(r):t!==!0?this.getServers(e,!0,n):n.dispatchEvent({name:"ConnectionFailed",message:"VoxImplant Cloud is unavailable"})}void 0===t&&(t=!1);var o="https:"==document.location.protocol?"https://":"http://";if(t===!0)var i=o+"balancer.voximplant.com/getNearestHost";else i=o+"balancer.voximplant.com/getNearestHost";this.sendRequest(i,function(e){r(e.responseText)},function(e){r(null)})},e.generateUUID=function(){var e=this._gri,t=this._ha;return t(e(32),8)+"-"+t(e(16),4)+"-"+t(16384|e(12),4)+"-"+t(32768|e(14),4)+"-"+t(e(48),12)},e._gri=function(e){return e<0?NaN:e<=30?0|Math.random()*(1<<e):e<=53?(0|Math.random()*(1<<30))+(0|Math.random()*(1<<e-30))*(1<<30):NaN},e._ha=function(e,t){for(var n=e.toString(16),r=t-n.length,o="0";r>0;r>>>=1,o+=o)1&r&&(n=o+n);return n},e.filterXSS=function(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),e=t.innerHTML},e.checkCA=function(){if(!i.Client.getInstance().connected())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(!a.Authenticator.get().authorized())throw new Error("NOT_AUTHORIZED")},e.canRTC=function(e){},e.mixObjectToLeft=function(e,t){for(var n in e)"undefined"!=typeof t[n]&&(e[n]=t[n]);return e},e.makeRandomString=function(e){for(var t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/",n="",r=0;r<e;r++)n+=t.charAt(Math.floor(Math.random()*t.length));return n},e.source=null,r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"extend",null),r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"stringifyExtraHeaders",null),r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"cadScript",null),r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"freqScript",null),r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"toneScript",null),r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"playToneScript",null),r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"stopPlayback",null),r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"sendRequest",null),r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"getServers",null),r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"generateUUID",null),r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"_gri",null),r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"_ha",null),r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"filterXSS",null),r([o.LogManager.d_trace(o.LogCategory.UTILS)],e,"checkCA",null),e}();t.Utils=c},function(e,t){"use strict";var n={};n.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},n.splitSections=function(e){var t=e.split("\nm=");return t.map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},n.matchPrefix=function(e,t){return n.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},n.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var n={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;default:n[t[r]]=t[r+1]}return n},n.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),e.ufrag&&(t.push("ufrag"),t.push(e.ufrag)),"candidate:"+t.join(" ")},n.parseIceOptions=function(e){return e.substr(14).split(" ")},n.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.numChannels=3===t.length?parseInt(t[2],10):1,n},n.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},n.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),o=0;o<r.length;o++)t=r[o].trim().split("="),n[t[0].trim()]=t[1];return n},n.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){r.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},n.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},n.getMid=function(e){var t=n.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},n.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},n.getDtlsParameters=function(e,t){var r=n.matchPrefix(e+t,"a=fingerprint:");return{role:"auto",fingerprints:r.map(n.parseFingerprint)}},n.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},n.getIceParameters=function(e,t){var r=n.splitLines(e);r=r.concat(n.splitLines(t));var o={usernameFragment:r.filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:r.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)};return o},n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},n.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=n.splitLines(e),o=r[0].split(" "),i=3;i<o.length;i++){var a=o[i],s=n.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(s){var c=n.parseRtpMap(s),d=n.matchPrefix(e,"a=fmtp:"+a+" ");switch(c.parameters=d.length?n.parseFmtp(d[0]):{},c.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(n.parseRtcpFb),t.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase())}}}return n.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(n.parseExtmap(e))}),t},n.writeRtpDescription=function(e,t){
var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){r+=n.writeRtpMap(e),r+=n.writeFmtp(e),r+=n.writeRtcpFb(e)});var o=0;return t.codecs.forEach(function(e){e.maxptime>o&&(o=e.maxptime)}),o>0&&(r+="a=maxptime:"+o+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions.forEach(function(e){r+=n.writeExtmap(e)}),r},n.parseRtpEncodingParameters=function(e){var t,r=[],o=n.parseRtpParameters(e),i=o.fecMechanisms.indexOf("RED")!==-1,a=o.fecMechanisms.indexOf("ULPFEC")!==-1,s=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,d=n.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});d.length>0&&d[0].length>1&&d[0][0]===c&&(t=d[0][1]),o.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:t}};r.push(n),i&&(n=JSON.parse(JSON.stringify(n)),n.fec={ssrc:t,mechanism:a?"red+ulpfec":"red"},r.push(n))}}),0===r.length&&c&&r.push({ssrc:c});var l=n.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,r.forEach(function(e){e.maxBitrate=l})),r},n.parseRtcpParameters=function(e){var t={},r=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var o=n.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=o.length>0,t.compound=0===o.length;var i=n.matchPrefix(e,"a=rtcp-mux");return t.mux=i.length>0,t},n.parseMsid=function(e){var t,r=n.matchPrefix(e,"a=msid:");if(1===r.length)return t=r[0].substr(7).split(" "),{stream:t[0],track:t[1]};var o=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return o.length>0?(t=o[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(e,t){var r,o=void 0!==t?t:2;return r=e?e:n.generateSessionId(),"v=0\r\no=thisisadapterortc "+r+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(e,t,r,o){var i=n.writeRtpDescription(e.kind,t);if(i+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),i+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),i+="a=mid:"+e.mid+"\r\n",i+=e.direction?"a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var a="msid:"+o.id+" "+e.rtpSender.track.id+"\r\n";i+="a="+a,i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,i+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),i},n.getDirection=function(e,t){for(var r=n.splitLines(e),o=0;o<r.length;o++)switch(r[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[o].substr(2)}return t?n.getDirection(t):"sendrecv"},n.getKind=function(e){var t=n.splitLines(e),r=t[0].split(" ");return r[0].substr(2)},n.isRejected=function(e){return"0"===e.split(" ",2)[1]},e.exports=n},function(e,t){"use strict";var n=function(){function e(){}return e.attachStream=function(e,t){t.srcObject=e,t.play()},e.detachStream=function(e){e.pause(),e.src=""},e.getScreenMedia=function(){return new Promise(function(e,t){t(new Error("Screen sharing not allowed for you platform"))})},e.getRTCStats=function(e){return new Promise(function(e,t){t(new Error("RTCStats sharing not allowed for you platform"))})},e}();t.Edge=n},function(e,t,n){"use strict";var r=n(44),o=n(20),i=n(15),a=n(1),s=function(){function e(){}return e.attachStream=function(e,t){t.mozSrcObject=e,t.load(),t.play()},e.detachStream=function(e){e.mozSrcObject=null,e.load(),e.src=""},e.screenSharingSupported=function(){return new Promise(function(e,t){return"https:"!=window.location.protocol?void e(!1):void e(!0)})},e.getScreenMedia=function(){var e={audio:!1,video:{mediaSource:"window"}};return a.LogManager.get().writeMessage(a.LogCategory.USERMEDIA,"[constraints]",a.LogLevel.TRACE,JSON.stringify(e)),navigator.mediaDevices.getUserMedia(e)},e.getRTCStats=function(e){return new Promise(function(t,n){e.getStats().then(function(e){var n=[];e.forEach(function(e){"inboundrtp"!=e.type&&"outboundrtp"!=e.type||n.push(e)}),t(n)}).catch(n)})},e.getUserMedia=function(e){return new Promise(function(t,n){var i=new MediaStream,s=o.MediaCache.get(),c=[];new Promise(function(t,n){var o=[];if("undefined"!=typeof e.audio&&e.audio!==!1){var i=r.Md5.hashStr(JSON.stringify(e.audio));s.getTrack(i,"audio").then(function(n){if("undefined"!=typeof n&&"ended"!==n.readyState)o.push(n),t(o);else{var r=JSON.parse(JSON.stringify(e));r.video=!1,a.LogManager.get().writeMessage(a.LogCategory.USERMEDIA,"[constraints]",a.LogLevel.TRACE,JSON.stringify(r)),navigator.mediaDevices.getUserMedia(r).then(function(e){for(var n=0,r=e.getTracks();n<r.length;n++){var a=r[n];s.setTrack(i,"audio",a),o.push(a)}t(o)}).catch(function(e){t([])})}})}else t([])}).then(function(t){return new Promise(function(n,o){if("undefined"!=typeof e.video&&e.video!==!1){var i=r.Md5.hashStr(JSON.stringify(e.video));c.push(new Promise(function(r,o){s.getTrack(i,"video").then(function(r){if("undefined"!=typeof r&&"ended"!==r.readyState)t.push(r),n(t);else{var o=JSON.parse(JSON.stringify(e));o.audio=!1,a.LogManager.get().writeMessage(a.LogCategory.USERMEDIA,"[constraints]",a.LogLevel.TRACE,JSON.stringify(o)),navigator.mediaDevices.getUserMedia(o).then(function(e){for(var r=0,o=e.getTracks();r<o.length;r++){var a=o[r];s.setTrack(i,"video",a),t.push(a),n(t)}}).catch(function(e){n(t)})}})}))}else n(t)})}).then(function(e){for(var r=0,o=e;r<o.length;r++){var a=o[r];"undefined"!=typeof a&&i.addTrack(a)}e.length>0?t(i):n()}).catch(function(e){n(e)})})},e.getDTMFSender=function(e,t){var n=/Firefox\/([0-9\.]+)(?:\s|$)/,r=navigator.userAgent;if(n.test(r)){var o=n.exec(r),a=o[1].split(".");if(+a[0]>=53){var s=e.getSenders().map(function(e){if("audio"===e.track.kind&&e.dtmf)return e.dtmf});if(s.length>0)return s[0]}}return new i.SignalingDTMFSender(t)},e}();t.FF=s},function(e,t,n){"use strict";var r=n(15),o=function(){function e(){}return e.attachStream=function(e,t){t.srcObject=e},e.detachStream=function(e){if(e instanceof HTMLVideoElement){var t=e.pause();"undefined"!=typeof t&&t.catch(function(e){})}else e.pause();e.src=""},e.getDTMFSender=function(e,t){return e.createDTMFSender?e.createDTMFSender(e.getLocalStreams()[0].getAudioTracks()[0]):new r.SignalingDTMFSender(t)},e.getScreenMedia=function(){return new Promise(function(e,t){window.postMessage("get-sourceId","*"),window.addEventListener("message",function(n){if(n.origin==window.location.origin&&("PermissionDeniedError"==n.data&&t(new Error("PermissionDeniedError")),"string"!=typeof n.data&&"undefined"!=typeof n.data.sourceId)){var r={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080,chromeMediaSourceId:n.data.sourceId},optional:[{googTemporalLayeredScreencast:!0}]}};navigator.mediaDevices.getUserMedia(r).then(function(t){e(t)}).catch(function(e){t(e)})}})})},e.getRTCStats=function(e){return new Promise(function(t,n){var r=[];e.getStats().then(function(e){e.forEach(function(e){if("ssrc"==e.type){var t={};t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,r.push(t)}}),t(r)}).catch(n)})},e}();t.Safari=o},function(e,t,n){"use strict";var r=n(15),o=n(7),i=n(1),a=function(){function e(){}return e.attachStream=function(e,t){if(t.srcObject?t.srcObject=e:t.src=URL.createObjectURL(e),t.load(),t instanceof HTMLVideoElement)t.play().catch(function(e){});else{t.play();var n=o.Client.getInstance()._defaultSinkId;null!=n&&t.setSinkId(n)}},e.detachStream=function(e){if(e instanceof HTMLVideoElement){var t=e.pause();"undefined"!=typeof t&&t.catch(function(e){})}else e.pause();e.src=""},e.getDTMFSender=function(e,t){if(!e.createDTMFSender)return new r.SignalingDTMFSender(t);var n=[];return e.getLocalStreams().forEach(function(e){e.getAudioTracks().forEach(function(e){n.push(e)})}),n.length?e.createDTMFSender(n[0]):void 0},e.getUserMedia=function(e){return navigator.mediaDevices.getUserMedia(e)},e.screenSharingSupported=function(){return new Promise(function(e,t){window.postMessage("VoximplantWebsdkCheckExtension","*");var n=function(t){t.origin!==window.location.origin&&"VoximplantWebsdkExtensionLoaded"!==t.data||(window.removeEventListener("message",n),clearTimeout(r),e(!0))},r=setTimeout(function(){window.removeEventListener("message",n),e(!1)},800);window.addEventListener("message",n)})},e.getScreenMedia=function(){return new Promise(function(e,t){window.postMessage("voximplantWebsdkGetSourceId","*");var n=function(r){if(r.data&&r.origin===window.location.origin&&r.data.result){if("err"===r.data.result)return t(new Error(r.data.reason));if("ok"===r.data.result&&"undefined"!=typeof r.data.sourceId){window.removeEventListener("message",n);var o={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080,chromeMediaSourceId:r.data.sourceId},optional:[{googTemporalLayeredScreencast:!0}]}};i.LogManager.get().writeMessage(i.LogCategory.USERMEDIA,"[constraints]",i.LogLevel.TRACE,JSON.stringify(o)),navigator.mediaDevices.getUserMedia(o).then(e,t)}}};window.addEventListener("message",n)})},e.getRTCStats=function(e){return new Promise(function(t,n){var r=[];e.getStats().then(function(e){e.forEach(function(e){"outbound-rtp"!=e.type&&"inbound-rtp"!=e.type||r.push(e)}),t(r)}).catch(n)})},e}();t.Webkit=a},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=n(14),a=n(3),s=n(1),c=n(4),d=n(2),l=n(12),u=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.answer=function(t,n,r){var o=this;e.prototype.answer.call(this,t,n),"undefined"!=typeof t&&("undefined"!=typeof n&&"object"==typeof n||(n={}),n[l.Constants.CALL_DATA_HEADER]=t);var i=c.UserMediaManager.get();"undefined"==typeof r?i.attachTo(this._peerConnection):r.sendVideo?(this._peerConnection.setVideoFlags(r),this.videoDirections=r,i.attachTo(this._peerConnection)):(this._peerConnection.setVideoFlags(r),this.videoDirections=r,i.attachToSound(this._peerConnection)),this._peerConnection.getLocalAnswer().then(function(e){var t={tracks:o.peerConnection.getTrackKind()};a.VoxSignaling.get().callRemoteFunction(d.RemoteFunction.acceptCall,o.id(),n,e.sdp,t)})},t.prototype.setActive=function(e){return this.peerConnection.hold(!e)},o([s.LogManager.d_trace(s.LogCategory.CALL)],t.prototype,"answer",null),o([s.LogManager.d_trace(s.LogCategory.CALL)],t.prototype,"setActive",null),t}(i.Call);t.CallExMedia=u},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=n(14),a=n(3),s=n(1),c=n(4),d=n(2),l=n(12),u=function(e){function t(){e.apply(this,arguments)}return r(t,e),t.prototype.answer=function(t,n,r){var o=this;e.prototype.answer.call(this,t,n),"undefined"!=typeof t&&("undefined"==typeof n&&(n={}),n[l.Constants.CALL_DATA_HEADER]=t);var i=c.UserMediaManager.get();"undefined"==typeof r?i.attachTo(this._peerConnection):r.sendVideo?i.attachTo(this._peerConnection):i.attachToSound(this._peerConnection),this._peerConnection.getLocalAnswer().then(function(e){a.VoxSignaling.get().callRemoteFunction(d.RemoteFunction.acceptCall,o.id(),n,e.sdp)})},o([s.LogManager.d_trace(s.LogCategory.CALLEXP2P)],t.prototype,"answer",null),t}(i.Call);t.CallExP2P=u},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=n(14),a=n(3),s=n(6),c=n(1),d=n(2),l=function(e){function t(t,n,r,o){e.call(this,t,n,r,o),this._mode=i.CallMode.SERVER}return r(t,e),t.prototype.answer=function(t,n){e.prototype.answer.call(this,t,n);var r={tracks:this.peerConnection.getTrackKind()};a.VoxSignaling.get().callRemoteFunction(d.RemoteFunction.acceptCall,this._id,s.CallManager.cleanHeaders(n),r)},o([c.LogManager.d_trace(c.LogCategory.CALLEXSERVER)],t.prototype,"answer",null),t}(i.Call);t.CallExServer=l},function(e,t,n){"use strict";var r=n(3),o=n(2),i=function(){function e(){}return e.register=function(e){return new Promise(function(t,n){var i=r.VoxSignaling.get().callRemoteFunction(o.RemoteFunction.registerPushToken,e);i?t():n()})},e.unregister=function(e){return new Promise(function(t,n){var i=r.VoxSignaling.get().callRemoteFunction(o.RemoteFunction.unregisterPushToken,e);i?t():n()})},e.incomingPush=function(e){return new Promise(function(t,n){var i=r.VoxSignaling.get().callRemoteFunction(o.RemoteFunction.pushFeedback,e);i?t():n()})},e}();t.PushService=i},function(e,t,n){"use strict";var r=n(17),o=r.Events.ConnectionFailed,i=n(6),a=n(3),s=n(2),c=r.Events.ConnectionEstablished,d=n(4),l=n(13),u=n(10),p=n(11),g=function(){function e(e){var t=this;this.client=e,this.currentCall=null,this.onConnectionFailed=null,this.onConnectionEstablished=null,this.onCheckComplete=null,this.onCallFailed=null,this.onCallConnected=null,this.onCallEnded=null,this.onCallRinging=null,this.onCallMediaStarted=null,this.onVoicemail=null,this.onNetStatsReceived=null,"2"==i.CallManager.get().protocolVersion,e.on(o,function(e){return t.runLegacyCallback(t.onConnectionFailed,e)}),e.on(c,function(e){return t.runLegacyCallback(t.onConnectionEstablished,e)}),a.VoxSignaling.get().setRPCHandler(l.RemoteEvent.handlePreFlightCheckResult,function(e,n,r){return t.onCheckComplete(e,n,r)}),a.VoxSignaling.get().setRPCHandler(l.RemoteEvent.handleVoicemail,function(e){return t.runLegacyCallback(t.onVoicemail,e)})}return e.prototype.connectTo=function(e,t,n,r){var o=a.VoxSignaling.get();u.Authenticator.get().ziAuthorized(!0),o.lagacyConnectTo(e,t,n,r)},e.prototype.connect=function(){},e.prototype.requestMedia=function(e,t,n,r){var o=d.UserMediaManager.get();o.enableAudio(!0),o.queryMedia().then(function(e){d.UserMediaManager.get().updateLocalVideo(e),"function"==typeof t&&t(e)}).catch(function(e){"function"==typeof n&&n(e)})},e.prototype.hangupCall=function(e,t){i.CallManager.get().calls[e].hangup(t),a.VoxSignaling.get().callRemoteFunction(s.RemoteFunction.disconnectCall,e,{})},e.prototype.callTo=function(e,t,n,r){return this.currentCall=this.client.call({number:e,video:t,extraHeaders:n,extraParams:r}),this.bindCurrentCall(),this.currentCall.id()},e.prototype.voicemailPromptFinished=function(e){a.VoxSignaling.get().callRemoteFunction(s.RemoteFunction.zPromptFinished,e)},e.prototype.makeid=function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t},e.prototype.muteMicrophone=function(e){var t=i.CallManager.get();for(var n in t.calls)t.calls.hasOwnProperty(n)&&(e?t.calls[n].muteMicrophone():t.calls[n].unmuteMicrophone())},e.prototype.sendDigit=function(e,t){a.VoxSignaling.get().callRemoteFunction(s.RemoteFunction.sendDTMF,e,t)},e.prototype.startPreFlightCheck=function(e,t){a.VoxSignaling.get().callRemoteFunction(s.RemoteFunction.zStartPreFlightCheck,!!e,!!t)},e.prototype.runLegacyCallback=function(e,t){"undefined"!=typeof e&&null!==e&&e(t)},e.prototype.bindCurrentCall=function(){var e=this;window.currentCall=this.currentCall,this.currentCall.on(p.CallEvents.Failed,function(t){e.runLegacyCallback(e.onCallFailed,t),e.unbindCurrentCall()}),this.currentCall.on(p.CallEvents.Connected,function(t){e.runLegacyCallback(e.onCallConnected,t),e.runLegacyCallback(e.onCallMediaStarted,t);i.CallManager.get();setTimeout(function(){var e=document.getElementById(window.currentCall.peerConnection.impl.getRemoteStreams()[0].getTracks()[0].id);e.srcObject=window.currentCall.peerConnection.impl.getRemoteStreams()[0],e.load(),e.play()},1e3)}),this.currentCall.on(p.CallEvents.Disconnected,function(t){e.runLegacyCallback(e.onCallEnded,t),e.unbindCurrentCall()}),this.client.on(r.Events.NetStatsReceived,function(t){return e.onNetStatsReceived(t)})},e.prototype.unbindCurrentCall=function(){this.currentCall.off(p.CallEvents.Failed),this.currentCall.off(p.CallEvents.Connected),this.currentCall.off(p.CallEvents.Disconnected),this.currentCall.off(p.CallEvents.ProgressToneStart),this.currentCall.off(p.CallEvents.Connected),this.client.off(r.Events.NetStatsReceived)},e}();t.ZingayaAPI=g},function(e,t){"use strict";var n=function(){function e(){}return e.prototype.clone=function(){var t=new e;return t.videoInputId=this.videoInputId,t.audioInputId=this.audioInputId,t.audioEnabled=this.audioEnabled,t.videoEnabled=this.videoEnabled,t.videoSettings=this.videoSettings,t},e.prototype.setVideoSettings=function(e){this.videoSettings=e,"undefined"!=typeof e.deviceId&&(this.videoInputId=e.deviceId)},e}();t.MediaCaptureConfig=n},function(e,t,n){"use strict";var r=n(5),o=n(1),i=function(){function e(e){this.kind=e,this.inUse=!1,this.track=null,this.callId=null}return e.prototype.attach=function(e,t){r.default.attachMedia(new MediaStream([e]),this.element),this.direction=t},e.prototype.free=function(){r.default.detachMedia(this.element),this.inUse=!1,this.track=null,this.callId=null},e}();t.ReusableStructure=i;var a=function(){function e(){this.elementList=new Array,this.log=o.LogManager.get().createLogger(o.LogCategory.RTC,"Renderer")}return e.get=function(){return this.inst||(this.inst=new e),this.inst},e.prototype.getFreeElements=function(e){return this.elementList.filter(function(t){if(t.inUse&&("all"==e||e==t.kind))return!0})},e.prototype.catchRender=function(e,t,n){var r,o=this.getFreeElements(e.kind);return o.length?r=o[0]:(r=new i(e.kind),this.elementList.push(r)),r.inUse=!0,r.track=e,r.callId=t,r.attach(e,n),r.element},e.prototype.catchRenders=function(e,t,n){for(var r=e.getTracks(),o=[],i=0;i<r.length;i++)o.push(this.catchRender(r[i],t,n));return o},e.prototype.freeRendersByCallId=function(e,t){void 0===t&&(t="all"),this.elementList.map(function(n){n.callId!=e||"all"!=t&&t!=n.direction||n.free()})},e.prototype.freeRenderByTrack=function(e){this.elementList.map(function(t){t.track.id==e.id&&t.free()})},e.prototype.getRendererByCallId=function(e,t){void 0===t&&(t="all"),this.elementList.filter(function(n){if(n.callId==e&&("all"==t||t==n.direction))return!0})},e}();t.ReusableRenderer=a},function(e,t){"use strict";var n=function(){function e(e){this.originalSDP=e}return e.splitSections=function(e){var t=e.split("\nm=");return t.map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},e.prototype.getCodecList=function(){this.originalCodecList={prefix:"",sections:[],sufix:""};var t=RegExp.prototype.test.bind(/^([a-z])=(.*)/),n=e.splitSections(this.originalSDP);this.originalCodecList.prefix=n[0];for(var r=1;r<n.length;r++){var o={kind:"audio",firstLine:"",prefix:"",sufix:"",codec:[]},i=n[r].split("\na=rtpmap");i=i.map(function(e,t){return(t>0?"a=rtpmap"+e:e).trim()+"\r\n"}),o.prefix=i.shift();var a=i.pop();a=a.split(/(\r\n|\r|\n)/).filter(t);var s=!0;for(i.push("");s;)if(s=!1,0!==a.length){var c=a.shift();0===c.indexOf("a=rtpmap")||0===c.indexOf("a=rtcp-fb")||0===c.indexOf("a=fmtp")||0===c.indexOf("a=x-caps")||0===c.indexOf("a=maxptime")?(i[i.length-1]+=c+"\r\n",s=!0):a.unshift(c)}for(var d=0;d<i.length;d++)o.codec.push(i[d].split(/(\r\n|\r|\n)/).filter(t));var l=o.prefix.split(/(\r\n|\r|\n)/).filter(t);o.firstLine=l.shift();var u=o.firstLine.split(" ");u.splice(-1*o.codec.length,o.codec.length),o.kind=u[0].substring(2),o.prefix=l.join("\r\n")+"\r\n",o.firstLine=u.join(" "),a.length>0&&(o.sufix=a.join("\r\n")+"\r\n"),this.originalCodecList.sections.push(o)}return this.originalCodecList},e.prototype.getUserCodecList=function(){"undefined"==typeof this.originalCodecList&&this.getCodecList();var t={sections:[]};return t.sections=this.originalCodecList.sections.filter(function(e){return"video"===e.kind||"audio"===e.kind}).map(function(t,n,r){for(var o={kind:t.kind,codec:t.codec.map(function(t){return e.codecToUserCodec(t)})},i=[],a=0,s=o.codec;a<s.length;a++){var c=s[a];i.indexOf(c)===-1&&i.push(c)}return o.codec=i,o}),t},e.codecToUserCodec=function(e){var t=e[0].split(" ");return t.shift(),t.join(" ")},e.prototype.setUserCodecList=function(t){"undefined"==typeof this.originalCodecList&&this.getCodecList();for(var n=0;n<t.sections.length;n++)for(var r=0;r<this.originalCodecList.sections.length;r++)t.sections[n].kind===this.originalCodecList.sections[r].kind&&(this.originalCodecList.sections[r].codec=e.resortSection(t.sections[n].codec,this.originalCodecList.sections[r].codec))},e.resortSection=function(t,n){for(var r=[],o=0;o<t.length;o++)for(var i=0;i<n.length;i++)t[o]===e.codecToUserCodec(n[i])&&r.push(n[i]);return r},e.prototype.getSDP=function(){for(var e=this.originalCodecList.prefix,t=0;t<this.originalCodecList.sections.length;t++){for(var n="",r=[],o=0;o<this.originalCodecList.sections[t].codec.length;o++)r.push(this.originalCodecList.sections[t].codec[o][0].split(" ")[0].substring(9)),n+=this.originalCodecList.sections[t].codec[o].join("\r\n")+"\r\n";e+=this.originalCodecList.sections[t].firstLine+" "+r.join(" ")+"\r\n",e+=this.originalCodecList.sections[t].prefix,e+=n,e+=this.originalCodecList.sections[t].sufix}return e},e.downOpusBandwidth=function(e){return new Promise(function(t,n){for(var r=RegExp.prototype.test.bind(/^([a-z])=(.*)/),o=e.sdp.split(/(\r\n|\r|\n)/).filter(r),i=!1,a=0;a<o.length;a++)o[a].indexOf("a=fmtp:114")!==-1&&(o[a]="a=fmtp:114 minptime=10; useinbandfec=1; sprop-maxcapturerate=8000",i=!0),o[a].indexOf("a=fmtp:111")!==-1&&(o[a]="a=fmtp:111 minptime=10; useinbandfec=1; sprop-maxcapturerate=8000",i=!0);i||n(e),e.sdp=o.join("\r\n")+"\r\n",t(e)})},e}();t.CodecSorter=n},function(e,t){"use strict";var n=function(){function e(){}return e.detectDirections=function(t){var n=[],r=t.split(/(\r\n|\r|\n)/).filter(e.validLine),o="";return r.forEach(function(e){if(0===e.indexOf("m=")){var t=e.substr(2);o=t.split(" ")[0]}""===o||"a=sendrecv"!==e&&"a=sendonly"!==e&&"a=recvonly"!==e&&"a=inactive"!==e||(n.push({type:o,direction:e.substr(2)}),o="")}),n},e.removeTelephoneEvents=function(t){if(t.sdp.indexOf("a=rtpmap:127 telephone-event/8000")!==-1){for(var n=t.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine),r=-1,o=0;o<n.length;o++){if(n[o].indexOf("m=audio")!==-1){var i=n[o];"string"==typeof i&&(n[o]=i.replace(" 127",""))}n[o].indexOf("a=rtpmap:127 telephone-event/8000")!==-1&&(r=o)}n.splice(r,1),t.sdp=n.join("\r\n")+"\r\n"}return t},e.removeDoubleOpus=function(t){if(t.sdp.indexOf("a=rtpmap:109 opus")!==-1&&t.sdp.indexOf("a=rtpmap:111 opus")!==-1){for(var n=t.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine),r=-1,o=0;o<n.length;o++){if(n[o].indexOf("m=audio")!==-1){var i=n[o];"string"==typeof i&&(n[o]=i.replace(" 109",""))}n[o].indexOf("a=rtpmap:109 opus")!==-1&&(r=o)}n.splice(r,1),t.sdp=n.join("\r\n")+"\r\n"}return t},e.removeTIAS=function(t){if(t.sdp.indexOf("b=TIAS")!==-1){var n=t.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine),r=[];n.forEach(function(e,t){e.indexOf("b=TIAS")!==-1&&r.unshift(t)}),r.forEach(function(e){return n.splice(e,1)}),t.sdp=n.join("\r\n")+"\r\n"}return t},e.fixVideoRecieve=function(t,n){var r=t.sdp.indexOf("m=video");if(r!==-1&&!n){var o=t.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine),i=null;o=o.map(function(e,t){return null===i?e.indexOf("m=video")!==-1&&(i=t):"a=sendrecv"===e?e="a=sendonly":"a=recvonly"===e&&(e="a=inactive"),e}),t.sdp=o.join("\r\n")+"\r\n"}return t},e.validLine=RegExp.prototype.test.bind(/^([a-z])=(.*)/),e}();t.SDPMuggle=n},function(e,t,n){"use strict";var r,o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=n(19),s=n(5),c=n(4),d=n(18),l=n(8),u=n(1),p=n(3),g=n(6),f=n(2),h=n(39),v=n(11),C=n(16),m=n(12),y=v.CallEvents.Updated,L=n(40),S=n(7),E=n(23);!function(e){e[e.offer="offer"]="offer",e[e.answer="answer"]="answer",e[e.pranswer="pranswer"]="pranswer",e[e.rollback="rollback"]="rollback"}(r||(r={}));var _;!function(e){e[e.controlling="controlling"]="controlling",e[e.controlled="controlled"]="controlled"}(_||(_={}));var M=function(e){function t(t,n,r){var o=this;e.call(this,t,n,r),this.iceTimer=null,this.needTransportRestart=!0,this.ICE_TIMEOUT=2e4,this.RENEGOTIATION_TIMEOUT=15e3,this._canReInvite=function(){return"connected"===o.impl.iceConnectionState||"completed"===o.impl.iceConnectionState};var i=l.PCFactory.get().iceConfig,a=i;if(null===a&&(a={gatherPolicy:"all",iceServers:[]}),this.impl=new RTCPeerConnection(a,{optional:[{DtlsSrtpKeyAgreement:"true"}]}),"undefined"!=typeof this.impl.ontrack?this.impl.ontrack=function(e){return o.onAddTrack(e)}:"undefined"!=typeof this.impl.onaddtrack?this.impl.onaddtrack=function(e){return o.onAddTrack(e)}:this.impl.onaddstream=function(e){return o.onAddStream(e)},this.impl.onicecandidate=function(e){o.onICECandidate(e.candidate)},this.rtpSenders=[],this.renegotiationInProgress=!1,this.impl.onnegotiationneeded=function(e){return o.onRenegotiation()},this.impl.onsignalingstatechange=function(e){return o.onSignalingStateChange()},this.impl.oniceconnectionstatechange=function(e){return o.onConnectionChange()},this.iceRole=_.controlling,this._remoteStreams=[],this.banReinviteAnswer=!1,this._call=g.CallManager.get().calls[this.id],"undefined"!=typeof this._call?this.onHold=!this._call.active():this.onHold=!1,this.rtcCollectingCycle=setInterval(function(){o.getPCStats()},g.CallManager.get().rtcStatsCollectionInterval),"undefined"!=typeof this._call){var s=this._call.headers()[m.Constants.CALLSTATSIOID_HEADER];"undefined"==typeof s&&(s=this._call.id()),C.CallstatsIo.get().addNewFabric(this.impl,this._call.number(),r?C.CallstatsIoFabricUsage.multiplex:C.CallstatsIoFabricUsage.audio,s)}this.needTransportRestart=!1,"_default"!==t&&g.CallManager.get().calls[t]&&(this.reInviteQ=new E.ReInviteQ(g.CallManager.get().calls[t],this._canReInvite))}return o(t,e),t.prototype.onSignalingStateChange=function(){this.log.info("Signal state changed to "+this.impl.signalingState+" for PC:"+this.id),"stable"===this.impl.signalingState},t.prototype.getPCStats=function(){var e=this;s.default.getRTCStats(this.impl).then(function(t){"undefined"!=typeof e._call&&e._call.dispatchEvent({name:"RTCStatsReceived",stats:t})})},t.prototype.onConnectionChange=function(){"completed"===this.impl.iceConnectionState&&"undefined"!=typeof this._call&&this._call.dispatchEvent({name:"ICECompleted",call:this._call}),"completed"!==this.impl.iceConnectionState&&"connected"!==this.impl.iceConnectionState||(this.iceTimer&&clearTimeout(this.iceTimer),this.iceTimer=null,this.reInviteQ&&this.reInviteQ.runNext())},t.prototype.onRenegotiation=function(){var e=this;if("undefined"!=typeof this.impl){if("disconnected"===this.impl.connectionState||"failed"===this.impl.connectionState)return void this.log.info("Renegotiation requested on closed PeerConnection");if(null===this.impl.localDescription)return void this.log.info("Renegotiation needed, but no local SD, skipping");if("connected"!==this.impl.iceConnectionState&&"completed"!==this.impl.iceConnectionState)return this.log.info("Renegotiation requested while ice state is "+this.impl.iceConnectionState+". Postponing"),void setTimeout(this.onRenegotiation,100);if(this.renegotiationInProgress)return void this.log.info("Renegotiation in progress. Queueing");if(this.log.info("Renegotiation started"),this.renegotiationInProgress===!1){this.renegotiationInProgress=!0;var t=this.getReceiveOptions();this.updateHoldState(),this.impl.createOffer(t).then(function(t){return e.codecRearrange(t)}).then(function(t){var n={type:t.type,sdp:t.sdp};return n=l.PCFactory.get().addBandwidthParams(n),n=L.SDPMuggle.removeTelephoneEvents(n),n=L.SDPMuggle.removeDoubleOpus(n),n=L.SDPMuggle.fixVideoRecieve(n,e.videoEnabled.receiveVideo)}).then(function(t){return e.srcLocalSDP=t.sdp,e.pendingOffer=t,t}).then(function(){var t={tracks:e._getTrackKind()};p.VoxSignaling.get().callRemoteFunction(f.RemoteFunction.reInvite,e._call.id(),{},e.pendingOffer.sdp,t)}).catch(function(t){e.log.error("Error when renegatiation start "+t.message)})}else this.log.error("Another renegatiation in progress")}},t.prototype.getReceiveOptions=function(){return{offerToReceiveAudio:!this.onHold,offerToReceiveVideo:this.videoEnabled.receiveVideo&&!this.onHold}},t.prototype.updateHoldState=function(){var e=this;this.impl.getLocalStreams().forEach(function(t){t.getTracks().forEach(function(t){t.enabled=!e.onHold})}),this.impl.getRemoteStreams().forEach(function(t){t.getTracks().forEach(function(t){t.enabled=!e.onHold})})},t.prototype.onICECandidate=function(e){e&&null!==e?this.sendLocalCandidateToPeer("a="+e.candidate,e.sdpMLineIndex):this.log.info("End of candidates")},t.prototype.onAddTrack=function(e){var t=e.track.kind,n=new MediaStream([e.track]),r=this.renderStream(n,t);"video"===t&&"undefined"==typeof this.videoRendered?this.videoRendered=r:"undefined"==typeof this.audioRendered&&(this.audioRendered=r),this.updateHoldState(),this._remoteStreams.push(n),this.renderers.push(r),this.mapRenderer(n,r)},t.prototype.mapRenderer=function(e,t){var n=this;e.getTracks().forEach(function(r){r.onended=function(){n.checkStreamActive(e,t)}})},t.prototype.checkStreamActive=function(e,t){e.getTracks().some(function(e){return"live"===e.readyState})||d.Renderer.get().releaseElement(t)},t.prototype.onAddStream=function(e){var t=c.UserMediaManager.getVideoTracks(e.stream).length?"video":"audio",n=this.renderStream(e.stream,t);"video"===t&&"undefined"==typeof this.videoRendered?this.videoRendered=n:"undefined"==typeof this.audioRendered&&(this.audioRendered=n),
this.updateHoldState(),this._remoteStreams.push(e.stream),this.renderers.push(n),this.mapRenderer(e.stream,n)},t.prototype.renderStream=function(e,t,n){void 0===n&&(n=!1);var r=document.body,o=e.getTracks(),i=S.Client.getInstance().remoteVideoContainerId;n&&(i=S.Client.getInstance().localVideoContainerId),"video"!==t&&"sharing"!==t||"undefined"==typeof i||(r=document.getElementById(i));var a=d.Renderer.get().getElement(o[0].id,"video"===t||"sharing"===t,r);return e.oninactive&&e.oninactive(function(){s.default.detachMedia(a)}),"undefined"!=typeof this.sinkId&&a.setSinkId(this.sinkId),s.default.attachMedia(e,a),"undefined"==typeof this._call||n?n&&this._call.dispatchEvent({name:v.CallEvents.LocalVideoStreamAdded,videoStream:e,element:a,type:t}):this._call.dispatchEvent({name:v.CallEvents.MediaElementCreated,call:this._call,element:a,type:t}),a},t.prototype.checkMediaAttached=function(e){return this._remoteStreams.length>0&&this._remoteStreams.reduce(function(t,n){return"audio"===e?t&&n.getAudioTracks().length>0:"video"===e?t&&n.getVideoTracks().length>0:t},!0)},t.prototype.wireRemoteStream=function(e){return new Promise(function(e,t){t(new Error("Not implemented"))})},t.prototype._processRemoteAnswer=function(e,t){var n=this;if(this.iceTimer=setTimeout(function(){n._call.notifyICETimeout()},this.ICE_TIMEOUT),this.pendingEvent=[e,t],null===this.impl.remoteDescription||""==this.impl.remoteDescription.sdp){var o={sdp:t,type:r.answer};return this.srcRemoteSDP=t,o=L.SDPMuggle.removeTIAS(o),this.impl.setRemoteDescription(o)}},t.prototype._getLocalOffer=function(){var e=this;return this.iceRole=_.controlling,new Promise(function(t,n){var r=e.getReceiveOptions();e.impl.createOffer(r).then(function(t){var n={type:t.type,sdp:t.sdp};return n=l.PCFactory.get().addBandwidthParams(n),e.codecRearrange(n)}).then(function(t){return e.srcLocalSDP=t.sdp,e.impl.setLocalDescription(t)}).then(function(){t(e.impl.localDescription)}).catch(function(e){n(e)})})},t.prototype._getLocalAnswer=function(){var e=this;return this.iceRole=_.controlled,new Promise(function(t,n){var o={mandatory:e.getReceiveOptions()};e.impl.createAnswer(o).then(function(t){var n={type:t.type,sdp:t.sdp};return n=l.PCFactory.get().addBandwidthParams(n),n=L.SDPMuggle.fixVideoRecieve(n,e.videoEnabled.receiveVideo),e.codecRearrange(n)}).then(function(t){return e.srcLocalSDP=t.sdp,e.impl.setLocalDescription(t)}).then(function(){t({type:r.answer,sdp:e.impl.localDescription.sdp})}).catch(function(e){n(e)})})},t.prototype._setRemoteDescription=function(e){var t=new RTCSessionDescription({sdp:e,type:r.offer});return t=L.SDPMuggle.removeTIAS(t),this.srcRemoteSDP=e,this.impl.setRemoteDescription(t)},t.prototype._processRemoteOffer=function(e){var t=this;return this.iceRole=_.controlled,new Promise(function(n,o){var i=new RTCSessionDescription({sdp:e,type:r.offer});t.srcRemoteSDP=e,i=L.SDPMuggle.removeTIAS(i),t.impl.setRemoteDescription(i).then(function(){var e={mandatory:t.getReceiveOptions()};return t.impl.createAnswer(e)}).then(function(e){return t.codecRearrange(e)}).then(function(e){return t.srcLocalSDP=e.sdp,t.impl.setLocalDescription(e)}).then(function(){n(t.impl.localDescription.sdp)}).catch(function(e){o(e)})})},t.prototype._close=function(){var e=this;clearInterval(this.rtcCollectingCycle),this.impl.onnegotiationneeded=null,this.impl.removeTrack?this.rtpSenders.forEach(function(t){e.impl.removeTrack(t)}):this.impl.getLocalStreams().forEach(function(t){t.getTracks().forEach(function(e){e.stop(),t.removeTrack(e)}),e.impl.removeStream(t)}),"closed"!==this.impl.signalingState&&this.impl.close(),"undefined"!=typeof this._call&&C.CallstatsIo.get().sendFabricEvent(this.impl,C.CallstatsIoFabricEvent.fabricTerminated,this._call.id()),this._localStream=null,this._remoteStreams=null},t.prototype._addRemoteCandidate=function(e,t){var n=this;return new Promise(function(r,o){try{n.impl.addIceCandidate(new RTCIceCandidate({candidate:e.substring(2),sdpMLineIndex:t})).then(function(){r()}).catch(function(){r()})}catch(e){r()}})},t.prototype._bindLocalMedia=function(){var e=this;if("undefined"!=typeof this._localStream){if("firefox"===s.default.getWSVendor()?this._localStream.getTracks().forEach(function(t){e.rtpSenders.push(e.impl.addTrack(t,e._localStream))}):this.impl.addStream(this._localStream),this._call){var t=s.default.getDTMFSender(this.impl,this._call.id());t&&(this.dtmfSender=t)}this.updateHoldState()}},t.prototype._addMediaStream=function(e,t){var n=this;if(void 0===t&&(t=!1),"undefined"==typeof this.shareScreenMedia&&(this.shareScreenMedia=[]),"undefined"==typeof this.shareScreenMediaTracks&&(this.shareScreenMediaTracks=[]),this.shareScreenMedia.push(e),e.getTracks().forEach(function(e){n.shareScreenMediaTracks.push(e.id)}),"firefox"===s.default.getWSVendor()?e.getTracks().forEach(function(e){n.rtpSenders.push(n.impl.addTrack(e,n._localStream))}):this.impl.addStream(e),t){var r=this.renderStream(e,"sharing",!0);this.renderers.push(r)}},t.prototype._unbindLocalMegia=function(){var e=this;this.needTransportRestart=!0,"firefox"===s.default.getWSVendor()?this.rtpSenders.forEach(function(t){e.shareScreenMediaTracks?e.shareScreenMediaTracks.indexOf(t.track.id)===-1&&e.impl.removeTrack(t):e.impl.removeTrack(t)}):this._localStream&&this.impl.removeStream(this._localStream),this._localStream&&this._localStream.getTracks().forEach(function(t){t.stop(),e._localStream.removeTrack(t)}),this._localStream=null},t.prototype._handleReinvite=function(e,t){var n=this;return new Promise(function(o,i){if(n.banReinviteAnswer)return void i();if(n.renegotiationInProgress===!1){n.renegotiationInProgress=!0;var a=new RTCSessionDescription({sdp:t,type:r.offer});n.srcRemoteSDP=t,a=L.SDPMuggle.removeTIAS(a),n.impl.setRemoteDescription(a).then(function(){var e={mandatory:n.getReceiveOptions()};return n.impl.createAnswer(e)}).then(function(e){var t={type:e.type,sdp:e.sdp};return t=L.SDPMuggle.removeDoubleOpus(t),t=L.SDPMuggle.fixVideoRecieve(t,n.videoEnabled.receiveVideo),n.srcLocalSDP=t.sdp,n.impl.setLocalDescription(t)}).then(function(){var t={tracks:n._getTrackKind()};p.VoxSignaling.get().callRemoteFunction(f.RemoteFunction.acceptReInvite,n._call.id(),e,n.impl.localDescription.sdp,t),n.renegotiationInProgress=!1,n._call.dispatchEvent({name:y,result:!0,call:n._call}),n.updateHoldState(),o()}).catch(function(e){i(e),n.renegotiationInProgress=!1})}else if(n.renegotiationInProgress===!0){var s=new RTCSessionDescription({sdp:t,type:r.answer});n.renegotiationInProgress=!1,n.srcRemoteSDP=t,s=L.SDPMuggle.removeTIAS(s),n.impl.setLocalDescription(n.pendingOffer).then(function(){return n.impl.setRemoteDescription(s)}).then(function(){clearTimeout(n.renegotiationTimer),n._call.dispatchEvent({name:y,result:!0,call:n._call}),n.updateHoldState(),o()}).catch(function(e){clearTimeout(n.renegotiationTimer),n._call.dispatchEvent({name:y,result:!1,call:n._call}),n.renegotiationInProgress=!1,n.log.error(JSON.stringify(e))})}else i(new Error("Universe was broken!"))})},t.prototype.codecRearrange=function(e){var t=this;return new Promise(function(n,r){var o=g.CallManager.get().calls[t.id];if("undefined"!=typeof o){var i=new h.CodecSorter(e.sdp),a=i.getUserCodecList();"undefined"!=typeof o.rearangeCodecs?o.rearangeCodecs(a).then(function(t){i.setUserCodecList(t),n({type:e.type,sdp:i.getSDP()})},function(e){t.log.error(JSON.stringify(e)),r(e)}):(t.log.info("No sdp transformer registered"),i.setUserCodecList(a),n({type:e.type,sdp:i.getSDP()}))}else n(e)})},t.prototype._sendDTMF=function(e,t,n){"undefined"!=typeof this.dtmfSender&&this.dtmfSender.insertDTMF(e,t,n)},t.prototype._hold=function(e){C.CallstatsIo.get().sendFabricEvent(this.impl,e?C.CallstatsIoFabricEvent.fabricHold:C.CallstatsIoFabricEvent.fabricResume,this._call.id()),this.onHold=e,this.onRenegotiation()},t.prototype._getDirections=function(){var e={};return e.local=L.SDPMuggle.detectDirections(this.impl.localDescription.sdp),e.remote=L.SDPMuggle.detectDirections(this.impl.remoteDescription.sdp),e},t.prototype._getStreamActivity=function(){var e={};return e.local=this.getMediaActivity(this.impl.getLocalStreams()),e.remote=this.getMediaActivity(this.impl.getRemoteStreams()),e},t.prototype.getMediaActivity=function(e){return e.map(function(e){return e.getTracks().map(function(e){return{id:e.id,kind:e.kind,mutted:e.muted,active:e.enabled,label:e.label}})})},t.prototype._hdnFRSPrep=function(){this.banReinviteAnswer=!0},t.prototype._hdnFRS=function(){this.renegotiationInProgress=!1,this.onRenegotiation()},t.prototype._getTrackKind=function(){var e=this,t={};return this.impl.getSenders,this.impl.getSenders().forEach(function(n){n.track&&("video"!==n.track.kind?t[n.track.id]=n.track.kind:e.shareScreenMedia&&e.shareScreenMedia.some(function(e){return e.getTracks().some(function(e){return e.id===n.track.id})})?t[n.track.id]="sharing":t[n.track.id]="video")}),t},t.prototype._stopSharing=function(){var e=this;"undefined"!=typeof this.shareScreenMedia&&("firefox"===s.default.getWSVendor()?this.impl.getSenders().forEach(function(t){e.shareScreenMediaTracks.indexOf(t.track.id)!==-1&&e.impl.removeTrack(t)}):this.shareScreenMedia.forEach(function(t){e.impl.removeStream(t)}),this.shareScreenMedia.forEach(function(t){t.getTracks().forEach(function(n){n.stop(),t.removeTrack(n),e.renderers.forEach(function(e){e.id===n.id&&d.Renderer.get().releaseElement(e)})})}),this.shareScreenMediaTracks=[],this.shareScreenMedia=[])},i([u.LogManager.d_trace(u.LogCategory.RTC)],t.prototype,"onSignalingStateChange",null),i([u.LogManager.d_trace(u.LogCategory.RTC)],t.prototype,"getPCStats",null),i([u.LogManager.d_trace(u.LogCategory.RTC)],t.prototype,"onConnectionChange",null),i([u.LogManager.d_trace(u.LogCategory.RTC)],t.prototype,"onRenegotiation",null),i([u.LogManager.d_trace(u.LogCategory.RTC)],t.prototype,"onICECandidate",null),i([u.LogManager.d_trace(u.LogCategory.RTC)],t.prototype,"onAddTrack",null),i([u.LogManager.d_trace(u.LogCategory.RTC)],t.prototype,"onAddStream",null),i([u.LogManager.d_trace(u.LogCategory.RTC)],t.prototype,"wireRemoteStream",null),i([u.LogManager.d_trace(u.LogCategory.RTC)],t.prototype,"_processRemoteAnswer",null),i([u.LogManager.d_trace(u.LogCategory.RTC)],t.prototype,"_getLocalOffer",null),i([u.LogManager.d_trace(u.LogCategory.RTC)],t.prototype,"_getLocalAnswer",null),i([u.LogManager.d_trace(u.LogCategory.RTC)],t.prototype,"_setRemoteDescription",null),i([u.LogManager.d_trace(u.LogCategory.RTC)],t.prototype,"_processRemoteOffer",null),i([u.LogManager.d_trace(u.LogCategory.RTC)],t.prototype,"_close",null),i([u.LogManager.d_trace(u.LogCategory.RTC)],t.prototype,"_addRemoteCandidate",null),i([u.LogManager.d_trace(u.LogCategory.RTC)],t.prototype,"_bindLocalMedia",null),i([u.LogManager.d_trace(u.LogCategory.RTC)],t.prototype,"_unbindLocalMegia",null),i([u.LogManager.d_trace(u.LogCategory.RTC)],t.prototype,"_handleReinvite",null),i([u.LogManager.d_trace(u.LogCategory.RTC)],t.prototype,"codecRearrange",null),i([u.LogManager.d_trace(u.LogCategory.RTC)],t.prototype,"_sendDTMF",null),i([u.LogManager.d_trace(u.LogCategory.RTC)],t.prototype,"_hold",null),t}(a.PeerConnection);t.WebRTCPC=M},function(e,t){"use strict";!function(e){e[e.Offline="OFFLINE"]="Offline",e[e.Online="ONLINE"]="Online",e[e.Ready="READY"]="Ready",e[e.InService="IN_SERVICE"]="InService",e[e.AfterService="AFTER_SERVICE"]="AfterService",e[e.Timeout="TIMEOUT"]="Timeout",e[e.DND="DND"]="DND"}(t.OperatorACDStatuses||(t.OperatorACDStatuses={}));t.OperatorACDStatuses},function(e,t){"use strict";var n=function(){function e(){this.eventListeners={}}return e.prototype.addEventListener=function(e,t){"undefined"==typeof this.eventListeners[e]&&(this.eventListeners[e]=[]),this.eventListeners[e].push(t)},e.prototype.dispatchEvent=function(e){var t=e.name;if("undefined"!=typeof this.eventListeners[t])for(var n=0;n<this.eventListeners[t].length;n++)"function"==typeof this.eventListeners[t][n]&&this.eventListeners[t][n](e)},e.prototype.removeEventListener=function(e,t){if("undefined"!=typeof this.eventListeners[e])if("function"==typeof t){for(var n=0;n<this.eventListeners[e].length;n++)if(this.eventListeners[e][n]==t){this.eventListeners[e].splice(n,1);break}}else this.eventListeners[e]=[]},e.prototype.on=function(e,t){this.addEventListener(e,t)},e.prototype.off=function(e,t){this.removeEventListener(e,t)},e}();t.Callbackable=n},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}return e.hashStr=function(e,t){return void 0===t&&(t=!1),this.onePassHasher.start().appendStr(e).end(t)},e.hashAsciiStr=function(e,t){return void 0===t&&(t=!1),this.onePassHasher.start().appendAsciiStr(e).end(t)},e._hex=function(t){var n,r,o,i,a=e.hexChars,s=e.hexOut;for(i=0;i<4;i+=1)for(r=8*i,n=t[i],o=0;o<8;o+=2)s[r+1+o]=a.charAt(15&n),n>>>=4,s[r+0+o]=a.charAt(15&n),n>>>=4;return s.join("")},e._md5cycle=function(e,t){var n=e[0],r=e[1],o=e[2],i=e[3];n+=(r&o|~r&i)+t[0]-680876936|0,n=(n<<7|n>>>25)+r|0,i+=(n&r|~n&o)+t[1]-389564586|0,i=(i<<12|i>>>20)+n|0,o+=(i&n|~i&r)+t[2]+606105819|0,o=(o<<17|o>>>15)+i|0,r+=(o&i|~o&n)+t[3]-1044525330|0,r=(r<<22|r>>>10)+o|0,n+=(r&o|~r&i)+t[4]-176418897|0,n=(n<<7|n>>>25)+r|0,i+=(n&r|~n&o)+t[5]+1200080426|0,i=(i<<12|i>>>20)+n|0,o+=(i&n|~i&r)+t[6]-1473231341|0,o=(o<<17|o>>>15)+i|0,r+=(o&i|~o&n)+t[7]-45705983|0,r=(r<<22|r>>>10)+o|0,n+=(r&o|~r&i)+t[8]+1770035416|0,n=(n<<7|n>>>25)+r|0,i+=(n&r|~n&o)+t[9]-1958414417|0,i=(i<<12|i>>>20)+n|0,o+=(i&n|~i&r)+t[10]-42063|0,o=(o<<17|o>>>15)+i|0,r+=(o&i|~o&n)+t[11]-1990404162|0,r=(r<<22|r>>>10)+o|0,n+=(r&o|~r&i)+t[12]+1804603682|0,n=(n<<7|n>>>25)+r|0,i+=(n&r|~n&o)+t[13]-40341101|0,i=(i<<12|i>>>20)+n|0,o+=(i&n|~i&r)+t[14]-1502002290|0,o=(o<<17|o>>>15)+i|0,r+=(o&i|~o&n)+t[15]+1236535329|0,r=(r<<22|r>>>10)+o|0,n+=(r&i|o&~i)+t[1]-165796510|0,n=(n<<5|n>>>27)+r|0,i+=(n&o|r&~o)+t[6]-1069501632|0,i=(i<<9|i>>>23)+n|0,o+=(i&r|n&~r)+t[11]+643717713|0,o=(o<<14|o>>>18)+i|0,r+=(o&n|i&~n)+t[0]-373897302|0,r=(r<<20|r>>>12)+o|0,n+=(r&i|o&~i)+t[5]-701558691|0,n=(n<<5|n>>>27)+r|0,i+=(n&o|r&~o)+t[10]+38016083|0,i=(i<<9|i>>>23)+n|0,o+=(i&r|n&~r)+t[15]-660478335|0,o=(o<<14|o>>>18)+i|0,r+=(o&n|i&~n)+t[4]-405537848|0,r=(r<<20|r>>>12)+o|0,n+=(r&i|o&~i)+t[9]+568446438|0,n=(n<<5|n>>>27)+r|0,i+=(n&o|r&~o)+t[14]-1019803690|0,i=(i<<9|i>>>23)+n|0,o+=(i&r|n&~r)+t[3]-187363961|0,o=(o<<14|o>>>18)+i|0,r+=(o&n|i&~n)+t[8]+1163531501|0,r=(r<<20|r>>>12)+o|0,n+=(r&i|o&~i)+t[13]-1444681467|0,n=(n<<5|n>>>27)+r|0,i+=(n&o|r&~o)+t[2]-51403784|0,i=(i<<9|i>>>23)+n|0,o+=(i&r|n&~r)+t[7]+1735328473|0,o=(o<<14|o>>>18)+i|0,r+=(o&n|i&~n)+t[12]-1926607734|0,r=(r<<20|r>>>12)+o|0,n+=(r^o^i)+t[5]-378558|0,n=(n<<4|n>>>28)+r|0,i+=(n^r^o)+t[8]-2022574463|0,i=(i<<11|i>>>21)+n|0,o+=(i^n^r)+t[11]+1839030562|0,o=(o<<16|o>>>16)+i|0,r+=(o^i^n)+t[14]-35309556|0,r=(r<<23|r>>>9)+o|0,n+=(r^o^i)+t[1]-1530992060|0,n=(n<<4|n>>>28)+r|0,i+=(n^r^o)+t[4]+1272893353|0,i=(i<<11|i>>>21)+n|0,o+=(i^n^r)+t[7]-155497632|0,o=(o<<16|o>>>16)+i|0,r+=(o^i^n)+t[10]-1094730640|0,r=(r<<23|r>>>9)+o|0,n+=(r^o^i)+t[13]+681279174|0,n=(n<<4|n>>>28)+r|0,i+=(n^r^o)+t[0]-358537222|0,i=(i<<11|i>>>21)+n|0,o+=(i^n^r)+t[3]-722521979|0,o=(o<<16|o>>>16)+i|0,r+=(o^i^n)+t[6]+76029189|0,r=(r<<23|r>>>9)+o|0,n+=(r^o^i)+t[9]-640364487|0,n=(n<<4|n>>>28)+r|0,i+=(n^r^o)+t[12]-421815835|0,i=(i<<11|i>>>21)+n|0,o+=(i^n^r)+t[15]+530742520|0,o=(o<<16|o>>>16)+i|0,r+=(o^i^n)+t[2]-995338651|0,r=(r<<23|r>>>9)+o|0,n+=(o^(r|~i))+t[0]-198630844|0,n=(n<<6|n>>>26)+r|0,i+=(r^(n|~o))+t[7]+1126891415|0,i=(i<<10|i>>>22)+n|0,o+=(n^(i|~r))+t[14]-1416354905|0,o=(o<<15|o>>>17)+i|0,r+=(i^(o|~n))+t[5]-57434055|0,r=(r<<21|r>>>11)+o|0,n+=(o^(r|~i))+t[12]+1700485571|0,n=(n<<6|n>>>26)+r|0,i+=(r^(n|~o))+t[3]-1894986606|0,i=(i<<10|i>>>22)+n|0,o+=(n^(i|~r))+t[10]-1051523|0,o=(o<<15|o>>>17)+i|0,r+=(i^(o|~n))+t[1]-2054922799|0,r=(r<<21|r>>>11)+o|0,n+=(o^(r|~i))+t[8]+1873313359|0,n=(n<<6|n>>>26)+r|0,i+=(r^(n|~o))+t[15]-30611744|0,i=(i<<10|i>>>22)+n|0,o+=(n^(i|~r))+t[6]-1560198380|0,o=(o<<15|o>>>17)+i|0,r+=(i^(o|~n))+t[13]+1309151649|0,r=(r<<21|r>>>11)+o|0,n+=(o^(r|~i))+t[4]-145523070|0,n=(n<<6|n>>>26)+r|0,i+=(r^(n|~o))+t[11]-1120210379|0,i=(i<<10|i>>>22)+n|0,o+=(n^(i|~r))+t[2]+718787259|0,o=(o<<15|o>>>17)+i|0,r+=(i^(o|~n))+t[9]-343485551|0,r=(r<<21|r>>>11)+o|0,e[0]=n+e[0]|0,e[1]=r+e[1]|0,e[2]=o+e[2]|0,e[3]=i+e[3]|0},e.prototype.start=function(){return this._dataLength=0,this._bufferLength=0,this._state.set(e.stateIdentity),this},e.prototype.appendStr=function(t){var n,r,o=this._buffer8,i=this._buffer32,a=this._bufferLength;for(r=0;r<t.length;r+=1){if(n=t.charCodeAt(r),n<128)o[a++]=n;else if(n<2048)o[a++]=(n>>>6)+192,o[a++]=63&n|128;else if(n<55296||n>56319)o[a++]=(n>>>12)+224,o[a++]=n>>>6&63|128,o[a++]=63&n|128;else{if(n=1024*(n-55296)+(t.charCodeAt(++r)-56320)+65536,n>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");o[a++]=(n>>>18)+240,o[a++]=n>>>12&63|128,o[a++]=n>>>6&63|128,o[a++]=63&n|128}a>=64&&(this._dataLength+=64,e._md5cycle(this._state,i),a-=64,i[0]=i[16])}return this._bufferLength=a,this},e.prototype.appendAsciiStr=function(t){for(var n,r=this._buffer8,o=this._buffer32,i=this._bufferLength,a=0;;){for(n=Math.min(t.length-a,64-i);n--;)r[i++]=t.charCodeAt(a++);if(i<64)break;this._dataLength+=64,e._md5cycle(this._state,o),i=0}return this._bufferLength=i,this},e.prototype.appendByteArray=function(t){for(var n,r=this._buffer8,o=this._buffer32,i=this._bufferLength,a=0;;){for(n=Math.min(t.length-a,64-i);n--;)r[i++]=t[a++];if(i<64)break;this._dataLength+=64,e._md5cycle(this._state,o),i=0}return this._bufferLength=i,this},e.prototype.getState=function(){var e=this,t=e._state;return{buffer:String.fromCharCode.apply(null,e._buffer8),buflen:e._bufferLength,length:e._dataLength,state:[t[0],t[1],t[2],t[3]]}},e.prototype.setState=function(e){var t,n=e.buffer,r=e.state,o=this._state;for(this._dataLength=e.length,this._bufferLength=e.buflen,o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[3],t=0;t<n.length;t+=1)this._buffer8[t]=n.charCodeAt(t)},e.prototype.end=function(t){void 0===t&&(t=!1);var n,r=this._bufferLength,o=this._buffer8,i=this._buffer32,a=(r>>2)+1;if(this._dataLength+=r,o[r]=128,o[r+1]=o[r+2]=o[r+3]=0,i.set(e.buffer32Identity.subarray(a),a),r>55&&(e._md5cycle(this._state,i),i.set(e.buffer32Identity)),n=8*this._dataLength,n<=4294967295)i[14]=n;else{var s=n.toString(16).match(/(.*?)(.{0,8})$/);if(null===s)return;var c=parseInt(s[2],16),d=parseInt(s[1],16)||0;i[14]=c,i[15]=d}return e._md5cycle(this._state,i),t?this._state:e._hex(this._state)},e.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]),e.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),e.hexChars="0123456789abcdef",e.hexOut=[],e.onePassHasher=new e,e}();t.Md5=n,"5d41402abc4b2a76b9719d911017c592"!==n.hashStr("hello")&&console.error("Md5 self test failed.")},function(e,t,n){(function(t){"use strict";var r=n(46);e.exports=r({window:t.window})}).call(t,function(){return this}())},function(e,t,n){"use strict";e.exports=function(e,t){var r=e&&e.window,o={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var i in t)hasOwnProperty.call(t,i)&&(o[i]=t[i]);var a=n(9),s=a.log,c=a.detectBrowser(r),d={browserDetails:c,extractVersion:a.extractVersion,disableLog:a.disableLog,disableWarnings:a.disableWarnings},l=n(47)||null,u=n(49)||null,p=n(52)||null,g=n(54)||null;switch(c.browser){case"chrome":if(!l||!l.shimPeerConnection||!o.shimChrome)return s("Chrome shim is not included in this adapter release."),d;s("adapter.js shimming chrome."),d.browserShim=l,l.shimGetUserMedia(r),l.shimMediaStream(r),a.shimCreateObjectURL(r),l.shimSourceObject(r),l.shimPeerConnection(r),l.shimOnTrack(r),l.shimAddTrackRemoveTrack(r),l.shimGetSendersWithDtmf(r);break;case"firefox":if(!p||!p.shimPeerConnection||!o.shimFirefox)return s("Firefox shim is not included in this adapter release."),d;s("adapter.js shimming firefox."),d.browserShim=p,p.shimGetUserMedia(r),a.shimCreateObjectURL(r),p.shimSourceObject(r),p.shimPeerConnection(r),p.shimOnTrack(r);break;case"edge":if(!u||!u.shimPeerConnection||!o.shimEdge)return s("MS edge shim is not included in this adapter release."),d;s("adapter.js shimming edge."),d.browserShim=u,u.shimGetUserMedia(r),a.shimCreateObjectURL(r),u.shimPeerConnection(r),u.shimReplaceTrack(r);break;case"safari":if(!g||!o.shimSafari)return s("Safari shim is not included in this adapter release."),d;s("adapter.js shimming safari."),d.browserShim=g,a.shimCreateObjectURL(r),g.shimRTCIceServerUrls(r),g.shimCallbacksAPI(r),g.shimLocalStreamsAPI(r),g.shimRemoteStreamsAPI(r),g.shimGetUserMedia(r);break;default:s("Unsupported browser!")}return d}},function(e,t,n){"use strict";var r=n(9),o=r.log,i={shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return n._ontrackpoly||(n._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(r){var o;o=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===r.track.id}):{track:r.track};var i=new Event("track");i.track=r.track,i.receiver=o,i.streams=[t.stream],n.dispatchEvent(i)}),t.stream.getTracks().forEach(function(r){var o;o=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===r.id}):{track:r};var i=new Event("track");i.track=r,i.receiver=o,i.streams=[t.stream],n.dispatchEvent(i)})},n.addEventListener("addstream",n._ontrackpoly)),t.apply(n,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var o=this,i=n.apply(o,arguments);return i||(i=t(o,e),o._senders.push(i)),i};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;r.apply(t,arguments);var n=t._senders.indexOf(e);n!==-1&&t._senders.splice(n,1)}}var o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;n._senders=n._senders||[],o.apply(n,[e]),e.getTracks().forEach(function(e){n._senders.push(t(n,e))})};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],i.apply(t,[t._streams[e.id]||e]),e.getTracks().forEach(function(e){var n=t._senders.find(function(t){return t.track===e});n&&t._senders.splice(t._senders.indexOf(n),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSourceObject:function(e){var t=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var n=this;return this._srcObject=e,this.src&&t.revokeObjectURL(this.src),e?(this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)}),void e.addEventListener("removetrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)})):void(this.src="")}}))},shimAddTrackRemoveTrack:function(e){if(!e.RTCPeerConnection.prototype.addTrack){var t=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,n=t.apply(this);return e._reverseStreams=e._reverseStreams||{},n.map(function(t){return e._reverseStreams[t.id]})};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{},t.getTracks().forEach(function(e){var t=r.getSenders().find(function(t){return t.track===e});if(t)throw new DOMException("Track already exists.","InvalidAccessError")}),!r._reverseStreams[t.id]){var o=new e.MediaStream(t.getTracks());r._streams[t.id]=o,r._reverseStreams[o.id]=t,t=o}n.apply(r,[t])};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},r.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if("closed"===r.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var o=[].slice.call(arguments,1);if(1!==o.length||!o[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var i=r.getSenders().find(function(e){return e.track===t});if(i)throw new DOMException("Track already exists.","InvalidAccessError");r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{};var a=r._streams[n.id];if(a)a.addTrack(t),r.dispatchEvent(new Event("negotiationneeded"));else{var s=new e.MediaStream([t]);r._streams[n.id]=s,r._reverseStreams[s.id]=n,r.addStream(s)}return r.getSenders().find(function(e){return e.track===t})},e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===t.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");var n=e._pc===t;if(!n)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");t._streams=t._streams||{};var r;Object.keys(t._streams).forEach(function(n){var o=t._streams[n].getTracks().find(function(t){return e.track===t});o&&(r=t._streams[n])}),r&&(1===r.getTracks().length?t.removeStream(r):r.removeTrack(e.track),t.dispatchEvent(new Event("negotiationneeded")))}}},shimPeerConnection:function(e){var t=r.detectBrowser(e);if(e.RTCPeerConnection){var n=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var o=[],i=0;i<e.iceServers.length;i++){var a=e.iceServers[i];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,o.push(a)):o.push(e.iceServers[i])}e.iceServers=o}return new n(e,t)},e.RTCPeerConnection.prototype=n.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return n.generateCertificate}})}else e.RTCPeerConnection=function(t,n){return o("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,n)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}});var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,n){var r=this,o=arguments;if(arguments.length>0&&"function"==typeof e)return i.apply(this,arguments);if(0===i.length&&(0===arguments.length||"function"!=typeof arguments[0]))return i.apply(this,[]);var a=function(e){var t={},n=e.result();return n.forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){var c=function(e){o[1](s(a(e)))};return i.apply(this,[c,arguments[0]])}return new Promise(function(e,t){i.apply(r,[function(t){e(s(a(t)))},t])}).then(t,n)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,r=new Promise(function(r,o){n.apply(t,[e[0],r,o])});return e.length<2?r:r.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,o){n.apply(e,[r,o,t])})}return n.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var a=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?a.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};e.exports={shimMediaStream:i.shimMediaStream,shimOnTrack:i.shimOnTrack,shimAddTrackRemoveTrack:i.shimAddTrackRemoveTrack,shimGetSendersWithDtmf:i.shimGetSendersWithDtmf,shimSourceObject:i.shimSourceObject,shimPeerConnection:i.shimPeerConnection,shimGetUserMedia:n(48)}},function(e,t,n){"use strict";var r=n(9),o=r.log;e.exports=function(e){var t=r.detectBrowser(e),n=e&&e.navigator,i=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var i={};"number"==typeof r.ideal?(i[o("min",n)]=r.ideal,t.optional.push(i),i={},i[o("max",n)]=r.ideal,t.optional.push(i)):(i[o("",n)]=r.ideal,t.optional.push(i))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",n)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,n)]=r[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,r){if(e=JSON.parse(JSON.stringify(e)),e&&"object"==typeof e.audio){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};e=JSON.parse(JSON.stringify(e)),a(e.audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"==typeof e.video){var s=e.video.facingMode;s=s&&("object"==typeof s?s:{
ideal:s});var c=t.version<61;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||c)){delete e.video.facingMode;var d;if("environment"===s.exact||"environment"===s.ideal?d=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(d=["front"]),d)return n.mediaDevices.enumerateDevices().then(function(t){t=t.filter(function(e){return"videoinput"===e.kind});var n=t.find(function(e){return d.some(function(t){return e.label.toLowerCase().indexOf(t)!==-1})});return!n&&t.length&&d.indexOf("back")!==-1&&(n=t[t.length-1]),n&&(e.video.deviceId=s.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=i(e.video),o("chrome: "+JSON.stringify(e)),r(e)})}e.video=i(e.video)}return o("chrome: "+JSON.stringify(e)),r(e)},s=function(e){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},c=function(e,t,r){a(e,function(e){n.webkitGetUserMedia(e,t,function(e){r(s(e))})})};n.getUserMedia=c;var d=function(e){return new Promise(function(t,r){n.getUserMedia(e,t,r)})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:d,enumerateDevices:function(){return new Promise(function(t){var n={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:n[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),n.mediaDevices.getUserMedia){var l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return a(e,function(e){return l(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(s(e))})})}}else n.mediaDevices.getUserMedia=function(e){return d(e)};"undefined"==typeof n.mediaDevices.addEventListener&&(n.mediaDevices.addEventListener=function(){o("Dummy mediaDevices.addEventListener called.")}),"undefined"==typeof n.mediaDevices.removeEventListener&&(n.mediaDevices.removeEventListener=function(){o("Dummy mediaDevices.removeEventListener called.")})}},function(e,t,n){"use strict";var r=n(9),o=n(51);e.exports={shimGetUserMedia:n(50),shimPeerConnection:function(e){var t=r.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCPeerConnection=o(e,t.version)},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}}},function(e,t){"use strict";e.exports=function(e){var t=e&&e.navigator,n=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch(function(e){return Promise.reject(n(e))})}}},function(e,t,n){"use strict";function r(e){var t=e.filter(function(e){return"audio"===e.kind}),n=e.filter(function(e){return"video"===e.kind});for(e=[];t.length||n.length;)t.length&&e.push(t.shift()),n.length&&e.push(n.shift());return e}function o(e,t){var n=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var o="string"==typeof r;return o&&(r=[r]),r=r.filter(function(e){var r=0===e.indexOf("turn:")&&e.indexOf("transport=udp")!==-1&&e.indexOf("turn:[")===-1&&!n;return r?(n=!0,!0):0===e.indexOf("stun:")&&t>=14393}),delete e.url,e.urls=o?r[0]:r,!!r.length}return!1})}function i(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},o=function(e,t,n,o){var i=r(e.parameters.apt,n),a=r(t.parameters.apt,o);return i&&a&&i.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach(function(r){for(var i=0;i<t.codecs.length;i++){var a=t.codecs[i];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&a.parameters.apt&&!o(r,a,e.codecs,t.codecs))continue;a=JSON.parse(JSON.stringify(a)),a.numChannels=Math.min(r.numChannels,a.numChannels),n.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var o=t.headerExtensions[r];if(e.uri===o.uri){n.headerExtensions.push(o);break}}}),n}function a(e,t,n){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)!==-1}var s=n(27);e.exports=function(e,t){var n=function(n){var r=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){r[e]=i[e].bind(i)}),this.needNegotiation=!1,this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onicegatheringstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.canTrickleIceCandidates=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return r.localStreams},this.getRemoteStreams=function(){return r.remoteStreams},this.localDescription=new e.RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new e.RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},n&&n.iceTransportPolicy)switch(n.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=n.iceTransportPolicy}this.usingBundle=n&&"max-bundle"===n.bundlePolicy,n&&n.iceServers&&(this.iceOptions.iceServers=o(n.iceServers,t)),this._config=n||{},this.transceivers=[],this._localIceCandidatesBuffer=[],this._sdpSessionId=s.generateSessionId()};return n.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this.dispatchEvent(e),null!==this.onicegatheringstatechange&&this.onicegatheringstatechange(e)},n.prototype._emitBufferedCandidates=function(){var e=this,t=s.splitSections(e.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(n){var r=!n.candidate||0===Object.keys(n.candidate).length;if(r)for(var o=1;o<t.length;o++)t[o].indexOf("\r\na=end-of-candidates\r\n")===-1&&(t[o]+="a=end-of-candidates\r\n");else t[n.candidate.sdpMLineIndex+1]+="a="+n.candidate.candidate+"\r\n";if(e.localDescription.sdp=t.join(""),e.dispatchEvent(n),null!==e.onicecandidate&&e.onicecandidate(n),!n.candidate&&"complete"!==e.iceGatheringState){var i=e.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});i&&"complete"!==e.iceGatheringStateChange&&(e.iceGatheringState="complete",e._emitGatheringStateChange())}}),this._localIceCandidatesBuffer=[]},n.prototype.getConfiguration=function(){return this._config},n.prototype._createTransceiver=function(e){var t=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,wantReceive:!0};if(this.usingBundle&&t)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var r=this._createIceAndDtlsTransports();n.iceTransport=r.iceTransport,n.dtlsTransport=r.dtlsTransport}return this.transceivers.push(n),n},n.prototype.addTrack=function(t,n){for(var r,o=0;o<this.transceivers.length;o++)this.transceivers[o].track||this.transceivers[o].kind!==t.kind||(r=this.transceivers[o]);return r||(r=this._createTransceiver(t.kind)),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),this._maybeFireNegotiationNeeded(),r.rtpSender},n.prototype.addStream=function(e){var n=this;if(t>=15025)this.localStreams.push(e),e.getTracks().forEach(function(t){n.addTrack(t,e)});else{var r=e.clone();e.getTracks().forEach(function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),r.getTracks().forEach(function(e){n.addTrack(e,r)}),this.localStreams.push(r)}this._maybeFireNegotiationNeeded()},n.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},n.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},n.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},n.prototype._createIceGatherer=function(t,n){var r=this,o=new e.RTCIceGatherer(r.iceOptions);return o.onlocalcandidate=function(e){var i=new Event("icecandidate");i.candidate={sdpMid:t,sdpMLineIndex:n};var a=e.candidate,c=!a||0===Object.keys(a).length;c?void 0===o.state&&(o.state="completed"):(a.component=1,i.candidate.candidate=s.writeCandidate(a));var d=s.splitSections(r.localDescription.sdp);c?d[i.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n":d[i.candidate.sdpMLineIndex+1]+="a="+i.candidate.candidate+"\r\n",r.localDescription.sdp=d.join("");var l=r._pendingOffer?r._pendingOffer:r.transceivers,u=l.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});switch(r.iceGatheringState){case"new":c||r._localIceCandidatesBuffer.push(i),c&&u&&r._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":r._emitBufferedCandidates(),c||(r.dispatchEvent(i),null!==r.onicecandidate&&r.onicecandidate(i)),u&&(r.dispatchEvent(new Event("icecandidate")),null!==r.onicecandidate&&r.onicecandidate(new Event("icecandidate")),r.iceGatheringState="complete",r._emitGatheringStateChange());break;case"complete":}},o},n.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},n.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},n.prototype._transceive=function(e,n,r){var o=i(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(o.encodings=e.sendEncodingParameters,o.rtcp={cname:s.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(o.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(o)),r&&e.rtpReceiver&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),o.encodings=e.recvEncodingParameters,o.rtcp={cname:e.rtcpParameters.cname,compound:e.rtcpParameters.compound},e.sendEncodingParameters.length&&(o.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(o))},n.prototype.setLocalDescription=function(t){var n=this;if(!a("setLocalDescription",t.type,this.signalingState)){var r=new Error("Can not set local "+t.type+" in state "+this.signalingState);return r.name="InvalidStateError",arguments.length>2&&"function"==typeof arguments[2]&&e.setTimeout(arguments[2],0,r),Promise.reject(r)}var o,c;if("offer"===t.type)this._pendingOffer&&(o=s.splitSections(t.sdp),c=o.shift(),o.forEach(function(e,t){var r=s.parseRtpParameters(e);n._pendingOffer[t].localCapabilities=r}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===t.type){o=s.splitSections(n.remoteDescription.sdp),c=o.shift();var d=s.matchPrefix(c,"a=ice-lite").length>0;o.forEach(function(e,t){var r=n.transceivers[t],o=r.iceGatherer,a=r.iceTransport,l=r.dtlsTransport,u=r.localCapabilities,p=r.remoteCapabilities,g=s.isRejected(e);if(!g&&!r.isDatachannel){var f=s.getIceParameters(e,c),h=s.getDtlsParameters(e,c);d&&(h.role="server"),n.usingBundle&&0!==t||(a.start(o,f,d?"controlling":"controlled"),l.start(h));var v=i(u,p);n._transceive(r,v.codecs.length>0,!1)}})}switch(this.localDescription={type:t.type,sdp:t.sdp},t.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+t.type+'"')}var l=arguments.length>1&&"function"==typeof arguments[1];if(l){var u=arguments[1];e.setTimeout(function(){u(),"new"===n.iceGatheringState&&(n.iceGatheringState="gathering",n._emitGatheringStateChange()),n._emitBufferedCandidates()},0)}var p=Promise.resolve();return p.then(function(){l||("new"===n.iceGatheringState&&(n.iceGatheringState="gathering",n._emitGatheringStateChange()),e.setTimeout(n._emitBufferedCandidates.bind(n),500))}),p},n.prototype.setRemoteDescription=function(n){var r=this;if(!a("setRemoteDescription",n.type,this.signalingState)){var o=new Error("Can not set remote "+n.type+" in state "+this.signalingState);return o.name="InvalidStateError",arguments.length>2&&"function"==typeof arguments[2]&&e.setTimeout(arguments[2],0,o),Promise.reject(o)}var i={},c=[],d=s.splitSections(n.sdp),l=d.shift(),u=s.matchPrefix(l,"a=ice-lite").length>0,p=s.matchPrefix(l,"a=group:BUNDLE ").length>0;this.usingBundle=p;var g=s.matchPrefix(l,"a=ice-options:")[0];switch(g?this.canTrickleIceCandidates=g.substr(14).split(" ").indexOf("trickle")>=0:this.canTrickleIceCandidates=!1,d.forEach(function(o,a){var d=s.splitLines(o),g=s.getKind(o),f=s.isRejected(o),h=d[0].substr(2).split(" ")[2],v=s.getDirection(o,l),C=s.parseMsid(o),m=s.getMid(o)||s.generateIdentifier();if("application"===g&&"DTLS/SCTP"===h)return void(r.transceivers[a]={mid:m,isDatachannel:!0});var y,L,S,E,_,M,R,T,P,I,b,w=s.parseRtpParameters(o);f||(I=s.getIceParameters(o,l),b=s.getDtlsParameters(o,l),b.role="client"),R=s.parseRtpEncodingParameters(o);var A=s.parseRtcpParameters(o),O=s.matchPrefix(o,"a=end-of-candidates",l).length>0,N=s.matchPrefix(o,"a=candidate:").map(function(e){return s.parseCandidate(e)}).filter(function(e){return"1"===e.component||1===e.component});("offer"===n.type||"answer"===n.type)&&!f&&p&&a>0&&r.transceivers[a]&&(r._disposeIceAndDtlsTransports(a),r.transceivers[a].iceGatherer=r.transceivers[0].iceGatherer,r.transceivers[a].iceTransport=r.transceivers[0].iceTransport,r.transceivers[a].dtlsTransport=r.transceivers[0].dtlsTransport,r.transceivers[a].rtpSender&&r.transceivers[a].rtpSender.setTransport(r.transceivers[0].dtlsTransport),r.transceivers[a].rtpReceiver&&r.transceivers[a].rtpReceiver.setTransport(r.transceivers[0].dtlsTransport)),"offer"!==n.type||f?"answer"!==n.type||f||(y=r.transceivers[a],L=y.iceGatherer,S=y.iceTransport,E=y.dtlsTransport,_=y.rtpReceiver,M=y.sendEncodingParameters,T=y.localCapabilities,r.transceivers[a].recvEncodingParameters=R,r.transceivers[a].remoteCapabilities=w,r.transceivers[a].rtcpParameters=A,p&&0!==a||((u||O)&&N.length&&S.setRemoteCandidates(N),S.start(L,I,"controlling"),E.start(b)),r._transceive(y,"sendrecv"===v||"recvonly"===v,"sendrecv"===v||"sendonly"===v),!_||"sendrecv"!==v&&"sendonly"!==v?delete y.rtpReceiver:(P=_.track,C?(i[C.stream]||(i[C.stream]=new e.MediaStream),i[C.stream].addTrack(P),c.push([P,_,i[C.stream]])):(i.default||(i.default=new e.MediaStream),i.default.addTrack(P),c.push([P,_,i.default])))):(y=r.transceivers[a]||r._createTransceiver(g),y.mid=m,y.iceGatherer||(y.iceGatherer=p&&a>0?r.transceivers[0].iceGatherer:r._createIceGatherer(m,a)),!O||!N.length||p&&0!==a||y.iceTransport.setRemoteCandidates(N),T=e.RTCRtpReceiver.getCapabilities(g),t<15019&&(T.codecs=T.codecs.filter(function(e){return"rtx"!==e.name})),M=[{ssrc:1001*(2*a+2)}],"sendrecv"!==v&&"sendonly"!==v||(_=new e.RTCRtpReceiver(y.dtlsTransport,g),P=_.track,C?(i[C.stream]||(i[C.stream]=new e.MediaStream,Object.defineProperty(i[C.stream],"id",{get:function(){return C.stream}})),Object.defineProperty(P,"id",{get:function(){return C.track}}),i[C.stream].addTrack(P),c.push([P,_,i[C.stream]])):(i.default||(i.default=new e.MediaStream),i.default.addTrack(P),c.push([P,_,i.default]))),y.localCapabilities=T,y.remoteCapabilities=w,y.rtpReceiver=_,y.rtcpParameters=A,y.sendEncodingParameters=M,y.recvEncodingParameters=R,r._transceive(r.transceivers[a],!1,"sendrecv"===v||"sendonly"===v))}),this.remoteDescription={type:n.type,sdp:n.sdp},n.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+n.type+'"')}return Object.keys(i).forEach(function(t){var n=i[t];if(n.getTracks().length){r.remoteStreams.push(n);var o=new Event("addstream");o.stream=n,r.dispatchEvent(o),null!==r.onaddstream&&e.setTimeout(function(){r.onaddstream(o)},0),c.forEach(function(t){var o=t[0],i=t[1];if(n.id===t[2].id){var a=new Event("track");a.track=o,a.receiver=i,a.streams=[n],r.dispatchEvent(a),null!==r.ontrack&&e.setTimeout(function(){r.ontrack(a)},0)}})}}),e.setTimeout(function(){r&&r.transceivers&&r.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),arguments.length>1&&"function"==typeof arguments[1]&&e.setTimeout(arguments[1],0),Promise.resolve()},n.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},n.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this.dispatchEvent(t),null!==this.onsignalingstatechange&&this.onsignalingstatechange(t)},n.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&this.needNegotiation!==!0&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation!==!1){t.needNegotiation=!1;var e=new Event("negotiationneeded");t.dispatchEvent(e),null!==t.onnegotiationneeded&&t.onnegotiationneeded(e)}},0))},n.prototype._updateConnectionState=function(){var e,t=this,n={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){n[e.iceTransport.state]++,n[e.dtlsTransport.state]++}),n.connected+=n.completed,e="new",n.failed>0?e="failed":n.connecting>0||n.checking>0?e="connecting":n.disconnected>0?e="disconnected":n.new>0?e="new":(n.connected>0||n.completed>0)&&(e="connected"),e!==t.iceConnectionState){t.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this.dispatchEvent(r),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(r)}},n.prototype.createOffer=function(){var n=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");var o;1===arguments.length&&"function"!=typeof arguments[0]?o=arguments[0]:3===arguments.length&&(o=arguments[2]);var i=this.transceivers.filter(function(e){return"audio"===e.kind}).length,a=this.transceivers.filter(function(e){return"video"===e.kind}).length;if(o){if(o.mandatory||o.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==o.offerToReceiveAudio&&(i=o.offerToReceiveAudio===!0?1:o.offerToReceiveAudio===!1?0:o.offerToReceiveAudio),void 0!==o.offerToReceiveVideo&&(a=o.offerToReceiveVideo===!0?1:o.offerToReceiveVideo===!1?0:o.offerToReceiveVideo)}for(this.transceivers.forEach(function(e){"audio"===e.kind?(i--,i<0&&(e.wantReceive=!1)):"video"===e.kind&&(a--,a<0&&(e.wantReceive=!1))});i>0||a>0;)i>0&&(this._createTransceiver("audio"),i--),a>0&&(this._createTransceiver("video"),a--);var c=r(this.transceivers),d=s.writeSessionBoilerplate(this._sdpSessionId);c.forEach(function(r,o){var i=r.track,a=r.kind,d=s.generateIdentifier();r.mid=d,r.iceGatherer||(r.iceGatherer=n.usingBundle&&o>0?c[0].iceGatherer:n._createIceGatherer(d,o));var l=e.RTCRtpSender.getCapabilities(a);t<15019&&(l.codecs=l.codecs.filter(function(e){return"rtx"!==e.name})),l.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1")});var u=[{ssrc:1001*(2*o+1)}];i&&t>=15019&&"video"===a&&(u[0].rtx={ssrc:1001*(2*o+1)+1}),r.wantReceive&&(r.rtpReceiver=new e.RTCRtpReceiver(r.dtlsTransport,a)),r.localCapabilities=l,r.sendEncodingParameters=u}),"max-compat"!==this._config.bundlePolicy&&(d+="a=group:BUNDLE "+c.map(function(e){return e.mid}).join(" ")+"\r\n"),d+="a=ice-options:trickle\r\n",c.forEach(function(e,t){d+=s.writeMediaSection(e,e.localCapabilities,"offer",e.stream),d+="a=rtcp-rsize\r\n"}),this._pendingOffer=c;var l=new e.RTCSessionDescription({type:"offer",sdp:d});return arguments.length&&"function"==typeof arguments[0]&&e.setTimeout(arguments[0],0,l),Promise.resolve(l)},n.prototype.createAnswer=function(){var n=s.writeSessionBoilerplate(this._sdpSessionId);this.usingBundle&&(n+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(e,r){if(e.isDatachannel)return void(n+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+e.mid+"\r\n");if(e.stream){var o;"audio"===e.kind?o=e.stream.getAudioTracks()[0]:"video"===e.kind&&(o=e.stream.getVideoTracks()[0]),o&&t>=15019&&"video"===e.kind&&(e.sendEncodingParameters[0].rtx={ssrc:1001*(2*r+2)+1})}var a=i(e.localCapabilities,e.remoteCapabilities),c=a.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length;!c&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,n+=s.writeMediaSection(e,a,"answer",e.stream),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(n+="a=rtcp-rsize\r\n")});var r=new e.RTCSessionDescription({type:"answer",sdp:n});return arguments.length&&"function"==typeof arguments[0]&&e.setTimeout(arguments[0],0,r),Promise.resolve(r)},n.prototype.addIceCandidate=function(t){if(t){var n=t.sdpMLineIndex;if(t.sdpMid)for(var r=0;r<this.transceivers.length;r++)if(this.transceivers[r].mid===t.sdpMid){n=r;break}var o=this.transceivers[n];if(o){var i=Object.keys(t.candidate).length>0?s.parseCandidate(t.candidate):{};if("tcp"===i.protocol&&(0===i.port||9===i.port))return Promise.resolve();if(i.component&&"1"!==i.component&&1!==i.component)return Promise.resolve();o.iceTransport.addRemoteCandidate(i);var a=s.splitSections(this.remoteDescription.sdp);a[n+1]+=(i.type?t.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=a.join("")}}else for(var c=0;c<this.transceivers.length;c++)if(this.transceivers[c].iceTransport.addRemoteCandidate({}),this.usingBundle)return Promise.resolve();return arguments.length>1&&"function"==typeof arguments[1]&&e.setTimeout(arguments[1],0),Promise.resolve()},n.prototype.getStats=function(){var t=[];this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(n){e[n]&&t.push(e[n].getStats())})});var n=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1],r=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};return new Promise(function(o){var i=new Map;Promise.all(t).then(function(t){t.forEach(function(e){Object.keys(e).forEach(function(t){e[t].type=r(e[t]),i.set(t,e[t])})}),n&&e.setTimeout(n,0,i),o(i)})})},n}},function(e,t,n){"use strict";var r=n(9),o={shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=r.detectBrowser(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(n,r){if(t.version<38&&n&&n.iceServers){for(var o=[],i=0;i<n.iceServers.length;i++){var a=n.iceServers[i];if(a.hasOwnProperty("urls"))for(var s=0;s<a.urls.length;s++){var c={url:a.urls[s]};0===a.urls[s].indexOf("turn")&&(c.username=a.username,c.credential=a.credential),o.push(c)}else o.push(n.iceServers[i])}n.iceServers=o}return new e.mozRTCPeerConnection(n,r)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var o=function(e){var t=new Map;return Object.keys(e).forEach(function(n){t.set(n,e[n]),t[n]=e[n]}),t},i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,n,r){return a.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=o(e)),t.version<53&&!n)try{e.forEach(function(e){e.type=i[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,n){e.set(n,Object.assign({},t,{type:i[t.type]||t.type}))})}return e}).then(n,r)}}}};e.exports={shimOnTrack:o.shimOnTrack,shimSourceObject:o.shimSourceObject,shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:n(53)}},function(e,t,n){"use strict";var r=n(9),o=r.log;e.exports=function(e){var t=r.detectBrowser(e),n=e&&e.navigator,i=e&&e.MediaStreamTrack,a=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},s=function(e,r,i){var s=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r=e[n]="object"==typeof e[n]?e[n]:{ideal:e[n]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||t.push(n),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[n]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var o={};"number"==typeof r.ideal?o[n]={min:r.ideal,max:r.ideal}:o[n]=r.ideal,e.advanced.push(o),delete r.ideal,Object.keys(r).length||delete e[n]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(o("spec: "+JSON.stringify(e)),e.audio&&(e.audio=s(e.audio)),e.video&&(e.video=s(e.video)),o("ff37: "+JSON.stringify(e))),n.mozGetUserMedia(e,r,function(e){i(a(e))})},c=function(e){return new Promise(function(t,n){s(e,t,n)})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:c,addEventListener:function(){},removeEventListener:function(){}}),n.mediaDevices.enumerateDevices=n.mediaDevices.enumerateDevices||function(){return new Promise(function(e){var t=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];e(t)})},t.version<41){var d=n.mediaDevices.enumerateDevices.bind(n.mediaDevices);n.mediaDevices.enumerateDevices=function(){return d().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return l(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(a(e))})}}if(!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var u=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},p=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),u(e.audio,"autoGainControl","mozAutoGainControl"),u(e.audio,"noiseSuppression","mozNoiseSuppression")),p(e)},i&&i.prototype.getSettings){var g=i.prototype.getSettings;i.prototype.getSettings=function(){var e=g.apply(this,arguments);return u(e,"mozAutoGainControl","autoGainControl"),u(e,"mozNoiseSuppression","noiseSuppression"),e}}if(i&&i.prototype.applyConstraints){var f=i.prototype.applyConstraints;i.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),u(e,"autoGainControl","mozAutoGainControl"),u(e,"noiseSuppression","mozNoiseSuppression")),f.apply(this,[e])}}}n.getUserMedia=function(e,o,i){return t.version<44?s(e,o,i):(r.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),void n.mediaDevices.getUserMedia(e).then(o,i))}}},function(e,t,n){"use strict";
var r=n(9),o={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(n){n.id===e&&(t=n)}),this._remoteStreams&&this._remoteStreams.forEach(function(n){n.id===e&&(t=n)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.indexOf(e)===-1&&this._localStreams.push(e);var n=this;e.getTracks().forEach(function(r){t.call(n,r,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,n){n&&(this._localStreams?this._localStreams.indexOf(n)===-1&&this._localStreams.push(n):this._localStreams=[n]),t.call(this,e,n)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(t!==-1){this._localStreams.splice(t,1);var n=this,r=e.getTracks();this.getSenders().forEach(function(e){r.indexOf(e.track)!==-1&&n.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){"object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){var t=e.streams[0];if(this._remoteStreams||(this._remoteStreams=[]),!(this._remoteStreams.indexOf(t)>=0)){this._remoteStreams.push(t);var n=new Event("addstream");n.stream=e.streams[0],this.dispatchEvent(n)}}.bind(this))}}))},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,o=t.setLocalDescription,i=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],o=n.apply(this,[r]);return t?(o.then(e,t),Promise.resolve()):o},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],o=r.apply(this,[n]);return t?(o.then(e,t),Promise.resolve()):o};var s=function(e,t,n){var r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){var r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){var r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=s}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var o=[],i=0;i<e.iceServers.length;i++){var a=e.iceServers[i];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,o.push(a)):o.push(e.iceServers[i])}e.iceServers=o}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}};e.exports={shimCallbacksAPI:o.shimCallbacksAPI,shimLocalStreamsAPI:o.shimLocalStreamsAPI,shimRemoteStreamsAPI:o.shimRemoteStreamsAPI,shimGetUserMedia:o.shimGetUserMedia,shimRTCIceServerUrls:o.shimRTCIceServerUrls}}]);
	if (typeof exports !== 'undefined') {
		exports['default'] = exports.VoxImplant = VoxImplant;
		if (typeof module !== 'undefined' && module.exports) {
			exports = module.exports = exports['default'];
		}		
	} else {
		root.VoxImplant = VoxImplant;
	}
}).call(this);